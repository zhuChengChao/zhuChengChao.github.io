<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Mario.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Mario.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="说明：在学习了 bilibili 上 黑马程序员 的课程 JVM完整教程 后做的学习笔记，总共分为5篇笔记，本文为 2&#x2F;5 篇，其余笔记地址如下：  JVM：内存结构 JVM：垃圾回收 JVM：类加载字节码-1 JVM：类加载字节码-2 JVM：内存模型">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM：垃圾回收">
<meta property="og:url" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/index.html">
<meta property="og:site_name" content="贤余超">
<meta property="og:description" content="说明：在学习了 bilibili 上 黑马程序员 的课程 JVM完整教程 后做的学习笔记，总共分为5篇笔记，本文为 2&#x2F;5 篇，其余笔记地址如下：  JVM：内存结构 JVM：垃圾回收 JVM：类加载字节码-1 JVM：类加载字节码-2 JVM：内存模型">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/引用计数法.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/标记和清除.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/标记整理.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/复制.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/分代垃圾回收.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/串行.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/吞吐量优先.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/响应时间优先.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/垃圾回收阶段.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection1.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection2.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection3.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection+CM.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/MixedCollection.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection跨带引用.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection跨带引用2.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark1.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark2.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark3.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark4.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark5.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark6.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark7.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/巨型对象.PNG">
<meta property="og:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/巨型对象2.PNG">
<meta property="article:published_time" content="2020-09-06T02:24:10.000Z">
<meta property="article:modified_time" content="2020-09-06T02:24:10.000Z">
<meta property="article:author" content="ZhuCC">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/引用计数法.PNG">

<link rel="canonical" href="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JVM：垃圾回收 | 贤余超</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	<a target="_blank" rel="noopener" href="https://github.com/zhuChengChao" class="github-corner" aria-label="View source on GitHub">
	<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
	<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
	<path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
	<path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
	</svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">贤余超</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一位底层码农 :-)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">98</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">17</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">201</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="ZhuCC">
      <meta itemprop="description" content="不急不躁。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="贤余超">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JVM：垃圾回收
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-06 10:24:10" itemprop="dateCreated datePublished" datetime="2020-09-06T10:24:10+08:00">2020-09-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>说明：在学习了 bilibili 上 <strong><a href>黑马程序员</a></strong> 的课程 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1yE411Z7AP">JVM完整教程</a> 后做的学习笔记，总共分为5篇笔记，本文为 2/5 篇，其余笔记地址如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/">JVM：内存结构</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">JVM：垃圾回收</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/09/13/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E7%B1%BB%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF-1/">JVM：类加载字节码-1</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/09/13/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E7%B1%BB%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF-2/">JVM：类加载字节码-2</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/09/13/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">JVM：内存模型</a></li>
</ul>
<span id="more"></span>
<h1 id="jvm垃圾回收">JVM：垃圾回收</h1>
<h3 id="内容">内容</h3>
<ol type="1">
<li>如何判断对象可以回收</li>
<li>垃圾回收算法</li>
<li>分代垃圾回收</li>
<li>垃圾回收器</li>
<li>垃圾回收调优</li>
</ol>
<h2 id="如何判断对象可以回收">1. 如何判断对象可以回收</h2>
<h3 id="引用计数法">1.1 引用计数法</h3>
<p><strong>描述：</strong></p>
<p>对象被引用，计数+1，当不再被引用了，计数-1</p>
<p>当对象没有被引用了，可以被垃圾回收</p>
<p><strong>存在问题：</strong></p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/引用计数法.PNG" alt="引用计数法"></p>
<p>循环引用：A对象引用B，B对象引用A，而没有其他对象引用AB对象了；但是AB对象的引用计数永不为0。</p>
<h3 id="可达性分析算法">1.2 可达性分析算法</h3>
<p><strong>根对象</strong>：肯定不能被当成垃圾回收的对象。</p>
<ul>
<li><p>Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象</p></li>
<li><p>扫描堆中的对象，看是否能够沿着 GC Root 对象为起点的引用链找到该对象，找不到，表示可以回收；</p></li>
<li><p>哪些对象可以作为 GC Root ?</p></li>
</ul>
<p><strong>演示GC Roots</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, IOException </span>&#123;</span><br><span class="line">        List&lt;Object&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list1.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        list1.add(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        System.out.println(<span class="number">1</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line"></span><br><span class="line">        list1 = <span class="keyword">null</span>;</span><br><span class="line">        System.out.println(<span class="number">2</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line">        System.out.println(<span class="string">&quot;end...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol type="1">
<li><p>其中程序，运行到第一个<code>System.in.read();</code>时，通过 jmap 抓取内存快照；</p>
<ol type="1">
<li><p>通过 jps 查看 java 进程id；</p></li>
<li><p>通过 jmap 抓取内存快照：<code>jmap -dump:format=b, live, file=1.bin 27840</code></p>
<p><code>-dump</code>：把运行时的状态抓取成一个文件；</p>
<p><code>format=b</code>：转储文件的格式，b-二进制格式;</p>
<p><code>live</code> ：只关心存活对象，且在抓取快照之前会进行一次垃圾回收;</p>
<p><code>file=1.bin</code> ：内存快照存储在对应文件</p>
<p><code>27840</code> ：对应的进程ID</p></li>
<li><p>执行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:...&gt;jmap -dump:format=b,live,file=1.bin 27840</span><br><span class="line">Dumping heap to C:\...\1.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure></li>
</ol></li>
<li><p>回车，将 list1 引用置为空时，再次抓取内存快照<code>jmap -dump:format=b,live,file=2.bin 27840</code></p></li>
<li><p>通过<code>Eclipse Memory Analyzer</code>对上述生成的文件进行分析</p></li>
<li><p>分析过程略....</p></li>
<li><p><strong>可以分析有哪些类作为 GC Root类</strong></p>
<ol type="1">
<li><code>System Class</code>：由启动类加载器加载的系统类，如Object类、HashMap类、String类...</li>
<li><code>Native Stack</code>：Java虚拟机在执行一些方法时，会调用一些操作系统的方法，操作方法在执行时所引用的一些Java对象；</li>
<li><code>Thread</code>：活动线程中使用的一些对象；</li>
<li><code>Busy Monitor</code>：正在加锁的对象。</li>
</ol></li>
<li><p>上述代码中，<code>new ArrayList&lt;&gt;();</code>在<code>list1 = null;</code>之后，在抓取第二次内存快照时被垃圾回收了</p></li>
</ol>
<h3 id="四种引用">1.3 四种引用</h3>
<ol type="1">
<li><strong>强引用</strong>
<ul>
<li>通过 new 创建一个对象，通过赋值运算符赋值给一个变量，变量就强引用了对象</li>
<li>只有所有 GC Roots 对象都不通过【强引用】引用该对象，该对象才能被垃圾回收</li>
</ul></li>
<li><strong>软引用（SoftReference）</strong>
<ul>
<li>仅有软引用引用该对象时，在垃圾回收后，内存仍不足时会再次触发垃圾回收，回收软引用对象；即一般不会轻易回收，只有内存不够时才回收</li>
<li>可以配合引用队列来释放软引用自身</li>
</ul></li>
</ol>
<blockquote>
<p>引用队列：软引用的对象被被回收后，<strong>软引用自身也是一个对象</strong>，在创建时为软引用分配了引用队列，则当软引用引用的对象被回收时，软引用会进入引用队列</p>
<p>在引用队列中依次遍历，释放引用占用内存</p>
</blockquote>
<ol start="3" type="1">
<li><p><strong>弱引用（WeakReference）</strong></p>
<ul>
<li><p>仅有弱引用引用该对象时，在垃圾回收时，无论内存是否充足，都会回收弱引用对象</p></li>
<li><p>可以配合引用队列来释放弱引用自身</p></li>
</ul></li>
<li><p><strong>虚引用（PhantomReference）</strong></p>
<ul>
<li><p>虚引用是最弱的一种引用关系，如果一个对象仅持有虚引用，那么它就和没有任何引用一样，它随时可能会被回收</p></li>
<li><p>必须配合引用队列使用，主要配合 ByteBuffer 使用，被引用对象回收时，会将虚引用入队，由 Reference Handler 线程调用虚引用相关方法释放直接内存</p></li>
</ul>
<blockquote>
<p>在内存结构章节中提到的Cleaner对象就是一个虚引用</p>
</blockquote></li>
<li><p>终结器引用（FinalReference）</p>
<ul>
<li>无需手动编码，但其内部配合引用队列使用，在垃圾回收时，终结器引用入队（被引用对象暂时没有被回收），再由 Finalizer 线程通过终结器引用找到被引用对象并调用它的 finalize方法，第二次 GC 时才能回收被引用对象</li>
</ul></li>
</ol>
<h4 id="演示软引用">演示软引用</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 演示软引用</span></span><br><span class="line"><span class="comment"> * -Xmx20m</span></span><br><span class="line"><span class="comment"> *  设置虚拟机内存为20Mb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _4MB = <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 强引用</span></span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>报堆内存溢出的错误：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure>
<p>将上述代码修改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	soft();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">soft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// list --&gt; SoftReference --&gt; byte[]</span></span><br><span class="line">    List&lt;SoftReference&lt;<span class="keyword">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        SoftReference&lt;<span class="keyword">byte</span>[]&gt; ref = <span class="keyword">new</span> SoftReference&lt;&gt;(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB]);</span><br><span class="line">        System.out.println(ref.get());</span><br><span class="line">        list.add(ref);</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;循环结束：&quot;</span> + list.size());</span><br><span class="line">    <span class="keyword">for</span> (SoftReference&lt;<span class="keyword">byte</span>[]&gt; ref : list) &#123;</span><br><span class="line">        System.out.println(ref.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[B@7f31245a</span><br><span class="line"><span class="number">1</span></span><br><span class="line">[B@6d6f6e28</span><br><span class="line"><span class="number">2</span></span><br><span class="line">[B@135fbaa4</span><br><span class="line"><span class="number">3</span></span><br><span class="line">[B@45ee12a7</span><br><span class="line"><span class="number">4</span></span><br><span class="line">[B@330bedb4</span><br><span class="line"><span class="number">5</span></span><br><span class="line">循环结束：<span class="number">5</span></span><br><span class="line"><span class="keyword">null</span>  </span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span>           <span class="comment">// 数组的前四个元素都变成了null</span></span><br><span class="line">[B@330bedb4    <span class="comment">// 只有最后一个被保存下来了</span></span><br></pre></td></tr></table></figure>
<p>详细分析：添加JVM参数：<code>-Xmx20m -XX:+PrintGCDetails -verbose:gc</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[B@7f31245a</span><br><span class="line"><span class="number">1</span>     <span class="comment">// 第一次添加没问题</span></span><br><span class="line">[B@6d6f6e28</span><br><span class="line"><span class="number">2</span>     <span class="comment">// 第二次添加没问题</span></span><br><span class="line">[B@135fbaa4</span><br><span class="line"><span class="number">3</span>     <span class="comment">// 第三次添加没问题，虽然已经触发了垃圾回收，新生代的垃圾回收</span></span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 1946K-&gt;488K(6144K)] 14234K-&gt;12982K(19968K), <span class="number">0.0007510</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]   </span><br><span class="line">[B@45ee12a7</span><br><span class="line"><span class="number">4</span>     <span class="comment">// 第四次添加，已经触发了垃圾回收</span></span><br><span class="line">[GC (Allocation Failure) --[PSYoungGen: 4696K-&gt;4696K(6144K)] 17191K-&gt;17215K(19968K), <span class="number">0.0005606</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 4696K-&gt;4551<span class="title">K</span><span class="params">(6144K)</span>] [ParOldGen: 12518K-&gt;12463<span class="title">K</span><span class="params">(13824K)</span>] 17215K-&gt;17014<span class="title">K</span><span class="params">(19968K)</span>, [Metaspace: 3230K-&gt;3230<span class="title">K</span><span class="params">(1056768K)</span>], 0.0029214 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[GC (Allocation Failure) --[PSYoungGen: 4551K-&gt;4551K(6144K)] 17014K-&gt;17022K(19968K), <span class="number">0.0006793</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Allocation Failure)</span> [PSYoungGen: 4551K-&gt;0<span class="title">K</span><span class="params">(6144K)</span>] [ParOldGen: 12471K-&gt;612<span class="title">K</span><span class="params">(8704K)</span>] 17022K-&gt;612<span class="title">K</span><span class="params">(14848K)</span>, [Metaspace: 3230K-&gt;3230<span class="title">K</span><span class="params">(1056768K)</span>], 0.0038851 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@330bedb4</span><br><span class="line"><span class="number">5</span>    <span class="comment">// 第五次添加，内存不足了，触发了软引用的垃圾回收，导致数组前四个内容被回收成为null</span></span><br><span class="line">循环结束：<span class="number">5</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">[B@330bedb4</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 6144K, used 4377K [<span class="number">0x00000000ff980000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 5632K, <span class="number">77</span>% used [<span class="number">0x00000000ff980000</span>,<span class="number">0x00000000ffdc6548</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line">  to   space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line"> ParOldGen       total 8704K, used 612K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff480000</span>, <span class="number">0x00000000ff980000</span>)</span><br><span class="line">  object space 8704K, <span class="number">7</span>% used [<span class="number">0x00000000fec00000</span>,<span class="number">0x00000000fec99278</span>,<span class="number">0x00000000ff480000</span>)</span><br><span class="line"> Metaspace       used 3236K, capacity 4500K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 351<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Process</span> <span class="title">finished</span> <span class="title">with</span> <span class="title">exit</span> <span class="title">code</span> 0</span></span><br></pre></td></tr></table></figure>
<p>上述代码中，软引用的对象已经为 null 了，对于这些软引用已经没必要保存在 list 对象中了，下述对软引用本身做一个清理</p>
<p><strong>配合引用队列对软引用做一个清理</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 演示软引用, 配合引用队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _4MB = <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;SoftReference&lt;<span class="keyword">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 引用队列</span></span><br><span class="line">        ReferenceQueue&lt;<span class="keyword">byte</span>[]&gt; queue = <span class="keyword">new</span> ReferenceQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 关联了引用队列， 当软引用所关联的byte[]被回收时，软引用自己会加入到 queue 中去</span></span><br><span class="line">            SoftReference&lt;<span class="keyword">byte</span>[]&gt; ref = <span class="keyword">new</span> SoftReference&lt;&gt;(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB], queue);</span><br><span class="line">            System.out.println(ref.get());</span><br><span class="line">            list.add(ref);</span><br><span class="line">            System.out.println(list.size());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从队列中获取无用的 软引用对象，并移除</span></span><br><span class="line">        Reference&lt;? extends <span class="keyword">byte</span>[]&gt; poll = queue.poll();</span><br><span class="line">        <span class="keyword">while</span>( poll != <span class="keyword">null</span>) &#123;</span><br><span class="line">            list.remove(poll);</span><br><span class="line">            poll = queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;===========================&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SoftReference&lt;<span class="keyword">byte</span>[]&gt; reference : list) &#123;</span><br><span class="line">            System.out.println(reference.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[B@7f31245a</span><br><span class="line"><span class="number">1</span></span><br><span class="line">[B@6d6f6e28</span><br><span class="line"><span class="number">2</span></span><br><span class="line">[B@135fbaa4</span><br><span class="line"><span class="number">3</span></span><br><span class="line">[B@45ee12a7</span><br><span class="line"><span class="number">4</span></span><br><span class="line">[B@330bedb4</span><br><span class="line"><span class="number">5</span></span><br><span class="line">===========================</span><br><span class="line">[B@330bedb4  <span class="comment">// 可以看到list中被回收的软引用对象已经被移除了</span></span><br></pre></td></tr></table></figure>
<h4 id="演示弱应用">演示弱应用</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 演示弱引用</span></span><br><span class="line"><span class="comment"> * -Xmx20m -XX:+PrintGCDetails -verbose:gc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_5</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _4MB = <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//  list --&gt; WeakReference --&gt; byte[]</span></span><br><span class="line">        List&lt;WeakReference&lt;<span class="keyword">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            WeakReference&lt;<span class="keyword">byte</span>[]&gt; ref = <span class="keyword">new</span> WeakReference&lt;&gt;(<span class="keyword">new</span> <span class="keyword">byte</span>[_4MB]);</span><br><span class="line">            list.add(ref);</span><br><span class="line">            <span class="keyword">for</span> (WeakReference&lt;<span class="keyword">byte</span>[]&gt; w : list) &#123;</span><br><span class="line">                System.out.print(w.get()+<span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;循环结束：&quot;</span> + list.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>循环5次的输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[B@7f31245a </span><br><span class="line">[B@7f31245a [B@6d6f6e28 </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 1944K-&gt;488K(6144K)] 14232K-&gt;12978K(19968K), <span class="number">0.0010070</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 [B@45ee12a7  <span class="comment">// 第四次循环触发了垃圾回收，弱引用引用的对象还没有被回收</span></span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4696K-&gt;504K(6144K)] 17187K-&gt;13010K(19968K), <span class="number">0.0005339</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> [B@330bedb4 <span class="comment">// 第五次循环，无法将byte[]放入list中了，触发垃圾回收，list中的第四个对象被回收</span></span><br><span class="line">循环结束：<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>循环6次的输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[B@7f31245a </span><br><span class="line">[B@7f31245a [B@6d6f6e28 </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 1833K-&gt;488K(6144K)] 14121K-&gt;13010K(19968K), <span class="number">0.0031088</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 [B@45ee12a7 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4696K-&gt;472K(6144K)] 17219K-&gt;12994K(19968K), <span class="number">0.0027955</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> [B@330bedb4 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4680K-&gt;456K(6144K)] 17202K-&gt;12978K(19968K), <span class="number">0.0046990</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> <span class="keyword">null</span> [B@2503dbd3 <span class="comment">// 只有把第5个对象删除后，第6个对象才能放进list中</span></span><br><span class="line">循环结束：<span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>循环10次的输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[B@7f31245a </span><br><span class="line">[B@7f31245a [B@6d6f6e28 </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 1946K-&gt;488K(6144K)] 14234K-&gt;12978K(19968K), <span class="number">0.0007414</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 [B@45ee12a7 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4696K-&gt;504K(6144K)] 17187K-&gt;13018K(19968K), <span class="number">0.0005572</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> [B@330bedb4 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4712K-&gt;504K(6144K)] 17226K-&gt;13026K(19968K), <span class="number">0.0004535</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> <span class="keyword">null</span> [B@2503dbd3 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4711K-&gt;488K(6144K)] 17233K-&gt;13026K(19968K), <span class="number">0.0003885</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> [B@4b67cf4d </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4694K-&gt;504K(6144K)] 17233K-&gt;13042K(19968K), <span class="number">0.0003820</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> [B@7ea987ac </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4710K-&gt;488K(5120K)] 17249K-&gt;13026K(18944K), <span class="number">0.0005374</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@7f31245a [B@6d6f6e28 [B@135fbaa4 <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> [B@12a3a380 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 4674K-&gt;32K(5632K)] 17212K-&gt;13042K(19456K), <span class="number">0.0013349</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 32K-&gt;0<span class="title">K</span><span class="params">(5632K)</span>] [ParOldGen: 13010K-&gt;630<span class="title">K</span><span class="params">(7680K)</span>] 13042K-&gt;630<span class="title">K</span><span class="params">(13312K)</span>, [Metaspace: 3229K-&gt;3229<span class="title">K</span><span class="params">(1056768K)</span>], 0.0041599 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"><span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> <span class="keyword">null</span> [B@29453f44 </span><br><span class="line">循环结束：<span class="number">10</span></span><br></pre></td></tr></table></figure>
<h2 id="垃圾回收算法">2. 垃圾回收算法</h2>
<h3 id="标记清除">2.1 标记清除</h3>
<p>定义： Mark Sweep</p>
<p>分为标记和清除两个步骤：</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/标记和清除.PNG" alt="标记和清除"></p>
<p>标记：标记出可以被清除的对象；</p>
<p>清除：把垃圾对象占用的空间清除，此处的清除为把对象占用的内存起始结束地址进行记录，在下次分配对象地址时可以分配到这些地址中。</p>
<p><strong>优点：</strong>速度快，清除时只需要记录垃圾对象的起始结束地址即可；</p>
<p><strong>缺点：</strong>容易产生内存碎片</p>
<h3 id="标记整理">2.2 标记整理</h3>
<p>定义：Mark Compact</p>
<p>标记整理也分为两个步骤：</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/标记整理.PNG" alt="标记整理"></p>
<p>标记：标记步骤与标记清除相同；</p>
<p>整理：为了避免标记清除时产生的内存碎片问题，在清理的过程中，对对象进行整理，使得对象在内存空间中更为紧凑。</p>
<p><strong>优点</strong>：不会产生内存碎片；</p>
<p><strong>缺点</strong>：在整理过程中，涉及到了对象的移动，因此速度较慢。</p>
<h3 id="复制拷贝">2.3 复制拷贝</h3>
<p>定义：Copy</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/复制.PNG" alt="复制"></p>
<p>将内存区划分了内存大小相同的两块区域；</p>
<p>在 FROM 区中进行一次标记处理；</p>
<p>将 FROM 区中存活的对象复制到 TO 区域中，复制过程中完成对象的整理；</p>
<p>在复制完成后，清空 FROM 区域，并交换 FROM 和 TO 区的位置</p>
<p><strong>优点：</strong>不会产生内存碎片</p>
<p><strong>缺点：</strong>需要使用双倍的内存空间</p>
<h2 id="分代垃圾回收">3. 分代垃圾回收</h2>
<ul>
<li>将堆内存分为两块区域：<strong>新生代</strong>与<strong>老年代</strong>；</li>
<li>有些需要长时间使用的对象放置老年代中；将那些用完后不需要再使用的对象放置于新生代中；</li>
<li>这样可针对对象生命周期不同的特点，选择不同的垃圾回收策略，新生代中垃圾回收发生较频繁。</li>
</ul>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/分代垃圾回收.PNG" alt="分代垃圾回收"></p>
<p><strong>分代垃圾回收工作机制</strong>：</p>
<ul>
<li>创建的新对象首先分配在伊甸园区域，之后更多对象被创建，放入伊甸园中；</li>
<li>新生代空间不足时，触发 <code>Minor GC</code>，伊甸园和From存活的对象使用<strong>copy复制</strong>到to中，存活的对象年龄+1并且交换from和to；</li>
<li><code>Minor GC</code> 会引发 <code>stop the world</code>，暂停其它用户的线程，等垃圾回收结束，用户线程才恢复运行，这是出于在GC时，涉及到了对象地址的修改；</li>
<li>触发<code>Minor GC</code>后，伊甸园有空间了，继续将生成的对象放入，直至再次发生<code>Minor GC</code>进行相应操作；</li>
<li>当幸存区中对象的寿命超过阈值时，会晋升至老年代，最大寿命是15（4bit）；</li>
<li>当老年代空间不足，会先尝试触发 <code>Minor GC</code>，如果之后空间仍不足，那么触发 <code>Full GC</code>，<code>stop the world</code>的时间更长；</li>
<li>若触发 <code>Full GC</code>后，老年代的空间还是不足，则会导致堆内存溢出。</li>
</ul>
<h3 id="相关-vm-参数">3.1 相关 VM 参数</h3>
<table>
<thead>
<tr class="header">
<th></th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>堆初始大小</td>
<td><code>-Xms</code></td>
</tr>
<tr class="even">
<td>堆最大大小</td>
<td><code>-Xmx</code> 或 <code>-XX:MaxHeapSize=size</code></td>
</tr>
<tr class="odd">
<td>新生代大小</td>
<td><code>-Xmn</code> 或 (<code>-XX:NewSize=size</code> + <code>-XX:MaxNewSize=size</code>)</td>
</tr>
<tr class="even">
<td>幸存区比例（动态）</td>
<td><code>-XX:InitialSurvivorRatio=ratio</code> 和 <code>-XX:+UseAdaptiveSizePolicy</code></td>
</tr>
<tr class="odd">
<td>幸存区比例</td>
<td><code>-XX:SurvivorRatio=ratio</code></td>
</tr>
<tr class="even">
<td>晋升阈值</td>
<td><code>-XX:MaxTenuringThreshold=threshold</code></td>
</tr>
<tr class="odd">
<td>晋升详情</td>
<td><code>-XX:+PrintTenuringDistribution</code></td>
</tr>
<tr class="even">
<td>GC详情</td>
<td><code>-XX:+PrintGCDetails -verbose:gc</code></td>
</tr>
<tr class="odd">
<td>FullGC前MinorGC</td>
<td><code>-XX:+ScavengeBeforeFullGC</code></td>
</tr>
</tbody>
</table>
<h3 id="垃圾回收案例">3.2 垃圾回收案例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  演示内存的分配策略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _512KB = <span class="number">512</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _1MB = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _6MB = <span class="number">6</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _7MB = <span class="number">7</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _8MB = <span class="number">8</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -Xms20M -Xmx20M -Xmn10M -XX:+UseSerialGC -XX:+PrintGCDetails -verbose:gc -XX:-ScavengeBeforeFullGC</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JVM 参数设置：</p>
<ul>
<li><code>-Xms20M</code>设置初始的堆空间为20Mb</li>
<li><code>-Xmx20M</code>设置堆最大大小为20Mb</li>
<li><code>-Xmn10M</code>设置新生代大小为10Mb</li>
<li><code>-XX:+UseSerialGC</code>：使用串行垃圾回收器，JDK8下的GC不是这个，修改为这个GC后幸存区的比例才不会动态调整；</li>
<li><code>-XX:+PrintGCDetails -verbose:gc</code>：打印GC详情</li>
<li><code>-XX:-ScavengeBeforeFullGC</code>：Full GC 前 Minor GC</li>
</ul>
<p><strong>主函数中内容为空的运行结果：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有发生GC，只打印了程序结束后堆的情况</span></span><br><span class="line">Heap  <span class="comment">// 堆内存</span></span><br><span class="line"> <span class="comment">// new generation 新生代的信息</span></span><br><span class="line"> <span class="comment">// total-&gt;总空间（由于幸存区to空间需要始终空着，不能使用，故这里没有算入to空间，因此不满10Mb）</span></span><br><span class="line"> <span class="comment">// used-&gt; 已使用的空</span></span><br><span class="line"> <span class="comment">// [... ... ...)-&gt;内存地址</span></span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 2158K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  <span class="comment">// 伊甸园   空间     已经使用空间                                          </span></span><br><span class="line">  eden space 8192K,  <span class="number">26</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fee1b9a0</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  <span class="comment">// 幸存区from                                    </span></span><br><span class="line">  from space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line">  <span class="comment">// 幸存区  to                             </span></span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line"><span class="comment">// tenured generation 老年代的信息</span></span><br><span class="line"><span class="comment">// total -&gt; 总空间    used-&gt;已经用的空间</span></span><br><span class="line"> tenured generation   total 10240K, used 0K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,   <span class="number">0</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"><span class="comment">// 元空间  --&gt; 不属于堆空的一部分</span></span><br><span class="line"> Metaspace       used 3231K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 350<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Process</span> <span class="title">finished</span> <span class="title">with</span> <span class="title">exit</span> <span class="title">code</span> 0</span></span><br></pre></td></tr></table></figure>
<p><strong>主函数内加入下方代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">// 占用_7MB空间 会导致伊甸园空间不足 会触发一次Minor GC</span></span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_7MB]);</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发生了一次GC--&gt; GC==Minor GC</span></span><br><span class="line"><span class="comment">// DefNew:发生在新手代  </span></span><br><span class="line"><span class="comment">// 1830K-&gt;650K(9216K)：回收前的内存占用-&gt;回收后的内存占用   </span></span><br><span class="line"><span class="comment">// (9216K):新生代总的内存占用    </span></span><br><span class="line"><span class="comment">// 0.0014230 secs：垃圾回收占用时间</span></span><br><span class="line"><span class="comment">// 1830K-&gt;650K(19456K)：整个堆回收前的内存占用-&gt;回收后的内存占用</span></span><br><span class="line"><span class="comment">// (19456K)：堆的总大小</span></span><br><span class="line"><span class="comment">// 0.0014565 secs：回收锁耗费的时间</span></span><br><span class="line">[GC (Allocation Failure) [DefNew: 1830K-&gt;650K(9216K), <span class="number">0.0014230</span> secs] 1830K-&gt;650K(19456K), <span class="number">0.0014565</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 8065K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  <span class="comment">// 此时伊甸园中空间使用了90%</span></span><br><span class="line">  eden space 8192K,  <span class="number">90</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff33d8c0</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  <span class="comment">// 可以看到，此时from中有对象了</span></span><br><span class="line">  from space 1024K,  <span class="number">63</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff5a2b80</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> tenured generation   total 10240K, used 0K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,   <span class="number">0</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 3230K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 350<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>
<p><strong>主函数内代码修改如下：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_7MB]);</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_512KB]);</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [DefNew: 1994K-&gt;650K(9216K), <span class="number">0.0013393</span> secs] 1994K-&gt;650K(19456K), <span class="number">0.0013693</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 8577K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  <span class="comment">// 添加了一个_512KB的byte数组，对比上方代码伊甸园中的内存使用由90%-&gt;96%</span></span><br><span class="line">  eden space 8192K,  <span class="number">96</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff3bd8d0</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space 1024K,  <span class="number">63</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff5a2bb0</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> tenured generation   total 10240K, used 0K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,   <span class="number">0</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 3232K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 350<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>
<p><strong>主函数内代码修改如下：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_7MB]);</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_512KB]);</span><br><span class="line"><span class="comment">// 再放入_512KB，此时伊甸园中的内存必然不够了，再次触发GC</span></span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_512KB]);</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [DefNew: 1830K-&gt;650K(9216K), <span class="number">0.0011813</span> secs] 1830K-&gt;650K(19456K), <span class="number">0.0012089</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"><span class="comment">// 可以看到，再加入_512KB的byte数组，触发了一次新的GC操作</span></span><br><span class="line">[GC (Allocation Failure) [DefNew: 8494K-&gt;512K(9216K), <span class="number">0.0043475</span> secs] 8494K-&gt;8310K(19456K), <span class="number">0.0043671</span> secs] [Times: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 1188K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  <span class="comment">// 伊甸园内存占用情况</span></span><br><span class="line">  eden space 8192K,   <span class="number">8</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000feca90e0</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  <span class="comment">// form区中内存占用情况</span></span><br><span class="line">  from space 1024K,  <span class="number">50</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff480048</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line"> <span class="comment">// 有对象晋升到了老年代中</span></span><br><span class="line"> tenured generation   total 10240K, used 7798K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,  <span class="number">76</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffd9db50</span>, <span class="number">0x00000000ffd9dc00</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 3230K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 350<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>
<p><strong>大对象直接晋升老年代：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">// _8MB对象已经超过了伊甸园的总容量---&gt;直接将对象晋升到老年代中</span></span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 2158K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space 8192K,  <span class="number">26</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fee1b988</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line"> <span class="comment">// 没有触发GC，老年代中已经有对象了，对象在新生代空间不足的情况下，直接晋升老年代</span></span><br><span class="line"> tenured generation   total 10240K, used 8192K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,  <span class="number">80</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffe00010</span>, <span class="number">0x00000000ffe00200</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 3231K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 350<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>
<p><strong>放入的对象超过堆内存容量：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">// 放入的对象超出堆内存容量</span></span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 堆内存溢出的自救</span></span><br><span class="line">[GC (Allocation Failure) [DefNew: 1994K-&gt;650K(9216K), <span class="number">0.0012508</span> secs][Tenured: 8192K-&gt;8841K(10240K), <span class="number">0.0016668</span> secs] 10186K-&gt;8841K(19456K), [Metaspace: 3225K-&gt;3225K(1056768K)], <span class="number">0.0029647</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"><span class="comment">// 堆内存溢出的自救 Full GC</span></span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Allocation Failure)</span> [Tenured: 8841K-&gt;8823<span class="title">K</span><span class="params">(10240K)</span>, 0.0013313 secs] 8841K-&gt;8823<span class="title">K</span><span class="params">(19456K)</span>, [Metaspace: 3225K-&gt;3225<span class="title">K</span><span class="params">(1056768K)</span>], 0.0013494 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"></span><br><span class="line"><span class="comment">// 但是自救失败...堆内存溢出啦！</span></span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at cn.xyc.Demo2_1.main(Demo2_1.java:<span class="number">26</span>)</span><br><span class="line"></span><br><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 246K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space 8192K,   <span class="number">3</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fec3d890</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> tenured generation   total 10240K, used 8823K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,  <span class="number">86</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffe9df98</span>, <span class="number">0x00000000ffe9e000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 3257K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 353<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>
<p><strong>再看一个现象：将上述代码加入线程中</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    ArrayList&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[_8MB]);</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;sleep....&quot;</span>);</span><br><span class="line">Thread.sleep(<span class="number">10000000L</span>);</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sleep....  <span class="comment">// 主线程开始等待，并没有因为线程Thread-0发生了堆内存溢出而结束</span></span><br><span class="line"></span><br><span class="line">[GC (Allocation Failure) [DefNew: 4060K-&gt;856K(9216K), <span class="number">0.0019035</span> secs][Tenured: 8192K-&gt;9046K(10240K), <span class="number">0.0027099</span> secs] 12253K-&gt;9046K(19456K), [Metaspace: 4148K-&gt;4148K(1056768K)], <span class="number">0.0046569</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Allocation Failure)</span> [Tenured: 9046K-&gt;8990<span class="title">K</span><span class="params">(10240K)</span>, 0.0020630 secs] 9046K-&gt;8990<span class="title">K</span><span class="params">(19456K)</span>, [Metaspace: 4148K-&gt;4148<span class="title">K</span><span class="params">(1056768K)</span>], 0.0020911 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line"></span><br><span class="line"><span class="comment">// Thread-0 经过 Minor GC 和 Full GC后，还是内存不足，发生堆内存溢出</span></span><br><span class="line">Exception in thread <span class="string">&quot;Thread-0&quot;</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at cn.xyc.Demo2_1.lambda$main$<span class="number">0</span>(Demo2_1.java:<span class="number">17</span>)</span><br><span class="line">	at cn.xyc.Demo2_1$$Lambda$<span class="number">1</span>/<span class="number">1023892928.</span>run(Unknown Source)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br></pre></td></tr></table></figure>
<p>将<code>Thread.sleep(10000000L);</code>修改为<code>Thread.sleep(1000L);</code>，查看一下主线程的堆使用信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> def <span class="keyword">new</span> generation   total 9216K, used 218K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  eden space 8192K,   <span class="number">2</span>% used [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000fec36b58</span>, <span class="number">0x00000000ff400000</span>)</span><br><span class="line">  from space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff500000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  to   space 1024K,   <span class="number">0</span>% used [<span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff400000</span>, <span class="number">0x00000000ff500000</span>)</span><br><span class="line"> <span class="comment">// 弹幕1：这里占用的空间是抛出OOM之前的内存信息</span></span><br><span class="line"> <span class="comment">// 弹幕2：当一个线程抛出OOM后，它所占据的内存资源会被释放</span></span><br><span class="line"> <span class="comment">// 弹幕3：OOM后会清空线程占用的堆内存</span></span><br><span class="line"> tenured generation   total 10240K, used 8990K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">   the space 10240K,  <span class="number">87</span>% used [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffec7b48</span>, <span class="number">0x00000000ffec7c00</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line"> Metaspace       used 4170K, capacity 4676K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 462<span class="title">K</span>, <span class="title">capacity</span> 496<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br></pre></td></tr></table></figure>
<h2 id="垃圾回收器">4. 垃圾回收器</h2>
<ol type="1">
<li><p><strong>串行</strong></p>
<ul>
<li>单线程</li>
<li>堆内存较小，适合个人电脑，即CPU个数少</li>
</ul></li>
<li><p><strong>吞吐量优先</strong></p>
<ul>
<li>多线程</li>
<li>堆内存较大，多个CPU</li>
<li>让单位时间内， STW（stop the world）的时间最短，垃圾回收时间占比最低，这样就称吞吐量高</li>
</ul>
<blockquote>
<p>例如单位时间内，发生GC有：</p>
<p>0.2 0.2 = 0.4</p>
</blockquote></li>
<li><p><strong>响应时间优先</strong></p>
<ul>
<li>多线程</li>
<li>堆内存较大，多个CPU</li>
<li>尽可能让单次 STW 的时间最短</li>
</ul>
<blockquote>
<p>例如单位时间内，发生GC有：</p>
<p>0.1 0.1 0.1 0.1 0.1 = 0.5</p>
</blockquote></li>
</ol>
<h3 id="串行">4.1 串行</h3>
<p>打开<strong>串行垃圾回收器</strong>的 JVM 参数：<code>-XX:+UseSerialGC = Serial + SerialOld</code></p>
<ul>
<li><strong>Serial：用于新生代，采用复制垃圾回收算法；</strong></li>
<li><strong>SerialOld：用于老年代，采用标记整理算法；</strong></li>
</ul>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/串行.PNG" alt="串行"></p>
<p>触发GC时，使所有线程在一个<strong>安全点</strong>暂停，由于在GC时，对象的地址可能会发生修改；</p>
<p>由于此时Serial，SerialOld都是单线程的垃圾回收器，因此当垃圾回收器线程在运行时，其他线程进入阻塞状态。</p>
<h3 id="吞吐量优先">4.2 吞吐量优先</h3>
<p>需要设置的 JVM 参数：</p>
<ul>
<li><p><code>-XX:+UseParallelGC ~ -XX:+UseParallelOldGC</code>：使用<strong>并行的垃圾回收器</strong></p>
<ul>
<li><code>UseParallelGC</code>：新生代的垃圾回收器</li>
<li><code>UseParallelOldGC</code>：老年代的垃圾回收器</li>
</ul>
<blockquote>
<p>在JDK1.8中默认已经开启，<strong>开启了一个顺带也会开启另一个</strong></p>
</blockquote></li>
<li><p><code>-XX:+UseAdaptiveSizePolicy</code>：使用自适应新生代大小调整策略</p></li>
<li><p><code>-XX:GCTimeRatio=ratio</code> ：用于调整垃圾回收时间与总时间占比</p>
<blockquote>
<p>公式：<code>1/(1+ratio)</code></p>
<p>ratio默认为99，即垃圾回收的时间不能超过总时间的1%</p>
</blockquote></li>
<li><p><code>-XX:MaxGCPauseMillis=ms</code> ：最大暂停时间，默认为 200ms</p></li>
<li><p><code>-XX:ParallelGCThreads=n</code> ：控制垃圾回收线程数</p></li>
</ul>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/吞吐量优先.PNG" alt="吞吐量优先"></p>
<p>触发GC时，使所有线程在一个<strong>安全点</strong>暂停；</p>
<p>垃圾回收器开启多个线程进行垃圾回收，垃圾回收线程数默认情况下与线程个数相关</p>
<h3 id="响应时间优先">4.3 响应时间优先</h3>
<p>需要设置的JVM参数：</p>
<ul>
<li><code>-XX:+UseConcMarkSweepGC ~ -XX:+UseParNewGC ~ SerialOld</code>
<ul>
<li>Conc-&gt;concurrent<strong>并发的</strong>，即用户线程和GC线程是并发执行的<br>
</li>
<li>MarkSweepGC一款基于<strong>标记清除的垃圾回收器</strong></li>
<li>UseConcMarkSweepGC工作于老年代的一款垃圾回收器</li>
<li>UseParNewGC工作于新生代的垃圾回收器</li>
<li>并发失败会退回到SerialOld，即单线程的垃圾回收器，例如内存碎片过多导致并发失败</li>
</ul></li>
<li><code>-XX:ParallelGCThreads=n ~ -XX:ConcGCThreads=threads</code>
<ul>
<li>ParallelGCThreads：并行垃圾回收线程数，一般与CPU核数相同；</li>
<li>ConcGCThreads：并发的垃圾回收线程数，一般建议并行GC线程数的1/4</li>
<li>即若有4个CPU，3个用于用户线程，1个用于并发GC</li>
</ul></li>
<li><code>-XX:CMSInitiatingOccupancyFraction=percent</code>
<ul>
<li>CMSInitiatingOccupancyFraction：执行CMS垃圾回收的内存占比；</li>
<li>例如设置为80%，老年代内存占用达到80%时，就执行一次GC；</li>
<li>出于：在并发清理时会产生一些新的垃圾，称为<strong>浮动垃圾</strong>，而并发清理时不能清理这些浮动垃圾，这些垃圾需要在下一次垃圾清理是被清理，<strong>因此需要预留空间对浮动垃圾进行保存</strong></li>
</ul></li>
<li><code>-XX:+CMSScavengeBeforeRemark</code>
<ul>
<li>在重新标记阶段，会出现新生代的对象会引用老年代的对象；</li>
<li>而在重新标记时，会对整个堆进行扫描，在对新生代做可达性分析时，若新生代对象过多，会对性能造成影响；</li>
<li>使用上述参数<strong>先对新生代做一个GC</strong>，则在重新标记时扫描的对象会减少，可以提升性能。</li>
</ul></li>
</ul>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/响应时间优先.PNG" alt="响应时间优先"></p>
<p><strong>对上图进行说明：即CMS的流程</strong></p>
<p>多线程运行，老年代发生了内存不足，多个线程到达安全点停止运行；</p>
<p>CMS 垃圾回收器开始工作，执行一个<strong>初始标记</strong>的动作(只标记根对象，很快)，<strong>期间需要STW</strong>；</p>
<p>用户线程可以恢复运行，与此同时垃圾回收线程<strong>并发标记</strong>，找出剩余的垃圾对象；</p>
<p>接下来进行<strong>重新标记，需要STW</strong>，因为之前并发执行时，会对垃圾回收的对象造成干扰，因此要做重新标记工作；</p>
<p>重新标记完成后，用户线程恢复运行，垃圾回收线程做一次<strong>并发的清理</strong>。</p>
<h3 id="g1---garbage-one">4.4 G1 - (Garbage One)</h3>
<p>定义：Garbage First</p>
<ul>
<li>2004 论文发布</li>
<li>2009 JDK 6u14 体验</li>
<li>2012 JDK 7u4 官方支持</li>
<li>2017 JDK 9 默认</li>
</ul>
<blockquote>
<p>JDK9 废除了之前的 CMS垃圾回收器</p>
</blockquote>
<p>适用场景</p>
<ul>
<li>同时注重吞吐量（Throughput）和低延迟（Low latency），默认的暂停目标是 200 ms</li>
<li>超大堆内存，会将堆划分为多个大小相等的 Region</li>
<li>整体上是 <strong>标记+整理</strong> 算法，两个区域Region之间是 <strong>复制</strong> 算法</li>
</ul>
<p>相关 JVM 参数</p>
<ul>
<li><code>-XX:+UseG1GC</code>：JDK1.8中需要手动打开，JDK1.9之后为默认</li>
<li><code>-XX:G1HeapRegionSize=size</code>：设置 Region 的大小，只能设置为1,2,4,8,16...等大小</li>
<li><code>-XX:MaxGCPauseMillis=time</code> ：设置暂停目标</li>
</ul>
<h4 id="g1-垃圾回收阶段">1) G1 垃圾回收阶段</h4>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/垃圾回收阶段.PNG" alt="垃圾回收阶段"></p>
<p>阶段1：Yong Collection 新生代垃圾收集</p>
<p>阶段2：Yong Collection+Concurrent Mark 新生代垃圾收集同时做一些并发标记</p>
<p>阶段3：Mixed Collection 混合收集，对新生代和老年代都进行一次大规模收集</p>
<h4 id="young-collection">2) Young Collection</h4>
<p>下面的格子表示一个个的 Region</p>
<p>新生代垃圾收集时会 STW</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection1.PNG" alt="yongcollection1"></p>
<p>内存紧张时，会将伊甸园e中的内容拷贝到幸存区s中</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection2.PNG" alt="yongcollection2"></p>
<p>幸存区中的对象晋升到老年代o中</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection3.PNG" alt="yongcollection3"></p>
<h4 id="young-collection-cm">3) Young Collection + CM</h4>
<p>在 Young GC 时会进行 GC Root 的初始标记</p>
<p>老年代占用堆空间比例达到阈值时，进行并发标记（不会 STW），由下面的 JVM 参数决定</p>
<p><code>-XX:InitiatingHeapOccupancyPerent=percent</code>（默认45%）</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection+CM.PNG" alt="yongcollection+CM"></p>
<h4 id="mixed-collection">4) Mixed Collection</h4>
<p>会对 E、S、O 进行全面垃圾回收</p>
<ul>
<li>最终标记（Remark）会 STW</li>
<li>拷贝存活（Evacuation）会 STW</li>
</ul>
<p><code>-XX:MaxGCPauseMillis=ms</code></p>
<p>会根据设置暂停目标时间，有选择性的回收回收价值最高的区域；</p>
<p>解释了Garbage First，即回<strong>收那些垃圾最多的老年代区域</strong>，从而达到暂定时间的目标</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/MixedCollection.PNG" alt="MixedCollection"></p>
<h4 id="full-gc">5) Full GC</h4>
<ul>
<li>SerialGC
<ul>
<li>新生代内存不足发生的垃圾收集 - Minor GC</li>
<li>老年代内存不足发生的垃圾收集 - Full GC</li>
</ul></li>
<li>ParallelGC
<ul>
<li>新生代内存不足发生的垃圾收集 - Minor GC</li>
<li>老年代内存不足发生的垃圾收集 - Full GC</li>
</ul></li>
<li>CMS
<ul>
<li>新生代内存不足发生的垃圾收集 - Minor GC</li>
<li>老年代内存不足，只有当并发清理速度跟不上产生垃圾速度等情况时，才会触发Full GC</li>
</ul></li>
<li>G1
<ul>
<li>新生代内存不足发生的垃圾收集 - Minor GC</li>
<li>老年代内存不足
<ol type="1">
<li><p>老年代占用堆空间比例达到阈值时，进行并发标记</p></li>
<li><p>Mixed Collection 混合收集</p></li>
<li><p>当并发垃圾回收的速度无法跟上产生垃圾的速度是，并发收集失败，退化为串行收集，即为Full GC</p></li>
</ol></li>
</ul></li>
</ul>
<h4 id="young-collection-跨代引用">6) Young Collection 跨代引用</h4>
<p>新生代回收的跨代引用（老年代引用新生代）问题</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection跨带引用.PNG" alt="yongcollection跨带引用"></p>
<ul>
<li>卡表（将老年代的区域再进行细分为card）与 Remembered Set（记录对于哪一个dirty card）</li>
<li>在引用变更时通过 post-write barrier + dirty card queue</li>
<li>concurrent refinement threads 更新 Remembered Set</li>
</ul>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/yongcollection跨带引用2.PNG" alt="yongcollection跨带引用2"></p>
<h4 id="remark">7) Remark</h4>
<p><code>pre-write barrier + satb_mark_queue</code></p>
<p>写屏障+队列</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark.PNG" alt="remark"></p>
<blockquote>
<p>黑色：已经处理完成，被引用，在结束时会存活下来的对象；</p>
<p>灰色：正在处理当中的，被引用了，处理完成后变黑；</p>
<p>白色：尚未处理的，下方的会被处理变灰再变黑；上面的被处理后还是白色，由于没有被引用被删除</p>
</blockquote>
<p><strong>例子：</strong></p>
<ol type="1">
<li><p>初始状态，正在处理B：</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark1.PNG" alt="remark1"></p></li>
<li><p>在处理B时，由于并发，C和B之间的连接断开：</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark2.PNG" alt="remark2"></p></li>
<li><p>处理完成后C仍然是白色，因此会被垃圾处理掉；</p></li>
<li><p>但是在CB处理完成后，用户又修改了C的引用地址，如下，此时C不应该再被垃圾处理掉了；</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark3.PNG" alt="remark3"></p></li>
<li><p>因此需要对对象的引用做进一步的检查，即remark阶段就是为了防止上述现象发生，做法如下：</p>
<ol type="1">
<li><p>当对象的引用发生改变时，JVM就会为其加入一个写屏障（弹幕：<strong>不是线程的那个，这个应该理解为通知</strong>）</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark4.PNG" alt="remark4"></p></li>
<li><p>当对象的应用发生改变，写屏障的代码就会被执行</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark5.PNG" alt="remark5"></p></li>
<li><p>会把C对象加入一个队列当中，将其变灰，表示还没有处理完</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark6.PNG" alt="remark6"></p></li>
<li><p>当并发标记结束后，进入重新标记阶段，重新标记阶段会STW，此时处理队列中的对象，再做一次检查，这样C就不会被误当成对象被回收了</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/remark7.PNG" alt="remark7"></p></li>
</ol></li>
</ol>
<h4 id="jdk-8u20-字符串去重">8) JDK 8u20 字符串去重</h4>
<p>优点：节省大量内存</p>
<p>缺点：略微多占用了 cpu 时间，新生代回收时间略微增加</p>
<p><code>-XX:+UseStringDeduplication</code>，默认打开的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String s1 = <span class="keyword">new</span> String(<span class="string">&quot;hello&quot;</span>); <span class="comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125;</span></span><br><span class="line">String s2 = <span class="keyword">new</span> String(<span class="string">&quot;hello&quot;</span>); <span class="comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>将所有新分配的字符串放入一个队列</p>
<p>当新生代回收时，G1并发检查是否有字符串重复</p>
<p>如果它们值一样，让它们引用同一个 <code>char[]</code></p>
<p>注意，与 <code>String.intern()</code> 不一样</p>
<ul>
<li><code>String.intern()</code> 关注的是字符串对象</li>
<li>而字符串去重关注的是 <code>char[]</code></li>
<li>在 JVM 内部，使用了不同的字符串表</li>
</ul>
<h4 id="jdk-8u40-并发标记类卸载">9) JDK 8u40 并发标记类卸载</h4>
<p>所有对象都经过并发标记后，就能知道哪些类不再被使用，当一个类加载器的所有类都不再使用，则卸载它所加载的所有类</p>
<p><code>-XX:+ClassUnloadingWithConcurrentMark</code> 默认启用</p>
<h4 id="jdk-8u60-回收巨型对象">10) JDK 8u60 回收巨型对象</h4>
<ul>
<li><p>一个对象大于 region 的一半时，称之为巨型对象，如下方的粉色块</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/巨型对象.PNG" alt="巨型对象"></p></li>
<li><p>G1 不会对巨型对象进行拷贝</p></li>
<li><p>回收时被优先考虑</p></li>
<li><p>G1 会跟踪老年代所有 incoming 引用，这样老年代 incoming 引用为0 的巨型对象就可以在新生代垃圾回收时处理掉</p>
<p><img src="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/巨型对象2.PNG" alt="巨型对象2"></p>
<p>如上图的第一个粉色H，卡表中已经没有对其进行引用了，这个巨型对象可以在新生代垃圾回收时处理掉</p></li>
</ul>
<h4 id="jdk-9-并发标记起始时间的调整">11) JDK 9 并发标记起始时间的调整</h4>
<ul>
<li>并发标记必须在堆空间占满前完成，否则退化为 FullGC</li>
<li>JDK 9 之前需要使用 <code>-XX:InitiatingHeapOccupancyPercent</code></li>
<li>JDK 9 可以动态调整
<ul>
<li><code>-XX:InitiatingHeapOccupancyPercent</code> 用来设置初始值</li>
<li>进行数据采样并动态调整</li>
<li>总会添加一个安全的空档空间</li>
</ul></li>
</ul>
<h4 id="jdk-9-更高效的回收">12) JDK 9 更高效的回收</h4>
<ul>
<li>250+增强</li>
<li><p>180+bug修复</p></li>
<li><p>https://docs.oracle.com/en/java/javase/12/gctuning</p></li>
</ul>
<h2 id="垃圾回收调优">5. 垃圾回收调优</h2>
<p>预备知识</p>
<ul>
<li>掌握 GC 相关的 JVM 参数，会基本的空间调整</li>
<li>掌握相关工具</li>
<li>明白一点：调优跟应用、环境有关，没有放之四海而皆准的法则</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查看虚拟机运行参数</span></span><br><span class="line"><span class="comment">C:\Users\ZhuCC&gt;&quot;C:\Software\Java\jdk1.8.0_241\bin\java&quot; -XX:+PrintFlagsFinal -version | findstr &quot;GC&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2_8</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出与垃圾回收有关的JVM参数</p>
<h3 id="调优领域">5.1 调优领域</h3>
<ul>
<li>内存</li>
<li>锁竞争</li>
<li>cpu 占用</li>
<li>io</li>
</ul>
<h3 id="确定目标">5.2 确定目标</h3>
<ul>
<li>【低延迟】还是【高吞吐量】，选择合适的回收器</li>
<li>低延迟：CMS，G1，ZGC</li>
<li>高吞吐量：ParallelGC</li>
<li>Zing</li>
</ul>
<h3 id="最快的-gc">5.3 最快的 GC</h3>
<p><strong>最快的 GC 就是不发生 GC...</strong></p>
<p>查看 FullGC 前后的内存占用，考虑下面几个问题</p>
<ul>
<li>数据是不是太多？
<ul>
<li><code>resultSet = statement.executeQuery(&quot;select * from 大表 limit n&quot;);</code></li>
</ul></li>
<li>数据表示是否太臃肿？
<ul>
<li>对象图</li>
<li>对象大小：
<ul>
<li>一个Object最小也要占用16byte</li>
<li>Integer包装类型，一个对象头占用16个字节，4个字节的值，加上对其，总共占用24个字节</li>
<li>int只需要占用4个字节</li>
</ul></li>
</ul></li>
<li>是否存在内存泄漏？
<ul>
<li><code>static Map map =</code>，频繁向里面添加对象</li>
<li>软/弱引用---&gt;在内存耗尽时会被GC</li>
<li>第三方缓存实现，Redis...</li>
</ul></li>
</ul>
<h3 id="新生代调优">5.4 新生代调优</h3>
<p>新生代的特点：</p>
<ul>
<li>所有的 new 操作的内存分配非常廉价
<ul>
<li>TLAB thread-local allocation buffer，每个线程在伊甸园中分配的一块线程局部私有缓冲区域</li>
<li>在分配时，首先检查TLAB中是否有可用内存，优先在此进行对象分配</li>
<li>考虑到多线程在分配时的线程安全问题</li>
</ul></li>
<li>死亡对象的回收代价是零</li>
<li>大部分对象用过即死</li>
<li>Minor GC 的时间远远低于 Full GC</li>
</ul>
<p><strong>新生代调优：</strong></p>
<ul>
<li><p>新生代是不是越大越好？</p>
<p>-Xmn Sets the initial and maximum size (in bytes) of the heap for the young generation (nursery). GC is performed in this region more often than in other regions. If the size for the young generation is too small, then a lot of minor garbage collections are performed. If the size is too large, then only full garbage collections are performed, which can take a long time to complete. Oracle recommends that you keep the size for the young generation greater than 25% and less than 50% of the overall heap size.</p>
<p>翻译：</p>
<p>-Xmn 设置了堆中新生代的初始大小和最大大小（以字节为单位）。GC在这个区域比在其他区域更频繁地执行。如果新生代的大小太小，则会执行大量小的垃圾收集。如果太大，则会Full GC，这可能需要很长时间才能完成。Oracle建议将新生代的设置为堆总尺寸的25%~50%之间。</p>
<blockquote>
<p>补充：</p>
<p>总的原则还是将新生代的大小调的尽可能大；</p>
<p>考虑到新生代垃圾回收采用的复制算法，复制算法的两个阶段：1.标记；2.复制（耗费更多时间，设计到对象的移动，对象地址的更新）；</p>
<p>而新生代中绝大部分对象都是“朝生夕死”的，只有少量的对象能存活，因此复制所占用的时间也相对较短，而标记占占用时间更少；</p>
<p>因此即使新生代占用空间很大，也不会造成明显的性能下降。</p>
</blockquote></li>
<li><p>新生代大小的理想情况：新生代能容纳所有【并发量 * (一次响应和请求过程中所产生的对象)】的数据；</p></li>
<li><p>幸存区大小设置：幸存区大到能保留【当前活跃对象+需要晋升对象】</p></li>
<li><p>晋升阈值配置得当，让长时间存活对象尽快晋升</p>
<ul>
<li><p><code>-XX:MaxTenuringThreshold=threshold</code>：调整最大晋升阈值</p></li>
<li><p><code>-XX:+PrintTenuringDistribution</code> ：打印晋升的详细信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Desired survivor size <span class="number">48286924</span> bytes, <span class="keyword">new</span> threshold <span class="number">10</span> (max <span class="number">10</span>)</span><br><span class="line"><span class="comment">//  年龄         占用空间</span></span><br><span class="line">- age <span class="number">1</span>: <span class="number">28992024</span> bytes, <span class="number">28992024</span> total</span><br><span class="line">- age <span class="number">2</span>: <span class="number">1366864</span> bytes, <span class="number">30358888</span> total</span><br><span class="line">- age <span class="number">3</span>: <span class="number">1425912</span> bytes, <span class="number">31784800</span> total</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul>
<h3 id="老年代调优">5.5 老年代调优</h3>
<p>以 CMS 为例：</p>
<ul>
<li>CMS 的老年代内存越大越好
<ul>
<li>CMS垃圾回收器是一个并发的垃圾回收器，在垃圾回收器工作同时，用户的其他线程也可以运行</li>
<li>但是在用户的其他线程运行期间会产生新的浮动垃圾，若此时又造成了内存不足，会导致CMS并发失败</li>
<li>CMS并发失败，则退回到SerialOld串行垃圾回收器，导致STW，运行效率下降明显</li>
<li>因此老年代内存越大越好</li>
</ul></li>
<li>先尝试不做调优，如果没有 Full GC，那系统其实工作的还行，即使发生了Full GC 也应该先尝试调优新生代</li>
<li>观察发生 Full GC 时老年代内存占用，将老年代内存预设调大 1/4 ~ 1/3
<ul>
<li><code>-XX:CMSInitiatingOccupancyFraction=percent</code>：控制老年代内存占用达到percent比例时，启用CMS垃圾回收</li>
</ul></li>
</ul>
<h3 id="案例">5.6 案例</h3>
<h4 id="案例1">案例1</h4>
<p>Full GC 和 Minor GC频繁</p>
<p>分析：GC频繁说明空间紧张</p>
<ol type="1">
<li>若新生代空间紧张，很快被新创建的对象占满，Minor GC频繁发生，导致幸存区对象的晋升阈值降低，一些生命周期较短的对象也晋升到了老年代中；</li>
<li>幸存区对象晋升阈值降低，会导致老年代中的空间紧张，导致Full GC频繁发生；</li>
</ol>
<p>解决：一般从先调整新生代开始，增大新生代内存；</p>
<h4 id="案例2">案例2</h4>
<p>请求高峰期发生 Full GC，单次暂停时间特别长 （CMS）</p>
<p>分析：</p>
<ol type="1">
<li><p>CMS垃圾回收分为：1.初始标记；2.并发标记；3.重新标记；4.并发清理</p></li>
<li>其中重新标记占用最长时间</li>
<li>在重新标记阶段，会扫描整个堆内存（新生代+老年代）</li>
<li><p>若此时新生代对象个数较多，会使标记时间增大</p></li>
</ol>
<p>解决：在重新标记之前，先对新生代中的对象做一次清理，即通过<code>-XX:+CMSScavengeBeforeRemark</code>参数，则在重新标记阶段，需要重新标记的对象大大减少，能解决单次暂停时间特别长的问题</p>
<h4 id="案例3">案例3</h4>
<p>老年代充裕情况下，发生 Full GC （CMS jdk1.7）</p>
<p>分析：</p>
<ol type="1">
<li><p>JDK1.7 之前通过永久代作为方法区的实现；</p></li>
<li><p>永久代中空间不足也会造成Full GC的发生；</p>
<blockquote>
<p>JDK1.8之后修改为元空间，使用的是系统空间，其垃圾回收不由Java控制</p>
</blockquote></li>
</ol>
<p>解决：通过相应参数，增大永久代的空间大小</p>

    </div>

    
    
    
	
	<div>
		
			<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

<div>
    
       <div style="text-align:center;color:#bfbfbf;font-size:16px;">
             <span>--- 本文结束 </span>
             <i class="fa fa-thumbs-o-up"></i>
             <span> 感谢阅读 ---</span>
       </div>
    
</div>
		
	</div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JVM/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> JVM</a>
              <a href="/tags/Java/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> Java</a>
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> 学习笔记</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/09/06/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" rel="prev" title="JVM：内存结构">
      <i class="fa fa-chevron-left"></i> JVM：内存结构
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/13/JVM/JVM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JVM%EF%BC%9A%E7%B1%BB%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF-1/" rel="next" title="JVM：类加载与字节码技术-1">
      JVM：类加载与字节码技术-1 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="nav-text">JVM：垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9"><span class="nav-text">内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E5%8F%AF%E4%BB%A5%E5%9B%9E%E6%94%B6"><span class="nav-text">1. 如何判断对象可以回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%B3%95"><span class="nav-text">1.1 引用计数法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95"><span class="nav-text">1.2 可达性分析算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8"><span class="nav-text">1.3 四种引用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%94%E7%A4%BA%E8%BD%AF%E5%BC%95%E7%94%A8"><span class="nav-text">演示软引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%94%E7%A4%BA%E5%BC%B1%E5%BA%94%E7%94%A8"><span class="nav-text">演示弱应用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"><span class="nav-text">2. 垃圾回收算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4"><span class="nav-text">2.1 标记清除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86"><span class="nav-text">2.2 标记整理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E6%8B%B7%E8%B4%9D"><span class="nav-text">2.3 复制拷贝</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E4%BB%A3%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="nav-text">3. 分代垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3-vm-%E5%8F%82%E6%95%B0"><span class="nav-text">3.1 相关 VM 参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A1%88%E4%BE%8B"><span class="nav-text">3.2 垃圾回收案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="nav-text">4. 垃圾回收器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%B2%E8%A1%8C"><span class="nav-text">4.1 串行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%9E%E5%90%90%E9%87%8F%E4%BC%98%E5%85%88"><span class="nav-text">4.2 吞吐量优先</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E4%BC%98%E5%85%88"><span class="nav-text">4.3 响应时间优先</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#g1---garbage-one"><span class="nav-text">4.4 G1 - (Garbage One)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#g1-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E9%98%B6%E6%AE%B5"><span class="nav-text">1) G1 垃圾回收阶段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#young-collection"><span class="nav-text">2) Young Collection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#young-collection-cm"><span class="nav-text">3) Young Collection + CM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mixed-collection"><span class="nav-text">4) Mixed Collection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#full-gc"><span class="nav-text">5) Full GC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#young-collection-%E8%B7%A8%E4%BB%A3%E5%BC%95%E7%94%A8"><span class="nav-text">6) Young Collection 跨代引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#remark"><span class="nav-text">7) Remark</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jdk-8u20-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8E%BB%E9%87%8D"><span class="nav-text">8) JDK 8u20 字符串去重</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jdk-8u40-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E7%B1%BB%E5%8D%B8%E8%BD%BD"><span class="nav-text">9) JDK 8u40 并发标记类卸载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jdk-8u60-%E5%9B%9E%E6%94%B6%E5%B7%A8%E5%9E%8B%E5%AF%B9%E8%B1%A1"><span class="nav-text">10) JDK 8u60 回收巨型对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jdk-9-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E8%B5%B7%E5%A7%8B%E6%97%B6%E9%97%B4%E7%9A%84%E8%B0%83%E6%95%B4"><span class="nav-text">11) JDK 9 并发标记起始时间的调整</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jdk-9-%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84%E5%9B%9E%E6%94%B6"><span class="nav-text">12) JDK 9 更高效的回收</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%B0%83%E4%BC%98"><span class="nav-text">5. 垃圾回收调优</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E4%BC%98%E9%A2%86%E5%9F%9F"><span class="nav-text">5.1 调优领域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E7%9B%AE%E6%A0%87"><span class="nav-text">5.2 确定目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%BF%AB%E7%9A%84-gc"><span class="nav-text">5.3 最快的 GC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E7%94%9F%E4%BB%A3%E8%B0%83%E4%BC%98"><span class="nav-text">5.4 新生代调优</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%80%81%E5%B9%B4%E4%BB%A3%E8%B0%83%E4%BC%98"><span class="nav-text">5.5 老年代调优</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B"><span class="nav-text">5.6 案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B1"><span class="nav-text">案例1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B2"><span class="nav-text">案例2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B3"><span class="nav-text">案例3</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhuCC"
      src="/images/%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">ZhuCC</p>
  <div class="site-description" itemprop="description">不急不躁。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">201</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
	  
	  
        <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
        <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
        <div class="widget-wrap">
            <div id="myCanvasContainer" class="widget tagcloud">
                <canvas width="250" height="250" id="resCanvas" style="width=100%">
                    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activiti/" rel="tag">Activiti</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anaconda/" rel="tag">Anaconda</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arthas/" rel="tag">Arthas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAT/" rel="tag">CAT</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CompletableFuture/" rel="tag">CompletableFuture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/" rel="tag">ELK</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearck/" rel="tag">Elasticsearck</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/" rel="tag">GPU</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/" rel="tag">GitHub</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitee/" rel="tag">Gitee</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Groovy/" rel="tag">Groovy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/" rel="tag">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">76</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%9F%BA%E7%A1%80/" rel="tag">Java基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E8%AF%AD%E6%B3%95/" rel="tag">Java语法</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K%E8%BF%91%E9%82%BB/" rel="tag">K近邻</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lombok/" rel="tag">Lombok</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mock/" rel="tag">Mock</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/" rel="tag">Mockito</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSS/" rel="tag">OSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/" rel="tag">OpenCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optional/" rel="tag">Optional</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSM/" rel="tag">SSM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/" rel="tag">SpringMVC</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/" rel="tag">TensorFlow</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadLocal/" rel="tag">ThreadLocal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TortoiseGit/" rel="tag">TortoiseGit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TransmittableThreadLocal/" rel="tag">TransmittableThreadLocal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvidia/" rel="tag">nvidia</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/" rel="tag">全文检索</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/" rel="tag">决策树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/" rel="tag">分类问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98/" rel="tag">刷题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">刷题笔记</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" rel="tag">博客搭建</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%82%E8%80%83%E6%96%87%E4%BB%B6/" rel="tag">参考文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">基础知识</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a><span class="tag-list-count">106</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/" rel="tag">工作流</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">并发编程</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" rel="tag">开发框架</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/" rel="tag">持久层框架</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/" rel="tag">支持向量机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6%E6%8E%A8%E5%AF%BC/" rel="tag">数学推导</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" rel="tag">数据清洗</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" rel="tag">日志框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E7%BB%93%E6%9E%84/" rel="tag">树结构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E8%A7%A3/" rel="tag">注解</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" rel="tag">测试工具</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/" rel="tag">特征选择</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" rel="tag">环境配置</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" rel="tag">线性回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%81%9A%E7%B1%BB/" rel="tag">聚类</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%A8%E7%A4%BA%E5%B1%82/" rel="tag">表示层</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E8%B7%AF/" rel="tag">计算机网路</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E7%94%A8%E9%93%BE%E7%9B%91%E6%8E%A7/" rel="tag">调用链监控</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9D%E5%8F%B6%E6%96%AF/" rel="tag">贝叶斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/" rel="tag">软件使用</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" rel="tag">逻辑回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88%E7%B1%BB/" rel="tag">集合类</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/" rel="tag">集成学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E7%BB%8F/" rel="tag">面经</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0/" rel="tag">面试笔记</a><span class="tag-list-count">59</span></li></ul>
                </canvas>
            </div>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhuCC</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">3.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">56:40</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '3it0tVBbppFeFBVa8QgB3vxM-gzGzoHsz',
      appKey     : '9VtnMWSrhAtC1pSRaA4Rivx9',
      placeholder: "请多多指教~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
