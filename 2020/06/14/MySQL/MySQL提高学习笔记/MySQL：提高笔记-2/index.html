<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Mario.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Mario.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="之前学了一波 MySQL 在使用层面的内容，现在则将其进行一步升华，稍稍深入的学习一些 MySQL 的内部实现等进阶知识点，这当然也是跟着视频学习时做的笔记，课程地址：MySQL入门到精通，笔记总共分为5篇，此为 2&#x2F;5，其余地址如下：  MySQL：提高笔记-1 MySQL：提高笔记-2 MySQL：提高笔记-3 MySQL：提高笔记-4 MySQL：提高笔记-5">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL：提高笔记-2">
<meta property="og:url" content="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/index.html">
<meta property="og:site_name" content="贤余超">
<meta property="og:description" content="之前学了一波 MySQL 在使用层面的内容，现在则将其进行一步升华，稍稍深入的学习一些 MySQL 的内部实现等进阶知识点，这当然也是跟着视频学习时做的笔记，课程地址：MySQL入门到精通，笔记总共分为5篇，此为 2&#x2F;5，其余地址如下：  MySQL：提高笔记-1 MySQL：提高笔记-2 MySQL：提高笔记-3 MySQL：提高笔记-4 MySQL：提高笔记-5">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/MySQL的体系结构概览.jpg">
<meta property="og:image" content="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/存储引擎.png">
<meta property="og:image" content="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/merge搜索引擎.png">
<meta property="og:image" content="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/explain分析环境准备.png">
<meta property="article:published_time" content="2020-06-14T02:24:20.000Z">
<meta property="article:modified_time" content="2020-06-14T02:24:20.000Z">
<meta property="article:author" content="ZhuCC">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/MySQL的体系结构概览.jpg">

<link rel="canonical" href="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MySQL：提高笔记-2 | 贤余超</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	<a target="_blank" rel="noopener" href="https://github.com/zhuChengChao" class="github-corner" aria-label="View source on GitHub">
	<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
	<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
	<path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
	<path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
	</svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">贤余超</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一位底层码农 :-)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">100</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">18</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">209</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="ZhuCC">
      <meta itemprop="description" content="不急不躁。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="贤余超">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL：提高笔记-2
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-14 10:24:20" itemprop="dateCreated datePublished" datetime="2020-06-14T10:24:20+08:00">2020-06-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>29k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>26 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>之前学了一波 MySQL 在使用层面的内容，现在则将其进行一步升华，稍稍深入的学习一些 MySQL 的内部实现等进阶知识点，这当然也是跟着视频学习时做的笔记，课程地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1zJ411M7TB">MySQL入门到精通</a>，笔记总共分为5篇，此为 <strong>2/5</strong>，其余地址如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-1/">MySQL：提高笔记-1</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/">MySQL：提高笔记-2</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-3/">MySQL：提高笔记-3</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/06/21/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-4/">MySQL：提高笔记-4</a></li>
<li><a target="_blank" rel="noopener" href="https://xianyuchao.cn/2020/06/21/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-5/">MySQL：提高笔记-5</a></li>
</ul>
<span id="more"></span>
<h1 id="mysql提高笔记-2">MySQL：提高笔记-2</h1>
<blockquote>
<p>说明：这是根据 bilibili 上 <strong><a target="_blank" rel="noopener" href="https://space.bilibili.com/37974444">黑马程序员</a></strong> 的课程 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1zJ411M7TB">mysql入门到精通</a> 后做的笔记</p>
</blockquote>
<h2 id="mysql的体系结构概览">1. MySQL的体系结构概览</h2>
<p><img src="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/MySQL的体系结构概览.jpg" alt="MySQL的体系结构概览"></p>
<p>整个MySQL Server由以下组成</p>
<ul>
<li>Connection Pool : 连接池组件</li>
<li>Management Services &amp; Utilities : 管理服务和工具组件</li>
<li>SQL Interface : SQL接口组件</li>
<li>Parser : 查询分析器组件</li>
<li>Optimizer : 优化器组件</li>
<li>Caches &amp; Buffers : 缓冲池组件</li>
<li>Pluggable Storage Engines : 存储引擎</li>
<li>File System : 文件系统</li>
</ul>
<p>1） <strong>连接层</strong></p>
<p>最上层是一些客户端和链接服务，包含本地 sock 通信和大多数基于客户端/服务端工具实现的类似于 TCP/IP 的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p>
<p>2） <strong>服务层</strong></p>
<p>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如 过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定表的查询的顺序，是否利用索引等，最后生成相应的执行操作。如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。</p>
<p>3） <strong>引擎层</strong></p>
<p>存储引擎层， 存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。</p>
<p>4）<strong>存储层</strong></p>
<p>数据存储层， 主要是将数据存储在文件系统之上，并完成与存储引擎的交互。</p>
<p>和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。<strong>主要体现在存储引擎上，插件式的存储引擎架构</strong>，将查询处理和其他的系统任务以及数据的存储提取分离。这种架构可以根据业务的需求和实际需要选择合适的存储引擎。</p>
<h2 id="存储引擎">2. 存储引擎</h2>
<h3 id="存储引擎概述">2.1 存储引擎概述</h3>
<p>和大多数的数据库不同，MySQL中有一个存储引擎的概念，针对不同的存储需求可以选择最优的存储引擎。</p>
<p>存储引擎就是存储数据，建立索引，更新查询数据等等技术的实现方式 。<strong>存储引擎是基于表的</strong>，而不是基于库的。所以存储引擎也可被称为表类型。</p>
<p>Oracle，SqlServer 等数据库只有一种存储引擎。<strong>MySQL提供了插件式的存储引擎架构</strong>。所以MySQL存在多种存储引擎，可以根据需要使用相应引擎，或者编写存储引擎。</p>
<p>MySQL5.0支持的存储引擎包含 ： InnoDB 、MyISAM 、BDB、MEMORY、MERGE、EXAMPLE、NDB Cluster、ARCHIVE、CSV、BLACKHOLE、FEDERATED等，其中 InnoDB 和 BDB 提供事务安全表，其他存储引擎是非事务安全表。</p>
<p>可以通过指定 <code>show engines</code>，来查询当前数据库支持的存储引擎 ：</p>
<p><img src="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/存储引擎.png" alt="存储引擎"></p>
<p>创建新表时如果不指定存储引擎，那么系统就会使用默认的存储引擎，MySQL5.5之前的默认存储引擎是 MyISAM，<strong>5.5之后就改为了InnoDB</strong>。</p>
<p>查看Mysql数据库默认的存储引擎，指令 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> show variables like &#x27;%storage_engine%&#x27;;</span><br><span class="line"> </span><br><span class="line"> mysql&gt;  show variables like &#x27;%storage_engine%&#x27;;</span><br><span class="line">+------------------------+--------+</span><br><span class="line">| Variable_name          | Value  |</span><br><span class="line">+------------------------+--------+</span><br><span class="line">| default_storage_engine | InnoDB |</span><br><span class="line">| storage_engine         | InnoDB |</span><br><span class="line">+------------------------+--------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h3 id="各种存储引擎特性">2.2 各种存储引擎特性</h3>
<p>下面重点介绍几种常用的存储引擎，并对比各个存储引擎之间的区别，如下表所示 ：</p>
<table>
<thead>
<tr class="header">
<th>特点</th>
<th>InnoDB</th>
<th>MyISAM</th>
<th>MEMORY</th>
<th>MERGE</th>
<th>NDB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>存储限制</td>
<td>64TB</td>
<td>有</td>
<td>有</td>
<td>没有</td>
<td>有</td>
</tr>
<tr class="even">
<td>事务安全</td>
<td><strong>支持</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>锁机制</td>
<td><strong>行锁(适合高并发)</strong></td>
<td>表锁</td>
<td>表锁</td>
<td>表锁</td>
<td><strong>行锁</strong></td>
</tr>
<tr class="even">
<td>B树索引</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr class="odd">
<td>哈希索引</td>
<td></td>
<td></td>
<td><strong>支持</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>全文索引</td>
<td>支持(5.6版本之后)</td>
<td>支持</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>集群索引</td>
<td>支持</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>数据索引</td>
<td>支持</td>
<td></td>
<td>支持</td>
<td></td>
<td>支持</td>
</tr>
<tr class="odd">
<td>索引缓存</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr class="even">
<td>数据可压缩</td>
<td></td>
<td><strong>支持</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>空间使用</td>
<td>高</td>
<td>低</td>
<td>N/A</td>
<td>低</td>
<td>低</td>
</tr>
<tr class="even">
<td>内存使用</td>
<td>高</td>
<td>低</td>
<td>中等</td>
<td>低</td>
<td>高</td>
</tr>
<tr class="odd">
<td>批量插入速度</td>
<td>低</td>
<td>高</td>
<td>高</td>
<td>高</td>
<td>高</td>
</tr>
<tr class="even">
<td>支持外键</td>
<td><strong>支持</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>下面我们将重点介绍最长使用的两种存储引擎： InnoDB、MyISAM，另外两种 MEMORY、MERGE，了解即可。</p>
<h4 id="innodb">2.2.1 InnoDB</h4>
<p>InnoDB存储引擎是MySQL的默认存储引擎。<strong>InnoDB存储引擎提供了具有提交、回滚、崩溃恢复能力的事务安全</strong>。但是对比MyISAM的存储引擎，InnoDB写的处理效率差一些，并且会占用更多的磁盘空间以保留数据和索引。</p>
<p>InnoDB存储引擎不同于其他存储引擎的特点 ：</p>
<p><strong>事务控制</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 建表</span><br><span class="line">create table goods_innodb(</span><br><span class="line">	id int NOT NULL AUTO_INCREMENT,</span><br><span class="line">	name varchar(20) NOT NULL,</span><br><span class="line">    primary key(id)</span><br><span class="line">)ENGINE=innodb DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- 开始事物 操作 提交</span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line">insert into goods_innodb(id,name)values(null,&#x27;Meta20&#x27;);</span><br><span class="line"></span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line">-- 示例</span><br><span class="line">mysql&gt; START TRANSACTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO goods_innodb(id,NAME)VALUES(NULL,&#x27;Meta20&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; COMMIT;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>测试，发现在InnoDB中是存在事务的 ;</p>
<p><strong>外键约束</strong></p>
<p><strong>MySQL支持外键的存储引擎只有InnoDB</strong>，在创建外键的时候，要求父表必须有对应的索引，子表在创建外键的时候，也会自动的创建对应的索引。</p>
<p>下面两张表中，country_innodb是父表，country_id为主键索引，city_innodb表是子表，country_id字段为外键，对应于country_innodb表的主键country_id 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 建表</span><br><span class="line">create table country_innodb(</span><br><span class="line">	country_id int NOT NULL AUTO_INCREMENT,</span><br><span class="line">    country_name varchar(100) NOT NULL,</span><br><span class="line">    primary key(country_id)</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">create table city_innodb(</span><br><span class="line">	city_id int NOT NULL AUTO_INCREMENT,</span><br><span class="line">    city_name varchar(50) NOT NULL,</span><br><span class="line">    country_id int NOT NULL,</span><br><span class="line">    primary key(city_id),</span><br><span class="line">    -- 建立索引</span><br><span class="line">    key idx_fk_country_id(country_id),</span><br><span class="line">    -- 建立外键</span><br><span class="line">    CONSTRAINT `fk_city_country` FOREIGN KEY(country_id) REFERENCES country_innodb(country_id) ON DELETE RESTRICT ON UPDATE CASCADE</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- 插入数据</span><br><span class="line">insert into country_innodb values(null,&#x27;China&#x27;),(null,&#x27;America&#x27;),(null,&#x27;Japan&#x27;);</span><br><span class="line">insert into city_innodb values(null,&#x27;Xian&#x27;,1),(null,&#x27;NewYork&#x27;,2),(null,&#x27;BeiJing&#x27;,1);</span><br></pre></td></tr></table></figure>
<p>在创建索引时， 可以指定在删除、更新父表时，对子表进行的相应操作，包括 <code>RESTRICT</code>、<code>CASCADE</code>、<code>SET NULL</code> 和 <code>NO ACTION</code>。</p>
<p><code>RESTRICT</code>和<code>NO ACTION</code>相同， 是指限制在子表有关联记录的情况下， 父表不能更新；</p>
<p><code>CASCADE</code>表示父表在更新或者删除时，更新或者删除子表对应的记录；</p>
<p><code>SET NULL</code> 则表示父表在更新或者删除的时候，子表的对应字段被<code>SET NULL</code>。</p>
<p>针对上面创建的两个表，子表的外键指定是<code>ON DELETE RESTRICT ON UPDATE CASCADE</code> 方式的， 那么在主表删除记录的时候， 如果子表有对应记录， 则不允许删除， 主表在更新记录的时候， 如果子表有对应记录， 则子表对应更新 。</p>
<p>表中数据如下图所示 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from city_innodb;</span><br><span class="line">+---------+-----------+------------+</span><br><span class="line">| city_id | city_name | country_id |</span><br><span class="line">+---------+-----------+------------+</span><br><span class="line">|       1 | Xian      |          1 |</span><br><span class="line">|       2 | NewYork   |          2 |</span><br><span class="line">|       3 | BeiJing   |          1 |</span><br><span class="line">+---------+-----------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from country_innodb;</span><br><span class="line">+------------+--------------+</span><br><span class="line">| country_id | country_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">|          1 | China        |</span><br><span class="line">|          2 | America      |</span><br><span class="line">|          3 | Japan        |</span><br><span class="line">+------------+--------------+</span><br><span class="line">3 rows in set (0.00 sec) </span><br></pre></td></tr></table></figure>
<p>外键信息可以使用如下两种方式查看 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">show create table city_innodb;</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table city_innodb;</span><br><span class="line">+-------------+-----------------+</span><br><span class="line">| Table       | Create Table    |</span><br><span class="line">+-------------+-----------------+</span><br><span class="line">| city_innodb | CREATE TABLE `city_innodb` (</span><br><span class="line">  `city_id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `city_name` varchar(50) NOT NULL,</span><br><span class="line">  `country_id` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`city_id`),</span><br><span class="line">  KEY `idx_fk_country_id` (`country_id`),</span><br><span class="line">  CONSTRAINT `fk_city_country` FOREIGN KEY (`country_id`) REFERENCES `country_innodb` (`country_id`) ON UPDATE CASCADE</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8 |</span><br><span class="line">+-------------+-----------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>删除country_id为1 的country数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from country_innodb where country_id = 1;</span><br><span class="line">-- 报错，a foreign key constraint 有一个外键的限定</span><br><span class="line">ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`db1`.`city_innodb`, CONSTRAINT `fk_city_country` FOREIGN KEY (`country_id`) REFERENCES `country_innodb` (`country_id`) ON UPDATE CASCADE) </span><br></pre></td></tr></table></figure>
<p>更新主表country表的字段 country_id :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update country_innodb set country_id = 100 where country_id = 1;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">-- 更新后， 子表的数据信息为:</span><br><span class="line">mysql&gt; select * from city_innodb;</span><br><span class="line">+---------+-----------+------------+</span><br><span class="line">| city_id | city_name | country_id |</span><br><span class="line">+---------+-----------+------------+</span><br><span class="line">|       1 | Xian      |        100 |</span><br><span class="line">|       2 | NewYork   |          2 |</span><br><span class="line">|       3 | BeiJing   |        100 |</span><br><span class="line">+---------+-----------+------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><strong>存储方式</strong></p>
<p>InnoDB 存储表和索引有以下两种方式 ：</p>
<ol type="1">
<li><p>使用共享表空间存储， 这种方式创建的表的表结构保存在 <code>.frm</code> 文件中， 数据和索引保存在 innodb_data_home_dir 和 innodb_data_file_path定义的表空间中，可以是多个文件。</p></li>
<li><p>使用多表空间存储， 这种方式创建的表的表结构仍然存在 <code>.frm</code> 文件中，但是每个表的数据和索引单独保存在 <code>.ibd</code> 中。</p></li>
</ol>
<h4 id="myisam">2.2.2 MyISAM</h4>
<p>MyISAM 不支持事务、也不支持外键，<strong>其优势是访问的速度快</strong>，对事务的完整性没有要求或者以 SELECT、INSERT 为主的应用基本上都可以使用这个引擎来创建表 。</p>
<p>有以下两个比较重要的特点：</p>
<p><strong>不支持事务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- 建表</span><br><span class="line">create table goods_myisam(</span><br><span class="line">	id int NOT NULL AUTO_INCREMENT,</span><br><span class="line">	name varchar(20) NOT NULL,</span><br><span class="line">    primary key(id)</span><br><span class="line">)ENGINE=myisam DEFAULT CHARSET=utf8;  -- 使用myisam存储引擎</span><br><span class="line"></span><br><span class="line">-- 查看是是否支持事物</span><br><span class="line">mysql&gt; start transaction;  -- 开启事物</span><br><span class="line">Query OK, 0 rows affected (0.00 sec) </span><br><span class="line"></span><br><span class="line">mysql&gt; insert into goods_myisam values(null, &#x27;computer&#x27;);  -- 在事物中插入数据</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; rollback;  -- 事物回滚</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from goods_myisam;  -- 查表，发现数据居然添加成功了</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | computer |</span><br><span class="line">+----+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>通过测试，我们发现，在MyISAM存储引擎中，是没有事务控制的 ；</p>
<p><strong>文件存储方式</strong></p>
<p>每个 MyISAM 在磁盘上存储成3个文件，其文件名都和表名相同，但拓展名分别是 ：</p>
<p><code>.frm</code> (存储表定义)；</p>
<p><code>.MYD</code> (MYData , 存储数据)；</p>
<p><code>.MYI</code> (MYIndex , 存储索引)；</p>
<h4 id="memory">2.2.3 MEMORY</h4>
<p>Memory 存储引擎将<strong>表的数据存放在内存</strong>中。每个 MEMORY 表实际对应一个磁盘文件，格式是 <code>.frm</code>，该文件中只存储表的结构，而其数据文件，都是存储在内存中，这样有利于数据的快速处理，提高整个表的效率。MEMORY 类型的表访问非常地快，因为他的数据是存放在内存中的，并且默认使用 HASH 索引，但是服务一旦关闭，表中的数据就会丢失。</p>
<h4 id="merge">2.2.4 MERGE</h4>
<p>MERGE存储引擎是<strong>一组MyISAM表的组合</strong>，这些MyISAM表必须结构完全相同，<strong>MERGE表本身并没有存储数据</strong>，对MERGE类型的表可以进行查询、更新、删除操作，这些操作实际上是对内部的MyISAM表进行的。</p>
<p>对于MERGE类型表的插入操作，是通过 <code>INSERT_METHOD</code> 子句定义插入的表，可以有3个不同的值，使用 <code>FIRST</code> 或 <code>LAST</code> 值使得插入操作被相应地作用在第一或者最后一个表上，不定义这个子句或者定义为 <code>NO</code>，表示不能对这个MERGE表执行插入操作。</p>
<p>可以对MERGE表进行DROP操作，但是这个操作只是删除MERGE表的定义，对内部的表是没有任何影响的。</p>
<p><img src="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/merge搜索引擎.png" alt="merge搜索引擎"></p>
<p>下面是一个创建和使用MERGE表的示例 ：</p>
<ol type="1">
<li>创建3个测试表 order_1990, order_1991, order_all , 其中order_all是前两个表的MERGE表 ：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- myisam 搜索引擎 的表</span><br><span class="line">create table order_1990(</span><br><span class="line">	order_id int ,</span><br><span class="line">	order_money double(10,2),</span><br><span class="line">	order_address varchar(50),</span><br><span class="line">	primary key (order_id)</span><br><span class="line">)engine = myisam default charset=utf8;</span><br><span class="line"></span><br><span class="line">-- myisam 搜索引擎 的表</span><br><span class="line">create table order_1991(</span><br><span class="line">	order_id int ,</span><br><span class="line">	order_money double(10,2),</span><br><span class="line">	order_address varchar(50),</span><br><span class="line">	primary key (order_id)</span><br><span class="line">)engine = myisam default charset=utf8;</span><br><span class="line"></span><br><span class="line">-- order_all 搜索引擎 的表</span><br><span class="line">create table order_all(</span><br><span class="line">	order_id int ,</span><br><span class="line">	order_money double(10,2),</span><br><span class="line">	order_address varchar(50),</span><br><span class="line">	primary key (order_id)</span><br><span class="line">)engine = merge union = (order_1990,order_1991) INSERT_METHOD=LAST default charset=utf8;</span><br><span class="line">-- INSERT_METHOD子句定义插入的表，上述用了LAST</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>分别向两张表中插入记录</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1990 <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">100.0</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1990 <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">100.0</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1991 <span class="keyword">values</span>(<span class="number">10</span>,<span class="number">200.0</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1991 <span class="keyword">values</span>(<span class="number">11</span>,<span class="number">200.0</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>查询3张表中的数据。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from order_1991;</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">| order_id | order_money | order_address |</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">|       10 |      200.00 | 北京           |</span><br><span class="line">|       11 |      200.00 | 上海           |</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from order_1990;</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">| order_id | order_money | order_address |</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">|        1 |      100.00 | 北京           |</span><br><span class="line">|        2 |      100.00 | 上海           |</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from order_all;</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">| order_id | order_money | order_address |</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">|        1 |      100.00 | 北京           |</span><br><span class="line">|        2 |      100.00 | 上海           |</span><br><span class="line">|       10 |      200.00 | 北京           |</span><br><span class="line">|       11 |      200.00 | 上海           |</span><br><span class="line">+----------+-------------+---------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>往order_all中插入一条记录 ，由于在MERGE表定义时，INSERT_METHOD 选择的是LAST，那么插入的数据会想最后一张表中插入。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_all <span class="keyword">values</span>(<span class="number">100</span>,<span class="number">10000.0</span>,<span class="string">&#x27;西安&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_1991;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> order_id <span class="operator">|</span> order_money <span class="operator">|</span> order_address <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------+---------------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span>      <span class="number">200.00</span> <span class="operator">|</span> 北京           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">11</span> <span class="operator">|</span>      <span class="number">200.00</span> <span class="operator">|</span> 上海           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">100</span> <span class="operator">|</span>    <span class="number">10000.00</span> <span class="operator">|</span> 西安           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------+---------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec) 	 	</span><br></pre></td></tr></table></figure>
<h3 id="存储引擎的选择">2.3 存储引擎的选择</h3>
<p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p>
<p>以下是几种常用的存储引擎的使用环境。</p>
<ul>
<li><strong>InnoDB</strong> : 是MySQL的默认存储引擎，用于事务处理应用程序，支持外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。InnoDB存储引擎除了有效的降低由于删除和更新导致的锁定(行锁)， 还可以确保事务的完整提交和回滚，对于类似于计费系统或者财务系统等对数据准确性要求比较高的系统，InnoDB是最合适的选择。</li>
<li><strong>MyISAM</strong> ： 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。</li>
<li><strong>MEMORY</strong>：将所有数据保存在RAM中，在需要快速定位记录和其他类似数据环境下，可以提供级快的访问。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，其次是要确保表的数据可以恢复，数据库异常终止后表中的数据是可以恢复的。MEMORY表通常用于更新不太频繁的小表，用以快速得到访问结果。</li>
<li><strong>MERGE</strong>：用于将一系列等同的MyISAM表以逻辑方式组合在一起，并作为一个对象引用他们。MERGE表的优点在于可以突破对单个MyISAM表的大小限制，并且通过将不同的表分布在多个磁盘上，可以有效的改善MERGE表的访问效率。这对于存储诸如数据仓储等VLDB环境十分合适。</li>
</ul>
<h2 id="优化sql步骤">3. 优化SQL步骤</h2>
<p>在应用的的开发过程中，由于初期数据量小，开发人员写 SQL 语句时更重视功能上的实现，但是当应用系统正式上线后，随着生产数据量的急剧增长，很多 SQL 语句开始逐渐显露出性能问题，对生产的影响也越来越大，此时这些有问题的 SQL 语句就成为整个系统性能的瓶颈，因此我们必须要对它们进行优化，本章将详细介绍在 MySQL 中优化 SQL 语句的方法。</p>
<p>当面对一个有 SQL 性能问题的数据库时，我们应该从何处入手来进行系统的分析，使得能够尽快定位问题 SQL 并尽快解决问题。</p>
<h3 id="查看sql执行频率">3.1 查看SQL执行频率</h3>
<p>MySQL 客户端连接成功后，通过 <code>show [session|global] status</code> 命令可以提供服务器状态信息。<code>show [session|global] status</code> 可以根据需要加上参数<code>session</code>或者<code>global</code>来显示 session 级（当前连接）的统计结果和 global 级（自数据库上次启动至今）的统计结果。如果不写，默认使用参数是<code>session</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">-- 下面的命令显示了当前 session 中所有统计参数的值：</span><br><span class="line">show status like &#x27;Com_______&#x27;;</span><br><span class="line">-- 结果：</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Com_binlog    | 0     |</span><br><span class="line">| Com_commit    | 1     |</span><br><span class="line">| Com_delete    | 1     |</span><br><span class="line">| Com_insert    | 2     |</span><br><span class="line">| Com_repair    | 0     |</span><br><span class="line">| Com_revoke    | 0     |</span><br><span class="line">| Com_select    | 11    |</span><br><span class="line">| Com_signal    | 0     |</span><br><span class="line">| Com_update    | 1     |</span><br><span class="line">| Com_xa_end    | 0     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">10 rows in set (0.00 sec)  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查看 innodb 搜索引擎的状态</span><br><span class="line">show status like &#x27;Innodb_rows_%&#x27;;</span><br><span class="line">-- 结果</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name        | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Innodb_rows_deleted  | 2     |</span><br><span class="line">| Innodb_rows_inserted | 64    |</span><br><span class="line">| Innodb_rows_read     | 315   |</span><br><span class="line">| Innodb_rows_updated  | 4     |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>Com_xxx 表示每个 xxx 语句执行的次数，我们通常比较关心的是以下几个统计参数。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Com_select</td>
<td>执行 select 操作的次数，一次查询只累加 1。</td>
</tr>
<tr class="even">
<td style="text-align: left;">Com_insert</td>
<td>执行 insert 操作的次数，对于批量插入的 insert 操作，只累加一次。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Com_update</td>
<td>执行 update 操作的次数。</td>
</tr>
<tr class="even">
<td style="text-align: left;">Com_delete</td>
<td>执行 delete 操作的次数。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Innodb_rows_read</td>
<td>select 查询返回的行数。</td>
</tr>
<tr class="even">
<td style="text-align: left;">Innodb_rows_inserted</td>
<td>执行 insert 操作插入的行数。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Innodb_rows_updated</td>
<td>执行 update 操作更新的行数。</td>
</tr>
<tr class="even">
<td style="text-align: left;">Innodb_rows_deleted</td>
<td>执行 delete 操作删除的行数。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Connections</td>
<td>试图连接 MySQL 服务器的次数。</td>
</tr>
<tr class="even">
<td style="text-align: left;">Uptime</td>
<td>服务器工作时间。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Slow_queries</td>
<td>慢查询的次数。</td>
</tr>
</tbody>
</table>
<p><code>Com_***</code>：这些参数对于所有存储引擎的表操作都会进行累计。</p>
<p><code>Innodb_***</code>：这几个参数只是针对InnoDB存储引擎的，累加的算法也略有不同。</p>
<h3 id="定位低效率执行sql">3.2 定位低效率执行SQL</h3>
<p>可以通过以下两种方式定位执行效率较低的 SQL 语句。</p>
<ul>
<li><strong>慢查询日志</strong> : 通过慢查询日志定位那些执行效率较低的 SQL 语句，用 <code>--log-slow-queries[=file_name]</code> 选项启动时，mysqld 写一个包含所有执行时间超过 <code>long_query_time</code> 秒的 SQL 语句的日志文件。后续进行介绍。</li>
<li><strong>通过命令<code>show processlist</code></strong> : 慢查询日志在查询结束以后才纪录，所以在应用反映执行效率出现问题的时候查询慢查询日志并不能定位问题，可以使用<code>show processlist</code>命令查看当前MySQL在进行的线程，包括线程的状态、是否锁表等，可以实时地查看 SQL 的执行情况，同时对一些锁表操作进行优化。</li>
</ul>
<p>命令使用及分析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+----+------+-----------------+---------+---------+------+-------+------------------+</span><br><span class="line">| Id | User | Host            | db      | Command | Time | State | Info             |</span><br><span class="line">+----+------+-----------------+---------+---------+------+-------+------------------+</span><br><span class="line">| 12 | root | localhost:7519  | demo_01 | Sleep   |  761 |       | NULL             |</span><br><span class="line">| 27 | root | localhost:11335 | demo_01 | Query   |    0 | NULL  | show processlist |</span><br><span class="line">+----+------+-----------------+---------+---------+------+-------+------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ol type="1">
<li><p>id列，用户登录mysql时，系统分配的&quot;connection_id&quot;，可以使用函数<code>connection_id()</code>查看</p></li>
<li><p>user列，显示当前用户。如果不是root，这个命令就只显示用户权限范围的sql语句</p></li>
<li><p>host列，显示这个语句是从哪个ip的哪个端口上发的，可以用来跟踪出现问题语句的用户</p></li>
<li><p>db列，显示这个进程目前连接的是哪个数据库</p></li>
<li><p>command列，显示当前连接的执行的命令，一般取值为休眠（sleep），查询（query），连接（connect）等</p></li>
<li><p>time列，显示这个状态持续的时间，单位是秒</p></li>
<li><p>state列，显示使用当前连接的sql语句的状态，很重要的列。</p>
<p>state描述的是语句执行中的某一个状态。</p>
<p>一个sql语句，以查询为例，可能需要经过 copying to tmp table、sorting result、sending data 等状态才可以完成。</p></li>
<li><p>info列，显示这个sql语句，是判断问题语句的一个重要依据</p></li>
</ol>
<h3 id="explain分析执行计划">3.3 explain分析执行计划</h3>
<p>通过以上步骤查询到效率低的 SQL 语句后，可以通过 EXPLAIN 或者 DESC 命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序。</p>
<p>查询SQL语句的执行计划 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from city where city_id = 1;</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra |</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | city  | const | PRIMARY       | PRIMARY | 4       | const |    1 |       |</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from city where city_name = &#x27;NewYork&#x27;;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |    4 | Using where |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">1 row in set (0.00 sec)  </span><br></pre></td></tr></table></figure>
<p>字段分析：</p>
<table>
<colgroup>
<col style="width: 17%">
<col style="width: 82%">
</colgroup>
<thead>
<tr class="header">
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>select 查询的序列号，是一组数字，表示的是查询中执行 select 子句或者是操作表的顺序。</td>
</tr>
<tr class="even">
<td>select_type</td>
<td>表示 select 的类型，常见的取值有：<br>SIMPLE：简单表，即不使用表连接或者子查询<br>PRIMARY：主查询，即外层的查询<br>UNION：UNION 中的第二个或者后面的查询语句<br>SUBQUERY：子查询中的第一个 SELECT <br>等...</td>
</tr>
<tr class="odd">
<td>table</td>
<td>输出结果集的表</td>
</tr>
<tr class="even">
<td>type</td>
<td>表示表的连接类型，性能由好到差的连接类型为：<br>system&gt;const&gt;eq_ref&gt;ref&gt;ref_or_null&gt;index_merge&gt;index_subquery&gt;range&gt;index&gt;all</td>
</tr>
<tr class="odd">
<td>possible_keys</td>
<td>表示查询时，可能使用的索引</td>
</tr>
<tr class="even">
<td>key</td>
<td>表示实际使用的索引</td>
</tr>
<tr class="odd">
<td>key_len</td>
<td>索引字段的长度</td>
</tr>
<tr class="even">
<td>rows</td>
<td>扫描行的数量</td>
</tr>
<tr class="odd">
<td>extra</td>
<td>执行情况的说明和描述</td>
</tr>
</tbody>
</table>
<h4 id="环境准备">3.3.1 环境准备</h4>
<p><img src="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2/explain分析环境准备.png" alt="explain分析环境准备"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">-- 创建角色表</span><br><span class="line">CREATE TABLE `t_role` (</span><br><span class="line">  `id` varchar(32) NOT NULL,</span><br><span class="line">  `role_name` varchar(255) DEFAULT NULL,</span><br><span class="line">  `role_code` varchar(255) DEFAULT NULL,</span><br><span class="line">  `description` varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `unique_role_name` (`role_name`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- 创建用户表</span><br><span class="line">CREATE TABLE `t_user` (</span><br><span class="line">  `id` varchar(32) NOT NULL,</span><br><span class="line">  `username` varchar(45) NOT NULL,</span><br><span class="line">  `password` varchar(96) NOT NULL,</span><br><span class="line">  `name` varchar(45) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `unique_user_username` (`username`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- 用户表和角色表之间的关联关系表</span><br><span class="line">CREATE TABLE `user_role` (</span><br><span class="line">  `id` int(11) NOT NULL auto_increment ,</span><br><span class="line">  `user_id` varchar(32) DEFAULT NULL,</span><br><span class="line">  `role_id` varchar(32) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `fk_ur_user_id` (`user_id`),</span><br><span class="line">  KEY `fk_ur_role_id` (`role_id`),</span><br><span class="line">  CONSTRAINT `fk_ur_role_id` FOREIGN KEY (`role_id`) REFERENCES `t_role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,</span><br><span class="line">  CONSTRAINT `fk_ur_user_id` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- 插入数据</span><br><span class="line">insert into `t_user` (`id`, `username`, `password`, `name`) values(&#x27;1&#x27;,&#x27;super&#x27;,&#x27;$2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe&#x27;,&#x27;超级管理员&#x27;);</span><br><span class="line">insert into `t_user` (`id`, `username`, `password`, `name`) values(&#x27;2&#x27;,&#x27;admin&#x27;,&#x27;$2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe&#x27;,&#x27;系统管理员&#x27;);</span><br><span class="line">insert into `t_user` (`id`, `username`, `password`, `name`) values(&#x27;3&#x27;,&#x27;itcast&#x27;,&#x27;$2a$10$8qmaHgUFUAmPR5pOuWhYWOr291WJYjHelUlYn07k5ELF8ZCrW0Cui&#x27;,&#x27;test02&#x27;);</span><br><span class="line">insert into `t_user` (`id`, `username`, `password`, `name`) values(&#x27;4&#x27;,&#x27;stu1&#x27;,&#x27;$2a$10$pLtt2KDAFpwTWLjNsmTEi.oU1yOZyIn9XkziK/y/spH5rftCpUMZa&#x27;,&#x27;学生1&#x27;);</span><br><span class="line">insert into `t_user` (`id`, `username`, `password`, `name`) values(&#x27;5&#x27;,&#x27;stu2&#x27;,&#x27;$2a$10$nxPKkYSez7uz2YQYUnwhR.z57km3yqKn3Hr/p1FR6ZKgc18u.Tvqm&#x27;,&#x27;学生2&#x27;);</span><br><span class="line">insert into `t_user` (`id`, `username`, `password`, `name`) values(&#x27;6&#x27;,&#x27;t1&#x27;,&#x27;$2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe&#x27;,&#x27;老师1&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES(&#x27;5&#x27;,&#x27;学生&#x27;,&#x27;student&#x27;,&#x27;学生&#x27;);</span><br><span class="line">INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES(&#x27;7&#x27;,&#x27;老师&#x27;,&#x27;teacher&#x27;,&#x27;老师&#x27;);</span><br><span class="line">INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES(&#x27;8&#x27;,&#x27;教学管理员&#x27;,&#x27;teachmanager&#x27;,&#x27;教学管理员&#x27;);</span><br><span class="line">INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES(&#x27;9&#x27;,&#x27;管理员&#x27;,&#x27;admin&#x27;,&#x27;管理员&#x27;);</span><br><span class="line">INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`) VALUES(&#x27;10&#x27;,&#x27;超级管理员&#x27;,&#x27;super&#x27;,&#x27;超级管理员&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO user_role(id,user_id,role_id) VALUES(NULL, &#x27;1&#x27;, &#x27;5&#x27;),(NULL, &#x27;1&#x27;, &#x27;7&#x27;),(NULL, &#x27;2&#x27;, &#x27;8&#x27;),(NULL, &#x27;3&#x27;, &#x27;9&#x27;),(NULL, &#x27;4&#x27;, &#x27;8&#x27;),(NULL, &#x27;5&#x27;, &#x27;10&#x27;) ;</span><br><span class="line"></span><br><span class="line">-- 查看目前表数据</span><br><span class="line">SELECT * FROM t_role;</span><br><span class="line">id      role_name        role_code     description      </span><br><span class="line">------  ---------------  ------------  -----------------</span><br><span class="line">10      超级管理员         super         超级管理员  </span><br><span class="line">5       学生              student       学生           </span><br><span class="line">7       老师              teacher       老师           </span><br><span class="line">8       教学管理员         teachmanager  教学管理员  </span><br><span class="line">9       管理员            admin         管理员     </span><br><span class="line"></span><br><span class="line">SELECT * FROM t_user;</span><br><span class="line">id      username  password                                                      name             </span><br><span class="line">------  --------  ------------------------------------------------------------  -----------------</span><br><span class="line">1       super     $2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe  超级管理员  </span><br><span class="line">2       admin     $2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe  系统管理员  </span><br><span class="line">3       itcast    $2a$10$8qmaHgUFUAmPR5pOuWhYWOr291WJYjHelUlYn07k5ELF8ZCrW0Cui  test02           </span><br><span class="line">4       stu1      $2a$10$pLtt2KDAFpwTWLjNsmTEi.oU1yOZyIn9XkziK/y/spH5rftCpUMZa  学生1          </span><br><span class="line">5       stu2      $2a$10$nxPKkYSez7uz2YQYUnwhR.z57km3yqKn3Hr/p1FR6ZKgc18u.Tvqm  学生2          </span><br><span class="line">6       t1        $2a$10$TJ4TmCdK.X4wv/tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe  老师1     </span><br><span class="line"></span><br><span class="line">SELECT * FROM user_role;</span><br><span class="line">    id  user_id  role_id  </span><br><span class="line">------  -------  ---------</span><br><span class="line">     1  1        5        </span><br><span class="line">     2  1        7        </span><br><span class="line">     3  2        8        </span><br><span class="line">     4  3        9        </span><br><span class="line">     5  4        8        </span><br><span class="line">     6  5        10       </span><br></pre></td></tr></table></figure>
<h4 id="explain-之-id">3.3.2 explain 之 id</h4>
<p>id 字段是 select 查询的序列号，是一组数字，表示的是查询中执行select子句或者是操作表的顺序。id 情况有三种 ：</p>
<ol type="1">
<li>id 相同表示加载表的顺序是从上到下。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_role r, t_user u, user_role ur where r.id = ur.role_id and u.id = ur.user_id ;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys              </span><br><span class="line">------  -----------  ------  ------  ---------------------------</span><br><span class="line">     1  SIMPLE       r       ALL     PRIMARY                    </span><br><span class="line">     1  SIMPLE       ur      ref     fk_ur_user_id,fk_ur_role_id</span><br><span class="line">     1  SIMPLE       u       eq_ref  PRIMARY                    </span><br><span class="line">     </span><br><span class="line">  key            key_len  ref                 rows    Extra        </span><br><span class="line">  -------------  -------  ------------------  ------  -------------</span><br><span class="line">  (NULL)         (NULL)   (NULL)                   5               </span><br><span class="line">  fk_ur_role_id  99       demo_01.r.id             1  Using where  </span><br><span class="line">  PRIMARY        98       demo_01.ur.user_id       1               </span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>id 不同id值越大，优先级越高，越先被执行。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_role where id = (select role_id from user_role where user_id = (select id from t_user where username = &#x27;stu1&#x27;));</span><br><span class="line"></span><br><span class="line">    id  select_type  table      type    possible_keys       </span><br><span class="line">------  -----------  ---------  ------  --------------------</span><br><span class="line">     1  PRIMARY      t_role     const   PRIMARY             </span><br><span class="line">     2  SUBQUERY     user_role  ref     fk_ur_user_id       </span><br><span class="line">     3  SUBQUERY     t_user     const   unique_user_username</span><br><span class="line">     </span><br><span class="line">  key                   key_len  ref       rows  Extra        </span><br><span class="line">  --------------------  -------  ------  ------  -------------</span><br><span class="line">  PRIMARY               98       const        1               </span><br><span class="line">  fk_ur_user_id         99                    1  Using where  </span><br><span class="line">  unique_user_username  137                   1  Using index  </span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>id 有相同，也有不同，同时存在。id相同的可以认为是一组，从上往下顺序执行；在所有的组中，id的值越大，优先级越高，越先执行。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_role r , (select * from user_role ur where ur.`user_id` = &#x27;2&#x27;) a where r.id = a.role_id ; </span><br><span class="line"></span><br><span class="line">    id  select_type  table       type    possible_keys</span><br><span class="line">------  -----------  ----------  ------  -------------</span><br><span class="line">     1  PRIMARY      &lt;derived2&gt;  system  (NULL)       </span><br><span class="line">     1  PRIMARY      r           const   PRIMARY      </span><br><span class="line">     2  DERIVED      ur          ref     fk_ur_user_id</span><br><span class="line">     </span><br><span class="line">  key            key_len  ref       rows  Extra        </span><br><span class="line">  -------------  -------  ------  ------  -------------</span><br><span class="line">  (NULL)         (NULL)   (NULL)       1               </span><br><span class="line">  PRIMARY        98       const        1               </span><br><span class="line">  fk_ur_user_id  99                    1  Using where  </span><br></pre></td></tr></table></figure>
<h4 id="explain-之-select_type">3.3.3 explain 之 select_type</h4>
<p>表示 SELECT 的类型，常见的取值，如下表所示：</p>
<table>
<colgroup>
<col style="width: 12%">
<col style="width: 61%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>select_type</th>
<th>含义</th>
<th>距离</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SIMPLE</td>
<td>简单的select查询，查询中不包含子查询或者 union</td>
<td>参考上方1）</td>
</tr>
<tr class="even">
<td>PRIMARY</td>
<td>查询中若包含任何复杂的子查询，最外层查询标记为该标识</td>
<td>参考上方2）3）</td>
</tr>
<tr class="odd">
<td>SUBQUERY</td>
<td>在SELECT 或 WHERE 列表中包含了子查询</td>
<td>参考上方2）3）</td>
</tr>
<tr class="even">
<td>DERIVED</td>
<td>在 FROM 列表中包含的子查询，被标记为 DERIVED（衍生） MYSQL会递归执行这些子查询，把结果放在临时表中</td>
<td>参考上方3）<br>参考下面</td>
</tr>
<tr class="odd">
<td>UNION</td>
<td>若第二个 SELECT 出现在 UNION 之后，则标记为 UNION ； 若 UNION 包含在 FROM子句的子查询中，外层SELECT将被标记为 ： DERIVED</td>
<td>参考下面</td>
</tr>
<tr class="even">
<td>UNION RESULT</td>
<td>从 UNION 表获取结果的 SELECT</td>
<td>参考下面</td>
</tr>
</tbody>
</table>
<p><strong>DERIVED</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">explain select a.* from (select * from t_user where id in (&quot;1&quot;, &quot;2&quot;)) as a;</span><br><span class="line"></span><br><span class="line">    id  select_type  table       type    possible_keys</span><br><span class="line">------  -----------  ----------  ------  -------------</span><br><span class="line">     1  PRIMARY      &lt;derived2&gt;  ALL     (NULL)       </span><br><span class="line">     2  DERIVED      t_user      range   PRIMARY      </span><br><span class="line">     </span><br><span class="line">  key      key_len  ref       rows  Extra        </span><br><span class="line">  -------  -------  ------  ------  -------------</span><br><span class="line">  (NULL)   (NULL)   (NULL)       2               </span><br><span class="line">  PRIMARY  98       (NULL)       2  Using where  </span><br></pre></td></tr></table></figure>
<p><strong>UNION 和 UNION RESULT：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 第二个select出现在union之后</span><br><span class="line">-- 2.</span><br><span class="line">explain select * from t_user where id=&quot;1&quot; union select * from t_user where id=&quot;2&quot;;</span><br><span class="line"></span><br><span class="line">    id  select_type   table       type    possible_keys</span><br><span class="line">------  ------------  ----------  ------  -------------</span><br><span class="line">     1  PRIMARY       t_user      const   PRIMARY      </span><br><span class="line">     2  UNION         t_user      const   PRIMARY      </span><br><span class="line">(NULL)  UNION RESULT  &lt;union1,2&gt;  ALL     (NULL)       </span><br><span class="line"></span><br><span class="line">  key      key_len  ref       rows  Extra   </span><br><span class="line">  -------  -------  ------  ------  --------</span><br><span class="line">  PRIMARY  98       const        1          </span><br><span class="line">  PRIMARY  98       const        1          </span><br><span class="line">  (NULL)   (NULL)   (NULL)  (NULL)          </span><br></pre></td></tr></table></figure>
<h4 id="explain-之-table">3.3.4 explain 之 table</h4>
<p>即：展示这一行的数据是关于哪一张表的</p>
<h4 id="explain-之-type">3.3.5 explain 之 type</h4>
<p>type 显示的是访问类型，是较为重要的一个指标，可取值为：</p>
<table>
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>NULL</td>
<td>MySQL不访问任何表，索引，直接返回结果</td>
</tr>
<tr class="even">
<td>system</td>
<td>表只有一行记录(等于系统表)，这是const类型的特例，一般不会出现</td>
</tr>
<tr class="odd">
<td>const</td>
<td>表示通过索引一次就找到了，const 用于比较 primary key 或者 unique 索引。<br>因为只匹配一行数据，所以很快。<br>如将主键置于where列表中，MySQL 就能将该查询转换为一个常量。<br>const于将 &quot;主键&quot; 或 &quot;唯一&quot; 索引的所有部分与常量值进行比较</td>
</tr>
<tr class="even">
<td>eq_ref</td>
<td>类似ref，区别在于使用的是唯一索引，使用主键的关联查询，关联查询出的记录只有一条。常见于主键或唯一索引扫描</td>
</tr>
<tr class="odd">
<td>ref</td>
<td>非唯一性索引扫描，返回匹配某个单独值的所有行。本质上也是一种索引访问，返回所有匹配某个单独值的所有行（多个）</td>
</tr>
<tr class="even">
<td>range</td>
<td>只检索给定返回的行，使用一个索引来选择行。 where 之后出现 between，&lt; , &gt; , in 等操作。</td>
</tr>
<tr class="odd">
<td>index</td>
<td>index 与 ALL的区别为 index 类型只是遍历了索引树， 通常比ALL 快， ALL 是遍历数据文件。</td>
</tr>
<tr class="even">
<td>all</td>
<td>将遍历全表以找到匹配的行</td>
</tr>
</tbody>
</table>
<p>结果值从最好到最坏依次是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NULL &gt; system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</span><br><span class="line"></span><br><span class="line">system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</span><br></pre></td></tr></table></figure>
<p>一般来说， 我们需要保证查询至少达到 range 级别， 最好达到ref 。</p>
<p><strong>NULL：MySQL不访问任何表，索引，直接返回结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select now();</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       (NULL)  (NULL)  (NULL)       </span><br><span class="line">     </span><br><span class="line">  key     key_len  ref       rows  Extra           </span><br><span class="line">  ------  -------  ------  ------  ----------------</span><br><span class="line">  (NULL)  (NULL)   (NULL)  (NULL)  No tables used  </span><br></pre></td></tr></table></figure>
<p><strong>system：</strong>表只有一行记录(等于系统表)，这是const类型的特例，一般不会出现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">explain select * from (select * from t_user where id=&#x27;1&#x27;) a;</span><br><span class="line"></span><br><span class="line">    id  select_type  table       type    possible_keys</span><br><span class="line">------  -----------  ----------  ------  -------------</span><br><span class="line">     1  PRIMARY      &lt;derived2&gt;  system  (NULL)       </span><br><span class="line">     2  DERIVED      t_user      const   PRIMARY      </span><br><span class="line">     </span><br><span class="line">  key      key_len  ref       rows  Extra   </span><br><span class="line">  -------  -------  ------  ------  --------</span><br><span class="line">  (NULL)   (NULL)   (NULL)       1          </span><br><span class="line">  PRIMARY  98                    1          </span><br></pre></td></tr></table></figure>
<p><strong>const:</strong> 表示通过索引一次就找到了，const 用于比较 primary key 或者 unique 索引。因为只匹配一行数据，所以很快。如将主键置于where列表中，MySQL 就能将该查询转换为一个常量。const于将 &quot;主键&quot; 或 &quot;唯一&quot; 索引的所有部分与常量值进行比较</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user where id=&#x27;1&#x27;;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  const   PRIMARY      </span><br><span class="line">     </span><br><span class="line">  key      key_len  ref       rows  Extra   </span><br><span class="line">  -------  -------  ------  ------  --------</span><br><span class="line">  PRIMARY  98       const        1          </span><br></pre></td></tr></table></figure>
<p><strong>eq_ref：</strong> 类似ref，区别在于使用的是唯一索引，使用主键的关联查询，关联查询出的记录只有一条。常见于主键或唯一索引扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user u, t_role r where u.id=r.id;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       r       ALL     PRIMARY      </span><br><span class="line">     1  SIMPLE       u       eq_ref  PRIMARY      </span><br><span class="line">     </span><br><span class="line">  key      key_len  ref             rows  Extra   </span><br><span class="line">  -------  -------  ------------  ------  --------</span><br><span class="line">  (NULL)   (NULL)   (NULL)             5          </span><br><span class="line">  PRIMARY  98       demo_01.r.id       1          </span><br></pre></td></tr></table></figure>
<p><strong>ref：</strong>非唯一性索引扫描，返回匹配某个单独值的所有行。本质上也是一种索引访问，返回所有匹配某个单独值的所有行（多个）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create index idx_username on t_user(name);  -- 创建非唯一性索引</span><br><span class="line">explain select * from t_user where name=&quot;a&quot;;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  ref     idx_username </span><br><span class="line">     </span><br><span class="line">  key           key_len  ref       rows  Extra        </span><br><span class="line">  ------------  -------  ------  ------  -------------</span><br><span class="line">  idx_username  137      const        1  Using where  </span><br></pre></td></tr></table></figure>
<p><strong>range：</strong>只检索给定返回的行，使用一个索引来选择行。 where 之后出现 between，&lt; , &gt; , in 等操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user where id in (&quot;1&quot;, &quot;2&quot;);</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  range   PRIMARY      </span><br><span class="line">     </span><br><span class="line">  key      key_len  ref       rows  Extra        </span><br><span class="line">  -------  -------  ------  ------  -------------</span><br><span class="line">  PRIMARY  98       (NULL)       2  Using where  </span><br></pre></td></tr></table></figure>
<p><strong>index：</strong>index 与 ALL的区别为 index 类型只是遍历了索引树， 通常比ALL 快， ALL 是遍历数据文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select id from t_user;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  index   (NULL)       </span><br><span class="line">     </span><br><span class="line">  key                   key_len  ref       rows  Extra        </span><br><span class="line">  --------------------  -------  ------  ------  -------------</span><br><span class="line">  unique_user_username  137      (NULL)       6  Using index  </span><br></pre></td></tr></table></figure>
<p><strong>all：</strong>将遍历全表以找到匹配的行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  ALL     (NULL)       </span><br><span class="line">     </span><br><span class="line">  key     key_len  ref       rows  Extra   </span><br><span class="line">  ------  -------  ------  ------  --------</span><br><span class="line">  (NULL)  (NULL)   (NULL)       6          </span><br></pre></td></tr></table></figure>
<h4 id="explain-之-key">3.3.6 explain 之 key</h4>
<ul>
<li><p>possible_keys: 显示可能应用在这张表的索引， 一个或多个。</p></li>
<li><p>key： 实际使用的索引， 如果为NULL， 则没有使用索引。</p></li>
<li><p>key_len: 表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下， 长度越短越好 。</p></li>
</ul>
<h4 id="explain-之-rows">3.3.7 explain 之 rows</h4>
<p>即扫描行的数量。</p>
<h4 id="explain-之-extra">3.3.8 explain 之 extra</h4>
<p>其他的额外的执行计划信息，在该列展示 。</p>
<table>
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<thead>
<tr class="header">
<th>extra</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>using filesort</td>
<td>说明 MySQL 会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取， 称为 “文件排序”, 效率低。</td>
</tr>
<tr class="even">
<td>using temporary</td>
<td>使用了临时表保存中间结果，MySQL在对查询结果排序时使用临时表。常见于 order by 和 group by； 效率低</td>
</tr>
<tr class="odd">
<td>using index</td>
<td>表示相应的select操作使用了覆盖索引， 避免访问表的数据行， 效率不错。</td>
</tr>
</tbody>
</table>
<p><strong>using filesort：</strong>说明 MySQL 会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取， 称为 “文件排序”, 效率低。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from t_user order by password;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  ALL     (NULL)       </span><br><span class="line">     </span><br><span class="line">  key     key_len  ref       rows  Extra           </span><br><span class="line">  ------  -------  ------  ------  ----------------</span><br><span class="line">  (NULL)  (NULL)   (NULL)       6  Using filesort  </span><br></pre></td></tr></table></figure>
<p><strong>using index：</strong>表示相应的select操作使用了覆盖索引， 避免访问表的数据行， 效率不错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select id from t_user order by id;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  index   (NULL)       </span><br><span class="line">     </span><br><span class="line">  key      key_len  ref       rows  Extra        </span><br><span class="line">  -------  -------  ------  ------  -------------</span><br><span class="line">  PRIMARY  98       (NULL)       6  Using index  </span><br></pre></td></tr></table></figure>
<p><strong>using temporary：</strong>使用了临时表保存中间结果，MySQL在对查询结果排序时使用临时表。常见于 order by 和 group by； 效率低</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user group by password;</span><br><span class="line"></span><br><span class="line">    id  select_type  table   type    possible_keys</span><br><span class="line">------  -----------  ------  ------  -------------</span><br><span class="line">     1  SIMPLE       t_user  ALL     (NULL)       </span><br><span class="line">     </span><br><span class="line">  key     key_len  ref       rows  Extra                            </span><br><span class="line">  ------  -------  ------  ------  ---------------------------------</span><br><span class="line">  (NULL)  (NULL)   (NULL)       6  Using temporary; Using filesort  </span><br></pre></td></tr></table></figure>
<h3 id="show-profile-分析-sql">3.4 show profile 分析 SQL</h3>
<p>Mysql从5.0.37 版本开始增加了对 <code>show profiles</code> 和 <code>show profile</code> 语句的支持。show profiles 能够在做 SQL 优化时帮助我们了解时间都耗费到哪里去了。</p>
<p>通过 have_profiling 参数，能够看到当前MySQL是否支持profile：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@have_profiling;</span><br><span class="line">+------------------+</span><br><span class="line">| @@have_profiling |</span><br><span class="line">+------------------+</span><br><span class="line">| YES              |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec) </span><br></pre></td></tr></table></figure>
<p>默认 profiling 是关闭的，可以通过 set 语句在 Session 级别开启 profiling：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@profiling;</span><br><span class="line">+-------------+</span><br><span class="line">| @@profiling |</span><br><span class="line">+-------------+</span><br><span class="line">|           0 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.00 sec) </span><br><span class="line"></span><br><span class="line">mysql&gt; set profiling=1; -- 开启profiling 开关</span><br><span class="line">mysql&gt; select @@profiling;</span><br><span class="line">+-------------+</span><br><span class="line">| @@profiling |</span><br><span class="line">+-------------+</span><br><span class="line">|           1 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>通过 profile，我们能够更清楚地了解 SQL 执行的过程。</p>
<p>首先，我们可以执行一系列的操作，如下图所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">use demo_01;</span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">select * from t_user where id &lt; 5;</span><br><span class="line">select count(*) from t_user;</span><br></pre></td></tr></table></figure>
<p>执行完上述命令之后，再执行<code>show profiles</code> 指令， 来查看SQL语句执行的耗时：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profiles;</span><br><span class="line">+----------+------------+-----------------------------------+</span><br><span class="line">| Query_ID | Duration   | Query                             |</span><br><span class="line">+----------+------------+-----------------------------------+</span><br><span class="line">|        1 | 0.00010350 | select @@profiling                |</span><br><span class="line">|        2 | 0.00103225 | show databases                    |</span><br><span class="line">|        3 | 0.00010525 | SELECT DATABASE()                 |</span><br><span class="line">|        4 | 0.00037475 | show tables                       |</span><br><span class="line">|        5 | 0.00007650 | select * from t_user where id &lt; 5 |</span><br><span class="line">|        6 | 0.00007575 | select count(*) from t_user       |</span><br><span class="line">+----------+------------+-----------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>通过<code>show profile for query query_id</code> 语句可以查看到该SQL执行过程中每个线程的状态和消耗的时间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 2;</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| Status             | Duration |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| starting           | 0.000042 |</span><br><span class="line">| Opening tables     | 0.000217 |</span><br><span class="line">| System lock        | 0.000008 |</span><br><span class="line">| init               | 0.000007 |</span><br><span class="line">| optimizing         | 0.000004 |</span><br><span class="line">| statistics         | 0.000008 |</span><br><span class="line">| preparing          | 0.000005 |</span><br><span class="line">| executing          | 0.000626 |</span><br><span class="line">| Sending data       | 0.000016 |</span><br><span class="line">| end                | 0.000004 |</span><br><span class="line">| query end          | 0.000008 |</span><br><span class="line">| closing tables     | 0.000002 |</span><br><span class="line">| removing tmp table | 0.000006 |</span><br><span class="line">| closing tables     | 0.000003 |</span><br><span class="line">| freeing items      | 0.000072 |</span><br><span class="line">| logging slow query | 0.000003 |</span><br><span class="line">| cleaning up        | 0.000002 |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">17 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP ：Sending data 状态表示 MySQL 线程开始访问数据行并把结果返回给客户端，而不仅仅是返回个客户端。由于在 Sending data 状态下，MySQL线程往往需要做大量的磁盘读取操作，所以经常是整各查询中耗时最长的状态。</p>
<blockquote>
<p>这里由于数据量很小，因此没有体现，一旦数据量上去后就会有体现的</p>
</blockquote>
</blockquote>
<p>在获取到最消耗时间的线程状态后，MySQL 支持进一步选择 all、cpu、block io 、context switch、page faults 等明细类型类查看 MySQL 在使用什么资源上耗费了过高的时间。例如，选择查看CPU的耗费时间 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile cpu for query 2;</span><br><span class="line">+--------------------+----------+----------+------------+</span><br><span class="line">| Status             | Duration | CPU_user | CPU_system |</span><br><span class="line">+--------------------+----------+----------+------------+</span><br><span class="line">| starting           | 0.000042 | 0.000000 |   0.000000 |</span><br><span class="line">| Opening tables     | 0.000217 | 0.000000 |   0.000000 |</span><br><span class="line">| System lock        | 0.000008 | 0.000000 |   0.000000 |</span><br><span class="line">| init               | 0.000007 | 0.000000 |   0.000000 |</span><br><span class="line">| optimizing         | 0.000004 | 0.000000 |   0.000000 |</span><br><span class="line">| statistics         | 0.000008 | 0.000000 |   0.000000 |</span><br><span class="line">| preparing          | 0.000005 | 0.000000 |   0.000000 |</span><br><span class="line">| executing          | 0.000626 | 0.000000 |   0.000000 |</span><br><span class="line">| Sending data       | 0.000016 | 0.000000 |   0.000000 |</span><br><span class="line">| end                | 0.000004 | 0.000000 |   0.000000 |</span><br><span class="line">| query end          | 0.000008 | 0.000000 |   0.000000 |</span><br><span class="line">| closing tables     | 0.000002 | 0.000000 |   0.000000 |</span><br><span class="line">| removing tmp table | 0.000006 | 0.000000 |   0.000000 |</span><br><span class="line">| closing tables     | 0.000003 | 0.000000 |   0.000000 |</span><br><span class="line">| freeing items      | 0.000072 | 0.000000 |   0.000000 |</span><br><span class="line">| logging slow query | 0.000003 | 0.000000 |   0.000000 |</span><br><span class="line">| cleaning up        | 0.000002 | 0.000000 |   0.000000 |</span><br><span class="line">+--------------------+----------+----------+------------+</span><br><span class="line">17 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>对上述字段解释：</p>
<table>
<thead>
<tr class="header">
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Status</td>
<td>sql 语句执行的状态</td>
</tr>
<tr class="even">
<td>Duration</td>
<td>sql 执行过程中每一个步骤的耗时</td>
</tr>
<tr class="odd">
<td>CPU_user</td>
<td>当前用户占有的cpu</td>
</tr>
<tr class="even">
<td>CPU_system</td>
<td>系统占有的cpu</td>
</tr>
</tbody>
</table>
<h3 id="trace-分析优化器执行计划">3.5 trace 分析优化器执行计划</h3>
<blockquote>
<p>我用了 MySQL 8 来进行分析</p>
</blockquote>
<p>MySQL5.6 提供了对 SQL 的跟踪 trace，通过trace文件能够进一步了解为什么优化器选择A计划, 而不是选择B计划。</p>
<p>打开trace，设置格式为 JSON，并设置 trace 最大能够使用的内存大小，避免解析过程中因为默认内存过小而不能够完整展示。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> optimizer_trace<span class="operator">=</span>&quot;enabled=on&quot;, end_markers_in_json<span class="operator">=</span><span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">set</span> optimizer_trace_max_mem_size<span class="operator">=</span><span class="number">1000000</span>;</span><br></pre></td></tr></table></figure>
<p>执行SQL语句 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> id <span class="operator">&lt;</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p>最后， 检查 information_schema.optimizer_trace就可以知道MySQL是如何执行SQL的 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.optimizer_trace;</span><br><span class="line"></span><br><span class="line">-- 输出就略了</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
	
	<div>
		
			<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

<div>
    
       <div style="text-align:center;color:#bfbfbf;font-size:16px;">
             <span>--- 本文结束 </span>
             <i class="fa fa-thumbs-o-up"></i>
             <span> 感谢阅读 ---</span>
       </div>
    
</div>
		
	</div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> 学习笔记</a>
              <a href="/tags/MySQL/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> MySQL</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> 数据库</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-1/" rel="prev" title="MySQL：提高笔记-1">
      <i class="fa fa-chevron-left"></i> MySQL：提高笔记-1
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/14/MySQL/MySQL%E6%8F%90%E9%AB%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL%EF%BC%9A%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-3/" rel="next" title="MySQL：提高笔记-3">
      MySQL：提高笔记-3 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E6%8F%90%E9%AB%98%E7%AC%94%E8%AE%B0-2"><span class="nav-text">MySQL：提高笔记-2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%A6%82%E8%A7%88"><span class="nav-text">1. MySQL的体系结构概览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">2. 存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%A6%82%E8%BF%B0"><span class="nav-text">2.1 存储引擎概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%84%E7%A7%8D%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E6%80%A7"><span class="nav-text">2.2 各种存储引擎特性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb"><span class="nav-text">2.2.1 InnoDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#myisam"><span class="nav-text">2.2.2 MyISAM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#memory"><span class="nav-text">2.2.3 MEMORY</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#merge"><span class="nav-text">2.2.4 MERGE</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-text">2.3 存储引擎的选择</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96sql%E6%AD%A5%E9%AA%A4"><span class="nav-text">3. 优化SQL步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bsql%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87"><span class="nav-text">3.1 查看SQL执行频率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%BD%8D%E4%BD%8E%E6%95%88%E7%8E%87%E6%89%A7%E8%A1%8Csql"><span class="nav-text">3.2 定位低效率执行SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#explain%E5%88%86%E6%9E%90%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="nav-text">3.3 explain分析执行计划</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">3.3.1 环境准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-id"><span class="nav-text">3.3.2 explain 之 id</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-select_type"><span class="nav-text">3.3.3 explain 之 select_type</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-table"><span class="nav-text">3.3.4 explain 之 table</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-type"><span class="nav-text">3.3.5 explain 之 type</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-key"><span class="nav-text">3.3.6 explain 之 key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-rows"><span class="nav-text">3.3.7 explain 之 rows</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#explain-%E4%B9%8B-extra"><span class="nav-text">3.3.8 explain 之 extra</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#show-profile-%E5%88%86%E6%9E%90-sql"><span class="nav-text">3.4 show profile 分析 SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trace-%E5%88%86%E6%9E%90%E4%BC%98%E5%8C%96%E5%99%A8%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="nav-text">3.5 trace 分析优化器执行计划</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhuCC"
      src="/images/%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">ZhuCC</p>
  <div class="site-description" itemprop="description">不急不躁。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">209</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
	  
	  
        <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
        <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
        <div class="widget-wrap">
            <div id="myCanvasContainer" class="widget tagcloud">
                <canvas width="250" height="250" id="resCanvas" style="width=100%">
                    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anaconda/" rel="tag">Anaconda</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arthas/" rel="tag">Arthas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAT/" rel="tag">CAT</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CompletableFuture/" rel="tag">CompletableFuture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/" rel="tag">ELK</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearck/" rel="tag">Elasticsearck</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/" rel="tag">GPU</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/" rel="tag">GitHub</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitee/" rel="tag">Gitee</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Groovy/" rel="tag">Groovy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/" rel="tag">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">77</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%9F%BA%E7%A1%80/" rel="tag">Java基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E8%AF%AD%E6%B3%95/" rel="tag">Java语法</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K%E8%BF%91%E9%82%BB/" rel="tag">K近邻</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mock/" rel="tag">Mock</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/" rel="tag">Mockito</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSS/" rel="tag">OSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/" rel="tag">OpenCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optional/" rel="tag">Optional</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSM/" rel="tag">SSM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/" rel="tag">SpringMVC</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stream/" rel="tag">Stream</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/" rel="tag">TensorFlow</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadLocal/" rel="tag">ThreadLocal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TortoiseGit/" rel="tag">TortoiseGit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TransmittableThreadLocal/" rel="tag">TransmittableThreadLocal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">lambda表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvidia/" rel="tag">nvidia</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA%E7%BB%8F%E5%8E%86/" rel="tag">个人经历</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/" rel="tag">全文检索</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/" rel="tag">决策树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/" rel="tag">分类问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98/" rel="tag">刷题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">刷题笔记</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/" rel="tag">加密文章</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" rel="tag">博客搭建</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%82%E8%80%83%E6%96%87%E4%BB%B6/" rel="tag">参考文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">基础知识</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a><span class="tag-list-count">104</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">并发编程</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" rel="tag">开发框架</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%88%90%E9%95%BF%E5%8F%B2/" rel="tag">成长史</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/" rel="tag">持久层框架</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/" rel="tag">支持向量机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6%E6%8E%A8%E5%AF%BC/" rel="tag">数学推导</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" rel="tag">数据清洗</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8/" rel="tag">日常</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" rel="tag">日志框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E7%BB%93%E6%9E%84/" rel="tag">树结构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" rel="tag">测试工具</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/" rel="tag">特征选择</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" rel="tag">环境配置</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" rel="tag">线性回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%81%9A%E7%B1%BB/" rel="tag">聚类</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%A8%E7%A4%BA%E5%B1%82/" rel="tag">表示层</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E8%B7%AF/" rel="tag">计算机网路</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E7%94%A8%E9%93%BE%E7%9B%91%E6%8E%A7/" rel="tag">调用链监控</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9D%E5%8F%B6%E6%96%AF/" rel="tag">贝叶斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/" rel="tag">软件使用</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" rel="tag">逻辑回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88%E7%B1%BB/" rel="tag">集合类</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/" rel="tag">集成学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E7%BB%8F/" rel="tag">面经</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0/" rel="tag">面试笔记</a><span class="tag-list-count">61</span></li></ul>
                </canvas>
            </div>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhuCC</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">3.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">55:37</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '3it0tVBbppFeFBVa8QgB3vxM-gzGzoHsz',
      appKey     : '9VtnMWSrhAtC1pSRaA4Rivx9',
      placeholder: "请多多指教~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
