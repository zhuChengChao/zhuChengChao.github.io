<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Mario.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Mario.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="工作学习第二弹😮  原视频地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1H54y167gf">
<meta property="og:type" content="article">
<meta property="og:title" content="工作流：Activiti提升">
<meta property="og:url" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/index.html">
<meta property="og:site_name" content="贤余超">
<meta property="og:description" content="工作学习第二弹😮  原视频地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1H54y167gf">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/流程定义和流程实例图解.png">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_execution中存储业务标识.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_task表数据.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_identitylink%20表数据.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_hi_procinst数据.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_hi_taskinst表数据.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_hi_actinst表数据.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_execution中存储业务标识.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前的激活状态：act_ru_execution.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前流程的激活状态：act_ru_task.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前的挂起状态：act_ru_execution.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前流程的挂起状态：act_ru_task.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前的挂起状态-单流程：act_ru_execution.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前流程的挂起状态-单流程：act_ru_task.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/责任人指定.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/责任人指定-UEL.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_variable数据.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/事件类型.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/监听流程配置.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/DelegateTask类的值.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/流程变量.png">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-1.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-2.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-3.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-4.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/variables：act_ru_variable.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-5.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/多候选人的bpmn图.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/网关.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/排他网关图.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/并行网关图.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/包含网关图.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/事件类型-2.PNG">
<meta property="og:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/事件网关.PNG">
<meta property="article:published_time" content="2022-05-08T02:24:20.000Z">
<meta property="article:modified_time" content="2022-05-08T02:24:20.000Z">
<meta property="article:author" content="ZhuCC">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="开发框架">
<meta property="article:tag" content="工作流">
<meta property="article:tag" content="Activiti">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/流程定义和流程实例图解.png">

<link rel="canonical" href="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>工作流：Activiti提升 | 贤余超</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	<a target="_blank" rel="noopener" href="https://github.com/zhuChengChao" class="github-corner" aria-label="View source on GitHub">
	<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
	<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
	<path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
	<path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
	</svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">贤余超</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一位底层码农 :-)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">100</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">19</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">210</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="ZhuCC">
      <meta itemprop="description" content="不急不躁。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="贤余超">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          工作流：Activiti提升
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-08 10:24:20" itemprop="dateCreated datePublished" datetime="2022-05-08T10:24:20+08:00">2022-05-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">开发框架</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/" itemprop="url" rel="index"><span itemprop="name">工作流</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>72k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:06</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>工作学习第二弹<span class="emoji" data-emoji="open_mouth">😮</span></p>
<blockquote>
<p>原视频地址：https://www.bilibili.com/video/BV1H54y167gf</p>
</blockquote>
<span id="more"></span>
<h1 id="工作流activiti提升">工作流：Activiti提升</h1>
<h2 id="流程实例">1. 流程实例</h2>
<h3 id="概述">1.1 概述</h3>
<p><strong>流程实例</strong>（ProcessInstance）代表流程定义的执行实例。一个流程实例包括了所有的运行节点，可以利用这个对象来了解当前流程实例的进度等信息。</p>
<blockquote>
<p>例如：用户或程序按照流程定义内容发起一个流程，这就是一个流程实例。</p>
</blockquote>
<p>流程定义和流程实例的图解：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/流程定义和流程实例图解.png" alt="流程定义和流程实例图解"></p>
<h3 id="businesskey">1.2 Businesskey</h3>
<h4 id="概述-1">1.2.1 概述</h4>
<p>流程定义部署在activiti后，就可以在系统中通过activiti去管理该流程的执行，执行流程表示流程的一次执行。</p>
<blockquote>
<p>比如部署系统出差流程后，如果某用户要申请出差这时就需要执行这个流程；如果另外一个用户也要申请出差则也需要执行该流程；每个执行互不影响，每个执行是单独的流程实例。</p>
</blockquote>
<p>启动流程实例时，指定的businesskey，就会在act_ru_execution（流程实例的执行表）中存储businesskey。</p>
<p><strong>Businesskey：业务标识</strong>，通常为业务表的主键，业务标识和流程实例一一对应，业务标识来源于业务系统，存储业务标识就是根据业务标识来关联查询业务系统的数据。</p>
<blockquote>
<p>比如：出差流程启动一个流程实例，就可以将出差单的id作为业务标识businesskey存储到activiti中，将来查询activiti的流程实例信息就可以获取出差单的id从而关联查询业务系统数据库得到出差单信息。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例，添加businessKey</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBussinessKey</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、得到ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到RunTimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 3.1、启动流程实例，同时还要指定业务标识businessKey，也就是出差申请单id，这里是1001</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class="string">&quot;myEvection&quot;</span>, <span class="string">&quot;1001&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.2、再启动一个，这次的businessKey指定为2001</span></span><br><span class="line">    <span class="comment">// ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;myEvection&quot;, &quot;2001&quot;);</span></span><br><span class="line">    <span class="comment">// 4、输出processInstance相关属性</span></span><br><span class="line">    System.out.println(<span class="string">&quot;业务id=&quot;</span>+processInstance.getBusinessKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Activiti的act_ru_execution中存储业务标识：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_execution中存储业务标识.PNG" alt="act_ru_execution中存储业务标识"></p>
<h4 id="数据库操作">1.2.2 数据库操作</h4>
<p>启动流程实例，会操作如下数据库表：</p>
<p><strong>表：act_ru_execution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_ru_execution WHERE business_key_ = 1001;  # 流程实例执行表，记录当前流程实例的执行情况</span><br><span class="line"></span><br><span class="line">ID_	REV_	PROC_INST_ID_	BUSINESS_KEY_	PARENT_ID_	PROC_DEF_ID_	SUPER_EXEC_	ROOT_PROC_INST_ID_	ACT_ID_	IS_ACTIVE_	IS_CONCURRENT_	IS_SCOPE_	IS_EVENT_SCOPE_	IS_MI_ROOT_	SUSPENSION_STATE_	CACHED_ENT_STATE_	TENANT_ID_	NAME_	START_TIME_	START_USER_ID_	LOCK_TIME_	IS_COUNT_ENABLED_	EVT_SUBSCR_COUNT_	TASK_COUNT_	JOB_COUNT_	TIMER_JOB_COUNT_	SUSP_JOB_COUNT_	DEADLETTER_JOB_COUNT_	VAR_COUNT_	ID_LINK_COUNT_</span><br><span class="line">17501	1	17501	1001	\N	myEvection:1:15004	\N	17501	\N	1	0	1	0	0	1	\N		\N	2022-05-01 21:01:45	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line"></span><br><span class="line">-- 这里只有一个分支，主键id=17501和流程实例id=17501，相同</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：流程实例执行，如果当前只有一个分支时，一个流程实例只有一条记录且执行表的主键id和流程实例id相同；如果当前有多个分支正在运行则该执行表中有多条记录，存在执行表的主键和流程实例id不相同的记录。<strong>但，不论当前有几个分支总会有一条记录的执行表的主键和流程实例id相同</strong></p>
<p>一个流程实例运行完成，此表中与流程实例相关的记录删除。</p>
</blockquote>
<p><strong>表：act_ru_task</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_ru_task  # 任务执行表，记录当前执行的任务</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_task表数据.PNG" alt="act_ru_task表数据"></p>
<blockquote>
<p>说明：启动流程实例，流程当前执行到第一个任务结点，此表会插入一条记录表示当前任务的执行情况，如果任务完成则记录删除。</p>
</blockquote>
<p><strong>表：act_ru_identitylink</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_ru_identitylink  # 任务参与者，记录当前参与任务的用户或组</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_identitylink%20表数据.PNG" alt="act_ru_identitylink 表数据"></p>
<p><strong>表：act_hi_procinst</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_hi_procinst  # 流程实例历史表</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_hi_procinst数据.PNG" alt="act_hi_procinst数据"></p>
<blockquote>
<p>说明：流程实例启动，会在此表插入一条记录，流程实例运行完成记录也不会删除。</p>
</blockquote>
<p><strong>表：act_hi_taskinst</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_hi_taskinst  #任务历史表，记录所有任务</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_hi_taskinst表数据.PNG" alt="act_hi_taskinst表数据"></p>
<blockquote>
<p>说明：开始一个任务，不仅在act_ru_task表插入记录，也会在历史任务表插入一条记录，任务历史表的主键就是任务id，任务完成此表记录不删除。</p>
</blockquote>
<p><strong>表：act_hi_actinst</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_hi_actinst  # 活动历史表，记录所有活动</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_hi_actinst表数据.PNG" alt="act_hi_actinst表数据"></p>
<blockquote>
<p>说明：活动包括任务，所以此表中不仅记录了任务，还记录了流程执行过程的其它活动，比如开始事件、结束事件。</p>
</blockquote>
<h4 id="查询流程实例">1.2.3 查询流程实例</h4>
<p>流程在运行过程中可以查询流程实例的状态，当前运行结点等信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryProcessInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String processDefinitionKey = <span class="string">&quot;myEvection&quot;</span>;</span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取RunTimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    List&lt;ProcessInstance&gt; list = runtimeService</span><br><span class="line">        .createProcessInstanceQuery()</span><br><span class="line">        .processDefinitionKey(processDefinitionKey)<span class="comment">//</span></span><br><span class="line">        .list();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ProcessInstance processInstance : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span></span><br><span class="line">                           + processInstance.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;所属流程定义id：&quot;</span></span><br><span class="line">                           + processInstance.getProcessDefinitionId());</span><br><span class="line">        System.out.println(<span class="string">&quot;是否执行完成：&quot;</span> + processInstance.isEnded());</span><br><span class="line">        System.out.println(<span class="string">&quot;是否暂停：&quot;</span> + processInstance.isSuspended());</span><br><span class="line">        System.out.println(<span class="string">&quot;当前活动标识：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出内容：（在上面对启动流程实例，添加businessKey代码中，启动了两个流程实例）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">----------------------------</span><br><span class="line">流程实例id：17501</span><br><span class="line">所属流程定义id：myEvection:1:15004</span><br><span class="line">是否执行完成：<span class="literal">false</span></span><br><span class="line">是否暂停：<span class="literal">false</span></span><br><span class="line">当前活动标识：null</span><br><span class="line">----------------------------</span><br><span class="line">流程实例id：20001</span><br><span class="line">所属流程定义id：myEvection:1:15004</span><br><span class="line">是否执行完成：<span class="literal">false</span></span><br><span class="line">是否暂停：<span class="literal">false</span></span><br><span class="line">当前活动标识：null</span><br></pre></td></tr></table></figure>
<h4 id="关联-businesskey">1.2.4 关联 BusinessKey</h4>
<p><strong>需求：</strong>在activiti实际应用时，查询流程实例列表时可能要显示出业务系统的一些相关信息，比如：查询当前运行的出差流程列表需要将出差单名称、出差天数等信息显示出来，出差天数等信息在业务系统中存在，而并没有在activiti数据库中存在，所以是无法通过activiti的api查询到出差天数等信息。</p>
<p><strong>实现：</strong></p>
<ul>
<li><p>在查询流程实例时，通过businessKey（业务标识 ）关联查询业务系统的出差单表，查询出出差天数等信息。</p></li>
<li>通过下面的代码就可以获取activiti中所对应实例保存的业务Key。而这个业务Key一般都会保存相关联的业务操作表的主键，再通过主键ID去查询业务信息，比如通过出差单的ID，去查询更多的请假信息（出差人，出差时间，出差天数，出差目的地等）</li>
<li><p><code>String businessKey = processInstance.getBusinessKey();</code></p></li>
</ul>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_execution中存储业务标识.PNG" alt="act_ru_execution中存储业务标识"></p>
<h3 id="挂起激活流程实例">1.3 挂起&amp;激活流程实例</h3>
<p>某些情况可能由于流程变更需要将当前运行的流程暂停而不是直接删除，流程暂停后将不会继续执行。</p>
<h4 id="全部流程实例挂起">1.3.1 全部流程实例挂起</h4>
<p>操作流程定义为挂起状态，该流程定义下边所有的流程实例全部暂停；即：流程定义为挂起状态该流程定义将不允许启动新的流程实例，同时该流程定义下所有的流程实例将全部挂起暂停执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 全部流程实例挂起与激活</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SuspendAllProcessInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取repositoryService</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 查询流程定义的对象</span></span><br><span class="line">    ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery().</span><br><span class="line">        processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>).</span><br><span class="line">        singleResult();</span><br><span class="line">    <span class="comment">// 得到当前流程定义的实例是否都为暂停状态</span></span><br><span class="line">    <span class="keyword">boolean</span> suspended = processDefinition.isSuspended();</span><br><span class="line">    <span class="comment">// 流程定义id</span></span><br><span class="line">    String processDefinitionId = processDefinition.getId();</span><br><span class="line">    <span class="comment">// 判断是否为暂停</span></span><br><span class="line">    <span class="keyword">if</span>(suspended)&#123;</span><br><span class="line">        <span class="comment">// 如果是暂停，可以执行激活操作:param1 ：流程定义id ，param12：是否激活，param13：激活时间</span></span><br><span class="line">        repositoryService.activateProcessDefinitionById(processDefinitionId, <span class="keyword">true</span>, <span class="keyword">null</span></span><br><span class="line">                                                       );</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义：&quot;</span>+processDefinitionId+<span class="string">&quot;,已激活&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 如果是激活状态，可以暂停，参数1 ：流程定义id ，参数2：是否暂停，参数3：暂停时间</span></span><br><span class="line">        repositoryService.suspendProcessDefinitionById(processDefinitionId,</span><br><span class="line">                                                       <span class="keyword">true</span>,</span><br><span class="line">                                                       <span class="keyword">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义：&quot;</span>+processDefinitionId+<span class="string">&quot;,已挂起&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>挂起前act_ru_execution&amp;act_ru_task表的状态，即激活态：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前的激活状态：act_ru_execution.PNG" alt="当前的激活状态：act_ru_execution"></p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前流程的激活状态：act_ru_task.PNG" alt="当前流程的激活状态：act_ru_task"></p>
<p>挂起后act_ru_execution&amp;act_ru_task表的状态：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前的挂起状态：act_ru_execution.PNG" alt="当前的挂起状态：act_ru_execution"></p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前流程的挂起状态：act_ru_task.PNG" alt="当前流程的挂起状态：act_ru_task"></p>
<blockquote>
<p>可以看到 <code>SUSPENSION_STATE_</code> 的状态</p>
</blockquote>
<h4 id="单个流程实例挂起">1.3.2 单个流程实例挂起</h4>
<p>操作流程实例对象，针对单个流程执行挂起操作，某个流程实例挂起则此流程不再继续执行，完成该流程实例的当前任务将报异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单个流程实例挂起与激活</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">suspendSingleProcessInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 查询流程定义的对象</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService</span><br><span class="line">        .createProcessInstanceQuery()</span><br><span class="line">        .processInstanceId(<span class="string">&quot;17501&quot;</span>)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="comment">// 得到当前流程定义的实例是否都为暂停状态,true:已暂停</span></span><br><span class="line">    <span class="keyword">boolean</span> suspended = processInstance.isSuspended();</span><br><span class="line">    <span class="comment">// 流程定义id，其实就是上面填写的id 17501</span></span><br><span class="line">    String processDefinitionId = processInstance.getId();</span><br><span class="line">    System.out.println(processDefinitionId); </span><br><span class="line">    <span class="comment">// 判断是否为暂停</span></span><br><span class="line">    <span class="keyword">if</span>(suspended)&#123;</span><br><span class="line">        <span class="comment">// 如果是暂停，可以执行激活操作 ,参数：流程定义id</span></span><br><span class="line">        runtimeService.activateProcessInstanceById(processDefinitionId);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义：&quot;</span>+processDefinitionId+<span class="string">&quot;,已激活&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 如果是激活状态，可以暂停，参数：流程定义id</span></span><br><span class="line">        runtimeService.suspendProcessInstanceById( processDefinitionId);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义：&quot;</span>+processDefinitionId+<span class="string">&quot;,已挂起&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看单个流程实例挂起后act_ru_execution&amp;act_ru_task表的状态：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前的挂起状态-单流程：act_ru_execution.PNG" alt="当前的挂起状态-单流程：act_ru_execution"></p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/当前流程的挂起状态-单流程：act_ru_task.PNG" alt="当前流程的挂起状态-单流程：act_ru_task"></p>
<blockquote>
<p>可以看到实例id为17501的流程被挂起了，而流程id为20001的流程实例是没有被挂起的。</p>
</blockquote>
<p>在流程实例被挂起的状态去执行流程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试完成个人任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 完成任务,参数：流程实例id,完成zhangsan的任务</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processInstanceId(<span class="string">&quot;17501&quot;</span>)</span><br><span class="line">        .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">        .singleResult();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id=&quot;</span>+task.getProcessInstanceId());</span><br><span class="line">    System.out.println(<span class="string">&quot;任务Id=&quot;</span>+task.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;任务负责人=&quot;</span>+task.getAssignee());</span><br><span class="line">    System.out.println(<span class="string">&quot;任务名称=&quot;</span>+task.getName());</span><br><span class="line">    <span class="comment">// 测试是否能完成任务</span></span><br><span class="line">    taskService.complete(task.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当流程被挂起的状态去执行任务，此时是无法执行的，控制台输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.activiti.engine.ActivitiException: Cannot complete a suspended task</span><br></pre></td></tr></table></figure></li>
<li><p>再挂起的流程实例重新激活后再执行任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调用方法suspendSingleProcessInstance</span></span><br><span class="line">流程定义：17501,已激活</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在调用方法completTask，成功执行</span></span><br><span class="line">流程实例id=17501</span><br><span class="line">任务Id=17505</span><br><span class="line">任务负责人=zhangsan</span><br><span class="line">任务名称=创建出差申请</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="个人任务">2. 个人任务</h2>
<h3 id="分配任务负责人">2.1 分配任务负责人</h3>
<h4 id="固定分配">2.1.1 固定分配</h4>
<p>在进行业务流程建模时指定固定的任务负责人， 如图：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/责任人指定.PNG" alt="责任人指定"></p>
<h4 id="表达式分配">2.1.2 表达式分配</h4>
<p>由于固定分配方式，任务只管一步一步执行任务，执行到每一个任务将按照 bpmn 的配置去分配任务负责人。</p>
<p><strong>UEL 表达式：</strong>Activiti 使用 UEL 表达式，UEL 是 java EE6 规范的一部分，UEL（Unified Expression Language，统一表达式语言）activiti 支持两个 UEL 表达式：UEL-value 和 UEL-method。</p>
<p><strong>UEL-value 定义方式：</strong></p>
<ul>
<li>定义方式1：<code>$&#123;...&#125;</code>，在<code>&#123;&#125;</code>中填入相应的变量，即可以替换上图中Assignee中写死的值，如<code>$&#123;assignee _1&#125;</code></li>
<li>定义方式2：<code>$&#123;xxx.xxx&#125;</code>，如<code>$&#123;user.assignee_1&#125;</code>，表示 user 也是 activiti 的一个流程变量，<code>user.assignee</code>表示通过调用 user 的 getter 方法获取值</li>
</ul>
<p><strong>UEL-method 方式：</strong></p>
<ul>
<li><code>$&#123;xxxBean.getxxx&#125;</code>，如：<code>$&#123;UserBean.getUserId()&#125;</code>，其中userBean 是 spring 容器中的一个 bean，表示调用该 bean 的 <code>getUserId()</code> 方法。</li>
</ul>
<p><strong>UEL-method 与 UEL-value 结合方式：</strong></p>
<ul>
<li>比如：<code>$&#123;ldapService.findManagerForEmployee(emp)&#125;</code>，其中 ldapService 是 spring 容器的一个 bean，findManagerForEmployee 是该 bean 的一个方法，emp 是 activiti 流程变量， emp 作为参数传到 ldapService.findManagerForEmployee 方法中。</li>
</ul>
<p><strong>其它方式：</strong></p>
<ul>
<li>表达式支持解析基础类型、bean、list、array 和 map，也可作为条件判断。如下：<code>$&#123;order.price &gt; 100 &amp;&amp; order.price &lt; 250&#125;</code></li>
</ul>
<blockquote>
<p>注意事项：</p>
<p>由于使用了表达式分配，必须保证在任务执行过程表达式执行成功，比如：某个任务使用了表达式<code>$&#123;order.price &gt; 100 &amp;&amp; order.price &lt; 250&#125;</code>，当执行该任务时必须保证 order 在流程变量中存在，否则 activiti 异常。</p>
</blockquote>
<p><strong>使用UEL-value 定义方式来实现编写代码配置负责人：</strong></p>
<ol type="1">
<li><p>定义任务分配流程变量，还是用了之前的这个出差流程，但是这里的责任人通过了 UEL 表达式进行指定：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/责任人指定-UEL.PNG" alt="责任人指定-UEL"></p>
<blockquote>
<p>其他节点也和之前的相同，总共是4个节点：<code>$&#123;assignee_1&#125;</code>~<code>$&#123;assignee_4&#125;</code></p>
</blockquote></li>
<li><p>布署该流程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到RepositoryService实例</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 3、使用RepositoryService进行部署</span></span><br><span class="line">    Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;bpmn/evection-uel.bpmn&quot;</span>) <span class="comment">// 添加bpmn资源(这里就生成png了)</span></span><br><span class="line">        .name(<span class="string">&quot;出差申请流程&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    <span class="comment">// 4、输出部署信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出内容：</span></span><br><span class="line"><span class="comment">// 流程部署id：25001</span></span><br><span class="line"><span class="comment">// 流程部署名称：出差申请流程</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看布署的数据：</p>
<ul>
<li>act_re_deployment</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	NAME_	CATEGORY_	KEY_	TENANT_ID_	DEPLOY_TIME_	ENGINE_VERSION_</span><br><span class="line">25001	出差申请流程	\N	\N		2022-05-02 14:11:37	\N</span><br></pre></td></tr></table></figure>
<ul>
<li>act_re_procdef</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	CATEGORY_	NAME_	KEY_	VERSION_	DEPLOYMENT_ID_	RESOURCE_NAME_	DGRM_RESOURCE_NAME_	DESCRIPTION_	HAS_START_FORM_KEY_	HAS_GRAPHICAL_NOTATION_	SUSPENSION_STATE_	TENANT_ID_	ENGINE_VERSION_</span><br><span class="line">myEvection-uel:1:25003	1	http://www.activiti.org/testm1651471112919	出差申请-uel	myEvection-uel	1	25001	bpmn/evection-uel.bpmn	\N	\N	0	1	1		\N</span><br></pre></td></tr></table></figure>
</blockquote></li>
<li><p>设置流程变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置流程负责人</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assigneeUEL</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取 RuntimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 设置assignee的取值，用户可以在界面上设置流程的执行</span></span><br><span class="line">    Map&lt;String,Object&gt; assigneeMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    assigneeMap.put(<span class="string">&quot;assignee_1&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    assigneeMap.put(<span class="string">&quot;assignee_2&quot;</span>,<span class="string">&quot;李经理&quot;</span>);</span><br><span class="line">    assigneeMap.put(<span class="string">&quot;assignee_3&quot;</span>,<span class="string">&quot;王总经理&quot;</span>);</span><br><span class="line">    assigneeMap.put(<span class="string">&quot;assignee_4&quot;</span>,<span class="string">&quot;赵财务&quot;</span>);</span><br><span class="line">    <span class="comment">// 启动流程实例，同时还要设置流程定义的assignee的值</span></span><br><span class="line">    runtimeService.startProcessInstanceByKey(<span class="string">&quot;myEvection-uel&quot;</span>,assigneeMap);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(processEngine.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行成功后，可以在act_ru_variable表中看到刚才map中的数据：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/act_ru_variable数据.PNG" alt="act_ru_variable数据"></p></li>
</ol>
<h4 id="监听器分配">2.1.3 监听器分配</h4>
<p>可以使用监听器来完成很多Activiti流程的业务。比如通过监听器的方式来指定负责人，那么在流程设计时就不需要指定assignee。</p>
<p>任务监听器是发生对应的任务相关事件时执行自定义 java 逻辑 或表达式。</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/事件类型.PNG" alt="事件类型"></p>
<p><strong>任务事件event包括：</strong></p>
<ul>
<li>创建时间：create，任务创建后触发；</li>
<li>分配事件：assignee，任务分配后触发；</li>
<li>删除事件：delete，任务完成后触发；</li>
<li>所有时间：all，所有事件发生都触发；</li>
</ul>
<p><strong>任务类型type包括：</strong></p>
<ul>
<li>class：类，监听到事件找一个类来处理当然任务；选择class后，在后续的class栏中填入全限定类名；</li>
<li>expression：表达式，监听到事件找一个表达式来处理当然任务；</li>
<li>delegate expression：</li>
</ul>
<p><strong>一个监听器的小Demo：</strong></p>
<ol type="1">
<li><p>创建流程：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/监听流程配置.PNG" alt="监听流程配置"></p>
<blockquote>
<p>这里的话定义任务监听类：且类必须实现 org.activiti.engine.delegate.TaskListener 接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package cn.xyc.demo.listener;</span><br><span class="line"></span><br><span class="line">import org.activiti.engine.delegate.DelegateTask;</span><br><span class="line">import org.activiti.engine.delegate.TaskListener;</span><br><span class="line"></span><br><span class="line">public class MyTaskListener implements TaskListener&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重写notify方法</span><br><span class="line">     * @param delegateTask</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void notify(DelegateTask delegateTask) &#123;</span><br><span class="line">        if(delegateTask.getName().equals(&quot;创建出差申请&quot;)&amp;&amp;</span><br><span class="line">                delegateTask.getEventName().equals(&quot;create&quot;))&#123;</span><br><span class="line">            //这里指定任务负责人</span><br><span class="line">            delegateTask.setAssignee(&quot;张三&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打个断点查看类DelegateTask中的内容：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/DelegateTask类的值.PNG" alt="DelegateTask类的值"></p>
</blockquote></li>
<li><p>部署&amp;启动流程实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到RepositoryService实例</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 3、使用RepositoryService进行部署</span></span><br><span class="line">    Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;bpmn/listen-demo.bpmn&quot;</span>) <span class="comment">// 添加bpmn资源</span></span><br><span class="line">        .name(<span class="string">&quot;监听事件的Demo&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    <span class="comment">// 4、输出部署信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 流程启动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testListenerStart</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到runtimeService实例</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 3、启动（MyTaskListener中打断点查看）</span></span><br><span class="line">    runtimeService.startProcessInstanceByKey(<span class="string">&quot;listen-demo&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动完成后，可以在执行任务表act_ru_task中查看数据，可以看到其<code>ASSIGNEE_</code>属性即为上述设置的<code>张三</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">32505	1	32502	32501	listen-demo:1:30003	监听任务	\N	\N	_3	\N	张三	\N	50	2022-05-02 15:15:22	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>注意事项：使用监听器分配方式，按照监听事件去执行监听类的 notify 方法，方法如果不能正常执行也会影响任务的执行。</p>
</blockquote>
<h3 id="查询任务">2.2 查询任务</h3>
<p><strong>查询任务负责人的待办任务：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询当前个人待执行的任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPersonalTaskList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String processDefinitionKey = <span class="string">&quot;myEvection1&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assignee = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    List&lt;Task&gt; taskList = taskService.createTaskQuery()</span><br><span class="line">    	.processDefinitionKey(processDefinitionKey)</span><br><span class="line">    	.includeProcessVariables()</span><br><span class="line">        .taskAssignee(assignee)</span><br><span class="line">        .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : taskList) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id： &quot;</span> + task.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id： &quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人： &quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称： &quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>关联 businessKey：</strong></p>
<ul>
<li><p>需求：在 activiti 实际应用时，查询待办任务可能要显示出业务系统的一些相关信息。</p>
<p>比如：查询待审批出差任务列表需要将出差单的日期、 出差天数等信息显示出来。</p>
<p>出差天数等信息在业务系统中存在，而并没有在 activiti 数据库中存在，所以是无法通过 activiti 的 api 查询到出差天数等信息。</p></li>
<li><p>实现：在查询待办任务时，通过 businessKey（业务标识 ）关联查询业务系统的出差单表，查询出出差天数等信息。</p></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关联 businessKey</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findProcessInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 获取RuntimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 查询流程定义的对象</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(<span class="string">&quot;myEvection1&quot;</span>)</span><br><span class="line">        .taskAssignee(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="comment">// 使用task对象获取实例id</span></span><br><span class="line">    String processInstanceId = task.getProcessInstanceId();</span><br><span class="line">    <span class="comment">// 使用实例id，获取流程实例对象</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService.createProcessInstanceQuery()</span><br><span class="line">        .processInstanceId(processInstanceId)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="comment">// 使用processInstance，得到 businessKey，然后就可以用bussinesskey去关联业务表了</span></span><br><span class="line">    String businessKey = processInstance.getBusinessKey();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;businessKey=&quot;</span>+businessKey);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="办理任务">2.3 办理任务</h3>
<blockquote>
<p>注意：在实际应用中，完成任务前需要校验任务的负责人是否具有该任务的办理权限 。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务，判断当前用户是否有权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 任务id</span></span><br><span class="line">    String taskId = <span class="string">&quot;15005&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assingee = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 完成任务前，需要校验该负责人可以完成当前任务</span></span><br><span class="line">    <span class="comment">// 校验方法：根据任务id和任务负责人查询当前任务，如果查到该用户有权限，就完成</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .taskId(taskId)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        taskService.complete(taskId);</span><br><span class="line">        System.out.println(<span class="string">&quot;完成任务&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="流程变量">3. 流程变量</h2>
<h3 id="流程变量-1">3.1 流程变量</h3>
<p><strong>流程变量：</strong></p>
<ul>
<li>流程变量在 activiti 中是一个非常重要的角色，流程运转有时需要靠流程变量，业务系统和 activiti 结合时少不了流程变量，流程变量就是 activiti 在管理工作流时根据管理需要而设置的变量。</li>
<li>比如：在出差申请流程流转时如果出差天数大于 3 天则由总经理审核，否则由人事直接审核，出差天数就可以设置为流程变量，在流程流转时使用。</li>
<li><strong>注意：虽然流程变量中可以存储业务数据，可以通过activiti的api查询流程变量从而实现查询业务数据，但是不建议这样使用，因为业务数据查询由业务系统负责，activiti设置流程变量是为了流程执行需要而创建。</strong></li>
</ul>
<p><strong>流程变量类型：</strong></p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/流程变量.png" alt="流程变量"></p>
<blockquote>
<p>注意：如果将 pojo 存储到流程变量中，必须实现序列化接口 serializable，为了防止由于新增字段无法反序列化，需要生成 serialVersionUID。</p>
</blockquote>
<h3 id="流程变量作用域">3.2 流程变量作用域</h3>
<p>流程变量的作用域可以是一个流程实例(processInstance)；或一个任务(task)；或一个执行实例(execution)。</p>
<p><strong>globa变量</strong></p>
<ul>
<li><p>流程变量的默认作用域是流程实例，当一个流程变量的作用域为流程实例时，可以称为 global 变量；</p></li>
<li><p>注意：</p>
<p>如：Global变量：userId(变量名)：zhangsan(变量值)</p>
<p>global 变量中变量名不允许重复，设置相同名称的变量，后设置的值会覆盖前设置的变量值。</p></li>
</ul>
<p><strong>local变量</strong></p>
<ul>
<li><p>任务和执行实例仅仅是针对一个任务和一个执行实例范围，范围没有流程实例大，称为 local 变量；</p></li>
<li>Local 变量由于在不同的任务或不同的执行实例中，作用域互不影响，变量名可以相同没有影响；</li>
<li><p>Local 变量名也可以和 global 变量名相同，没有影响。</p></li>
</ul>
<h3 id="流程变量的使用方法">3.3 流程变量的使用方法</h3>
<p><strong>在属性上使用UEL表达式：</strong></p>
<ul>
<li><p>可以在 assignee 处设置 UEL 表达式，表达式的值为任务的负责人，比如：<code>$&#123;assignee&#125;</code>，assignee 就是一个流程变量名称；</p></li>
<li><p>Activiti获取UEL表达式的值，即流程变量assignee的值 ，将assignee的值作为任务的负责人进行任务分配。</p></li>
</ul>
<p><strong>在连线上使用UEL表达式：</strong></p>
<ul>
<li><p>可以在连线上设置UEL表达式，决定流程走向，比如：<code>$&#123;price&lt;10000&#125;</code>，price就是一个流程变量名称，uel表达式结果类型为布尔类型；</p></li>
<li><p>如果UEL表达式是true，要决定流程执行走向。</p></li>
</ul>
<h3 id="使用global变量控制流程">3.4 使用Global变量控制流程</h3>
<h4 id="需求">3.4.1 需求</h4>
<p>员工创建出差申请单，由部门经理审核：</p>
<ul>
<li>部门经理审核通过后出差3天及以下由人财务直接审批；</li>
<li>3天以上先由总经理审核，总经理审核通过再由财务审批。</li>
</ul>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-1.PNG" alt="条件-1"></p>
<h4 id="流程定义">3.4.2 流程定义</h4>
<ol type="1">
<li><p>出差天数大于等于3连线条件：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-2.PNG" alt="条件-2"></p>
<p>也可以使用对象参数命名，如evection.num：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-3.PNG" alt="条件-3"></p></li>
<li><p>出差天数小于3连线条件，也可以使用对象参数命名，如：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-4.PNG" alt="条件-4"></p></li>
</ol>
<h4 id="流程布署">3.4.3 流程布署</h4>
<p>将刚刚设计好的流程进行部署：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 流程部署</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、获取RepositoryServcie</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 3、使用service进行流程的部署，定义一个流程的名字，把bpmn和png部署到数据中</span></span><br><span class="line">    Deployment deploy = repositoryService.createDeployment()</span><br><span class="line">            .name(<span class="string">&quot;出差申请流程-variables&quot;</span>)</span><br><span class="line">            .addClasspathResource(<span class="string">&quot;bpmn/evection-global.bpmn&quot;</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">    <span class="comment">// 4、输出部署信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id=&quot;</span>+deploy.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名字=&quot;</span>+deploy.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>布署后的.bpmn文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> <span class="attr">xmlns:activiti</span>=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> <span class="attr">xmlns:dc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> <span class="attr">xmlns:di</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> <span class="attr">xmlns:tns</span>=<span class="string">&quot;http://www.activiti.org/testm1651545432300&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> <span class="attr">id</span>=<span class="string">&quot;m1651545432300&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.activiti.org/testm1651545432300&quot;</span> <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;myEvection-global&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差申请-global&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;StartEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;$&#123;assignee1&#125;&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;创建出差申请&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;$&#123;assignee2&#125;&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;部门经理审核&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;$&#123;assignee3&#125;&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;总经理审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;$&#123;assignee4&#125;&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;财务审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bpmndi:BPMNDiagram</span> <span class="attr">documentation</span>=<span class="string">&quot;background=#3C3F41;count=1;horizontalcount=1;orientation=0;width=842.4;height=1195.2;imageableWidth=832.4;imageableHeight=1185.2;imageableX=5.0;imageableY=5.0&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Diagram-_1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;New Diagram&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bpmndi:BPMNPlane</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;myEvection-global&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Shape-_2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;-5.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;15.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Shape-_3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;20.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Shape-_4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;220.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;20.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Shape-_5&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;360.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;20.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Shape-_6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;365.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;120.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Shape-_7&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;505.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;145.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;32.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge__13&quot;</span> <span class="attr">sourceElement</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetElement</span>=<span class="string">&quot;_7&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;450.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;147.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;505.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;161.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge__12&quot;</span> <span class="attr">sourceElement</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetElement</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;405.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;75.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;405.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;120.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge__8&quot;</span> <span class="attr">sourceElement</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetElement</span>=<span class="string">&quot;_3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;27.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;31.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;85.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;47.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge__9&quot;</span> <span class="attr">sourceElement</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetElement</span>=<span class="string">&quot;_4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;170.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;47.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;220.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;47.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge__11&quot;</span> <span class="attr">sourceElement</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetElement</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;305.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;47.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;365.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;147.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge__10&quot;</span> <span class="attr">sourceElement</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetElement</span>=<span class="string">&quot;_5&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;305.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;47.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">di:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;360.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;47.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bpmndi:BPMNPlane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bpmndi:BPMNDiagram</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="设置global流程变量">3.4.4 设置global流程变量</h4>
<p>在部门经理审核前设置流程变量，变量值为出差单信息（包括出差天数），部门经理审核后可以根据流程变量的值决定流程走向。</p>
<p>在设置流程变量时，<strong>可以在启动流程时设置，也可以在任务办理时设置</strong>。</p>
<p><strong>创建POJO对象</strong>：创建出差申请pojo对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 出差申请 pojo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Evection</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出差申请单名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String evectionName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出差天数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double num;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 预计开始时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date beginDate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 预计结束时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date endDate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 目的地</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String destination;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出差事由</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String reson;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="启动流程时设置变量">3.4.4.1 启动流程时设置变量</h5>
<p>在启动流程时设置流程变量，变量的作用域是整个流程实例。</p>
<p>通过Map&lt;key,value&gt;设置流程变量，map中可以设置多个变量，这个key就是流程变量的名字。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例,设置流程变量的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startProcess</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取runtimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String processKey = <span class="string">&quot;myEvection-global&quot;</span>;</span><br><span class="line">    <span class="comment">// 创建变量集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象，设置出差天数</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    evection.setNum(<span class="number">2d</span>);</span><br><span class="line">    <span class="comment">// 定义流程变量，把出差pojo对象放入map</span></span><br><span class="line">    map.put(<span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">    <span class="comment">// 设置assignee的取值，用户可以在界面上设置流程的执行</span></span><br><span class="line">    map.put(<span class="string">&quot;assignee1&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;assignee2&quot;</span>,<span class="string">&quot;李经理&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;assignee3&quot;</span>,<span class="string">&quot;王总经理&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;assignee4&quot;</span>,<span class="string">&quot;赵财务&quot;</span>);</span><br><span class="line">    <span class="comment">// 启动流程实例，并设置流程变量的值（把map传入）</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processKey, map);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例名称=&quot;</span>+processInstance.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id=&quot;</span>+processInstance.getProcessDefinitionId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 流程实例名称=null</span></span><br><span class="line"><span class="comment">// 流程定义id=myEvection-global:1:35003</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：<code>startProcessInstanceByKey(processDefinitionKey, variables)</code>，流程变量作用域是一个流程实例，<strong>流程变量使用Map存储</strong>，同一个流程实例设置变量map中key相同，后者覆盖前者。</p>
</blockquote>
<p>查看表act_ru_variable中的数据，可以看到上述设置的数据：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/variables：act_ru_variable.PNG" alt="variables：act_ru_variable"></p>
<blockquote>
<p>列说明：<code>Id_：主键  / Type_：变量类型 / Name_：变量名称  / Execution_id_：所属流程实例执行id，global和local变量都存储 / Proc_inst_id_：所属流程实例id，global和local变量都存储  / Task_id_：所属任务id，local变量存储 / Bytearray_：serializable类型变量存储对应act_ge_bytearray表的id / Double_：double类型变量值 / Long_：long类型变量值/ Text_：text类型变量值</code></p>
</blockquote>
<h5 id="任务办理时设置变量">3.4.4.2 任务办理时设置变量</h5>
<p>在完成任务时设置流程变量，该流程变量只有在该任务完成后其它结点才可使用该变量，它的作用域是整个流程实例，如果设置的流程变量的key在流程实例中已存在相同的名字则后设置的变量替换前边设置的变量。</p>
<p>这里需要在创建出差单任务完成时设置流程变量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务，即在任务办理时设置变量值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 任务id</span></span><br><span class="line">    String key = <span class="string">&quot;myEvection-global&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assingee = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 创建变量集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    <span class="comment">// 设置出差天数</span></span><br><span class="line">    evection.setNum(<span class="number">2d</span>);</span><br><span class="line">    <span class="comment">// 定义流程变量</span></span><br><span class="line">    map.put(<span class="string">&quot;evection&quot;</span>,evection);</span><br><span class="line">    <span class="comment">// 完成任务前，需要校验该负责人可以完成当前任务</span></span><br><span class="line">    <span class="comment">// 校验方法：根据任务id和任务负责人查询当前任务，如果查到该用户有权限，就完成</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(key)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 完成任务是，设置流程变量的值，放入这map</span></span><br><span class="line">        taskService.complete(task.getId(),map);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务执行完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：通过当前任务设置流程变量，需要指定当前任务id，如果当前执行的任务id不存在则抛出异常。任务办理时也是通过<code>map&lt;key,value&gt;</code>设置流程变量，一次可以设置多个变量。</p>
</blockquote>
<h5 id="通过当前流程实例设置">3.4.4.3 通过当前流程实例设置</h5>
<p>通过流程实例id设置全局变量，<strong>该流程实例必须未执行完成</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGlobalVariableByExecutionId</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 当前流程实例执行 id，通常设置为当前执行的流程实例</span></span><br><span class="line">    String executionId=<span class="string">&quot;47501&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取RuntimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    <span class="comment">// 设置天数</span></span><br><span class="line">    evection.setNum(<span class="number">3d</span>);</span><br><span class="line">    <span class="comment">// 通过流程实例 id设置流程变量</span></span><br><span class="line">    runtimeService.setVariable(executionId, <span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">    <span class="comment">// 也可以一次设置多个值，就是之前的map形式</span></span><br><span class="line">    <span class="comment">// runtimeService.setVariables(executionId, variables)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从表act_ru_execution中获取到的流程实例id：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	PROC_INST_ID_	BUSINESS_KEY_	PARENT_ID_	PROC_DEF_ID_	SUPER_EXEC_	ROOT_PROC_INST_ID_	ACT_ID_	IS_ACTIVE_	IS_CONCURRENT_	IS_SCOPE_	IS_EVENT_SCOPE_	IS_MI_ROOT_	SUSPENSION_STATE_	CACHED_ENT_STATE_	TENANT_ID_	NAME_	START_TIME_	START_USER_ID_	LOCK_TIME_	IS_COUNT_ENABLED_	EVT_SUBSCR_COUNT_	TASK_COUNT_	JOB_COUNT_	TIMER_JOB_COUNT_	SUSP_JOB_COUNT_	DEADLETTER_JOB_COUNT_	VAR_COUNT_	ID_LINK_COUNT_</span><br><span class="line">47506	1	47501	\N	47501	myEvection-global:1:35003	\N	47501	_3	1	0	0	0	0	1	\N		\N	2022-05-03 12:01:29	\N	\N	0	0	0	0	0	0	0	0	0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：executionId 必须当前未结束流程实例的执行id，通常此id设置流程实例的id。也可以通<code>runtimeService.getVariable()</code> 获取流程变量。</p>
</blockquote>
<h5 id="通过当前任务设置">3.4.4.4 通过当前任务设置</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGlobalVariableByTaskId</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前待办任务id，这个任务id可以从act_ru_task中获取</span></span><br><span class="line">    String taskId=<span class="string">&quot;47509&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    evection.setNum(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 通过任务设置流程变量</span></span><br><span class="line">    taskService.setVariable(taskId, <span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">    <span class="comment">// 一次设置多个值，就是之前的map形式</span></span><br><span class="line">    <span class="comment">// taskService.setVariables(taskId, variables)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从表act_ru_task中获取到的任务id：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">47509	1	47506	47501	myEvection-global:1:35003	创建出差申请	\N	\N	_3	\N	张三	\N	50	2022-05-03 12:01:29	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：任务id必须是当前待办任务id，act_ru_task中存在。如果该任务已结束，会报错也可以通过<code>taskService.getVariable()</code> 获取流程变量。</p>
</blockquote>
<h4 id="分支测试">3.4.5 分支测试</h4>
<p><strong>分支1：出差天数小于3天的</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务-节点1：创建出差申请</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 任务id</span></span><br><span class="line">    String processKey = <span class="string">&quot;myEvection-global&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assingee = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 完成任务前，需要校验该负责人可以完成当前任务</span></span><br><span class="line">    <span class="comment">// 校验方法：根据任务id和任务负责人查询当前任务，如果查到该用户有权限，就完成</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(processKey)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务执行完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务-节点2：部门经理审核</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String assingee = <span class="string">&quot;李经理&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>这里设置的出差天数为：<code>evection.setNum(2d);</code>，因此当<code>节点2：部门经理审核</code>完成后，应该走的是<code>财务审批节点</code>，查看数据库中表 act_ru_task 中的任务节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">42502	1	37509	37501	myEvection-global:1:35003	财务审批	\N	\N	_6	\N	赵财务	\N	50	2022-05-03 11:26:55	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
<p>可以看到，已经到了<code>财务审批节点</code>，没有走这个<code>总经理审批</code>节点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务-节点4：财务审批</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String assingee = <span class="string">&quot;赵财务&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>查看表 act_hi_procinst 数据，可以看到这条流程已经走完了：</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/条件-5.PNG" alt="条件-5"></p>
<p><strong>分支2：出差天数大于等于3天的</strong></p>
<blockquote>
<p>前面的操作还是一样：开启流程&amp;执行任务，不过这里不同的就是在开启流程时，不设置出差的pojo对象，而是通过当前流程实例来进行设置。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例,设置流程变量的值-分支2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startProcess2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取runtimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String processKey = <span class="string">&quot;myEvection-global&quot;</span>;</span><br><span class="line">    <span class="comment">// 创建变量集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象，设置出差天数</span></span><br><span class="line">    map.put(<span class="string">&quot;assignee1&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;assignee2&quot;</span>,<span class="string">&quot;李经理&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;assignee3&quot;</span>,<span class="string">&quot;王总经理&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;assignee4&quot;</span>,<span class="string">&quot;赵财务&quot;</span>);</span><br><span class="line">    <span class="comment">// 启动流程实例，并设置流程变量的值（把map传入）</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processKey, map);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例名称=&quot;</span>+processInstance.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id=&quot;</span>+processInstance.getProcessDefinitionId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后通过当前流程实例来设置pojo对象：</p>
<blockquote>
<p>其中的流程实例的id可以在表act_ru_execution中的列<code>PROC_INST_ID_</code>中找到</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGlobalVariableByExecutionId</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 当前流程实例执行 id，通常设置为当前执行的流程实例</span></span><br><span class="line">    String executionId=<span class="string">&quot;47501&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取RuntimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    <span class="comment">// 设置天数</span></span><br><span class="line">    evection.setNum(<span class="number">3d</span>);</span><br><span class="line">    <span class="comment">// 通过流程实例 id设置流程变量</span></span><br><span class="line">    runtimeService.setVariable(executionId, <span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">    <span class="comment">// 一次设置多个值</span></span><br><span class="line">    <span class="comment">// runtimeService.setVariables(executionId, variables)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行完成后，创建的出差pojo对象就设置成功了，这时再继续完成后续任务节点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 完成任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 任务id</span></span><br><span class="line">    String processKey = <span class="string">&quot;myEvection-global&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assingee = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">    <span class="comment">//  String assingee = &quot;李经理&quot;;</span></span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 完成任务前，需要校验该负责人可以完成当前任务</span></span><br><span class="line">    <span class="comment">// 校验方法：根据任务id和任务负责人查询当前任务，如果查到该用户有权限，就完成</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(processKey)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务执行完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当<code>部门经理审核</code>审核完成后，这时由于设置的出差天数为：<code>evection.setNum(3d);</code>后续走的就是<code>总经理审批</code>节点吗，查看数据库中表 act_ru_task 中的任务节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">55002	1	47506	47501	myEvection-global:1:35003	总经理审批	\N	\N	_5	\N	王总经理	\N	50	2022-05-03 13:36:51	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
<p>可以看到确实走是<code>总经理审批</code>，继续执行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 替换上述的任务责任人：</span></span><br><span class="line">String assingee = <span class="string">&quot;王总经理&quot;</span>;</span><br><span class="line">String assingee = <span class="string">&quot;赵财务&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>当节点<code>财务审批</code>完成审批后，整个实例就执行完成，可以查看表 act_hi_procinst：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	PROC_INST_ID_	BUSINESS_KEY_	PROC_DEF_ID_	START_TIME_	END_TIME_	DURATION_	START_USER_ID_	START_ACT_ID_	END_ACT_ID_	SUPER_PROCESS_INSTANCE_ID_	DELETE_REASON_	TENANT_ID_	NAME_</span><br><span class="line">47501	47501	\N	myEvection-global:1:35003	2022-05-03 12:01:29	2022-05-03 13:39:38	5889759	\N	_2	_7	\N	\N		\N</span><br></pre></td></tr></table></figure>
<h4 id="注意事项">3.4.6 注意事项</h4>
<ol type="1">
<li><p>如果UEL表达式中流程变量名不存在则报错；</p></li>
<li><p>如果UEL表达式中流程变量值为空NULL，流程不按UEL表达式去执行，而流程结束；</p></li>
<li><p>如果UEL表达式都不符合条件，流程结束；</p></li>
<li><p>如果连线不设置条件，会走flow序号小的那条线。</p>
<blockquote>
<p>可以查看定义的流程文件信息：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果没定义这个conditionExpression的话，默认走的就是flow序号较小的，即<code>id=&quot;_10&quot;</code>的这条。</p>
<blockquote>
<p><strong>实测：会生成所有下一个节点的任务！</strong></p>
</blockquote>
</blockquote></li>
</ol>
<h3 id="设置local流程变量">3.5 设置local流程变量</h3>
<h4 id="任务办理时设置">3.5.1 任务办理时设置</h4>
<p>任务办理时设置local流程变量，当前运行的流程实例只能在该任务结束前使用，任务结束该变量无法在当前流程实例使用，可以通过查询历史任务查询。</p>
<blockquote>
<p>其他的流程开始啥的都和上面一致</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理任务时设置local流程变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTaskLocal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 任务id，从表act_ru_task中获取</span></span><br><span class="line">    String taskId = <span class="string">&quot;62509&quot;</span>;  <span class="comment">// 第一个节点</span></span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 定义流程变量</span></span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection ();</span><br><span class="line">    evection.setNum(<span class="number">3d</span>);</span><br><span class="line">    <span class="comment">// 变量名是holiday，变量值是holiday对象</span></span><br><span class="line">    variables.put(<span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">    <span class="comment">// 设置local变量，作用域为该任务，注意这里是setVariablesLocal，而全局的是setVariable</span></span><br><span class="line">    taskService.setVariablesLocal(taskId, variables);</span><br><span class="line">    <span class="comment">// 完成任务</span></span><br><span class="line">    taskService.complete(taskId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：设置作用域为任务的local变量，每个任务可以设置同名的变量，互不影响。</p>
</blockquote>
<h4 id="通过当前任务设置-1">3.5.2 通过当前任务设置</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过当前任务设置local变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocalVariableByTaskId</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// 当前待办任务id</span></span><br><span class="line">    String taskId=<span class="string">&quot;65005&quot;</span>;  <span class="comment">// 第二个节点</span></span><br><span class="line">	<span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection ();</span><br><span class="line">    evection.setNum(<span class="number">3d</span>);</span><br><span class="line">	<span class="comment">// 通过任务设置流程变量</span></span><br><span class="line">    taskService.setVariableLocal(taskId, <span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">	<span class="comment">// 一次设置多个值 </span></span><br><span class="line">    <span class="comment">// taskService.setVariablesLocal(taskId, variables)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：任务id必须是当前待办任务id，act_ru_task中存在。</p>
</blockquote>
<h4 id="local变量测试">3.5.3 Local变量测试</h4>
<p><strong>测试1：</strong></p>
<p>若上边例子中设置global变量改为设置local变量是否可行？为什么？</p>
<p>Local变量在任务结束后无法在当前流程实例执行中使用，如果后续的流程执行需要用到此变量则会报错。</p>
<blockquote>
<p>即上述将Evection设置成立local变量，后续在流程分支判断时是无法进行进行的，因为流程结束后就不认识这个变量了，报错信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.activiti.engine.ActivitiException: Unknown property used in expression: $&#123;evection.num&gt;=3&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>测试2：</strong></p>
<p>在部门经理审核、总经理审核、财务审核时设置local变量，可通过historyService查询每个历史任务时将流程变量的值也查询出来，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询每个历史任务的流程变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetHistoryLocalVariable</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建历史任务查询对象</span></span><br><span class="line">    HistoryService historyService = processEngine.getHistoryService();</span><br><span class="line">    HistoricTaskInstanceQuery historicTaskInstanceQuery = historyService.createHistoricTaskInstanceQuery();</span><br><span class="line">    <span class="comment">// 查询结果包括 local变量</span></span><br><span class="line">    HistoricTaskInstanceQuery taskInstanceQuery = historicTaskInstanceQuery.includeTaskLocalVariables();</span><br><span class="line">    List&lt;HistoricTaskInstance&gt; list = taskInstanceQuery.processInstanceId(<span class="string">&quot;62501&quot;</span>).list();</span><br><span class="line">    <span class="keyword">for</span> (HistoricTaskInstance historicTaskInstance : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==============================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + historicTaskInstance.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + historicTaskInstance.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + historicTaskInstance.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务local变量：&quot;</span> + historicTaskInstance.getTaskLocalVariables());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// ==============================</span></span><br><span class="line"><span class="comment">// 任务id：62509</span></span><br><span class="line"><span class="comment">// 任务名称：创建出差申请</span></span><br><span class="line"><span class="comment">// 任务负责人：张三</span></span><br><span class="line"><span class="comment">// 任务local变量：&#123;evection=cn.xyc.demo.listener.pojo.Evection@5f6722d3&#125;</span></span><br><span class="line"><span class="comment">// ==============================</span></span><br><span class="line"><span class="comment">// 任务id：65005</span></span><br><span class="line"><span class="comment">// 任务名称：部门经理审核</span></span><br><span class="line"><span class="comment">// 任务负责人：李经理</span></span><br><span class="line"><span class="comment">// 任务local变量：&#123;evection=cn.xyc.demo.listener.pojo.Evection@2c532cd8&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：查询历史流程变量，特别是查询pojo变量需要经过反序列化，不推荐使用。</p>
</blockquote>
<h2 id="组任务">4. 组任务</h2>
<h3 id="组任务设置">4.1 组任务设置</h3>
<p><strong>需求：</strong></p>
<ul>
<li>在流程定义中在任务结点的 assignee 固定设置任务负责人，在流程定义时将参与者固定设置在 .bpmn 文件中，如果临时任务负责人变更则需要修改流程定义，系统可扩展性差。</li>
<li>针对这种情况可以给任务设置多个候选人，<strong>可以从候选人中选择参与者来完成任务</strong>。</li>
</ul>
<p><strong>设置任务候选人：</strong></p>
<ul>
<li><p>在流程图中任务节点的配置中设置 <code>candidate-users</code>(候选人)，多个候选人之间用逗号分开。</p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/多候选人的bpmn图.PNG" alt="多候选人的bpmn图"></p></li>
<li><p>查看bpmn文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;创建出差申请&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 可以看到部门经理的审核人已经设置为 lisi,wangwu 这样的一组候选人，</span></span><br><span class="line"><span class="comment">	可以使用activiti:candiateUsers=”用户 1,用户 2,用户 3”的这种方式来实现设置一组候选人--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:candidateUsers</span>=<span class="string">&quot;lisi,wangwu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;经理审批&quot;</span>/&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;jack&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;总经理审批&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;rose&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;财务审批&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="组任务-1">4.2 组任务</h3>
<h4 id="组任务办理流程">4.2.1 组任务办理流程</h4>
<ol type="1">
<li><p><strong>查询组任务</strong></p>
<p>指定候选人，查询该候选人当前的待办任务。</p>
<p>候选人不能立即办理任务。</p></li>
<li><p><strong>拾取(claim)任务</strong></p>
<p>该组任务的所有候选人都能拾取。</p>
<p>将候选人的组任务，变成个人任务，原来候选人就变成了该任务的负责人。</p>
<p>如果拾取后不想办理该任务？需要将已经拾取的个人任务归还到组里边，将个人任务变成了组任务。</p></li>
<li><p><strong>查询个人任务</strong></p>
<p>查询方式同个人任务部分，根据assignee查询用户负责的个人任务。</p></li>
<li><p><strong>办理个人任务</strong></p></li>
</ol>
<h4 id="组任务操作">4.2.2 组任务操作</h4>
<blockquote>
<p>布署任务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xyc.activiti01.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngines;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.RepositoryService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.repository.Deployment;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CandidateTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">        <span class="comment">// 2、得到RepositoryService实例</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">        <span class="comment">// 3、使用RepositoryService进行部署</span></span><br><span class="line">        Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection-cadidate.bpmn&quot;</span>)</span><br><span class="line">                .name(<span class="string">&quot;出差申请流程-多候选人&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line">        <span class="comment">// 4、输出部署信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开启一个流程实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 启动流程实例</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStartProcess</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、获取RunTimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 3、根据流程定义Id启动流程（这里的key忘记该了，就这样吧）</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class="string">&quot;myProcess_1&quot;</span>);</span><br><span class="line">    <span class="comment">// 4、输出内容</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前活动Id：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完第一节点任务，流转到第二个节点，即多候选人节点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 任完第一节点任务，流转到第二个节点，即多候选人节点</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取taskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据流程key 和 任务的负责人 查询任务</span></span><br><span class="line">    <span class="comment">// 返回一个任务对象</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(<span class="string">&quot;myProcess_1&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">        .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">        .singleResult();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 完成任务,参数：任务id</span></span><br><span class="line">    taskService.complete(task.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当流转到多候选人节点时，由于有多个候选人还未分配责任人，因而在 act_ru_task表中，ASSIGNEE_ 字段为null，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">75002	1	72502	72501	myProcess_1:1:70003	经理审批	\N	\N	_4	\N	\N	\N	50	2022-05-08 12:01:58	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
<p>然后可以查看一下表 act_ru_identitylink（任务参与者）中的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	GROUP_ID_	TYPE_	USER_ID_	TASK_ID_	PROC_INST_ID_	PROC_DEF_ID_</span><br><span class="line">75003	1	\N	candidate	lisi	75002	\N	\N</span><br><span class="line">75004	1	\N	participant	lisi	\N	72501	\N</span><br><span class="line">75005	1	\N	candidate	wangwu	75002	\N	\N</span><br><span class="line">75006	1	\N	participant	wangwu	\N	72501	\N</span><br></pre></td></tr></table></figure>
<p>该表中记录当前参考任务用户或组，当前任务如果设置了候选人，会向该表插入候选人记录，有几个候选就插入几个。</p>
<blockquote>
<p>与act_ru_identitylink对应的还有一张历史表act_hi_identitylink，向act_ru_identitylink插入记录的同时也会向历史表插入记录。</p>
</blockquote>
</blockquote>
<p><strong>查询组任务：</strong> 根据候选人查询组任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据候选人查询组任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findGroupTaskList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String processDefinitionKey = <span class="string">&quot;myProcess_1&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务候选人</span></span><br><span class="line">    String candidateUser = <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">    <span class="comment">//  获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 查询组任务</span></span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(processDefinitionKey)</span><br><span class="line">        .taskCandidateUser(candidateUser)  <span class="comment">// 根据候选人查询</span></span><br><span class="line">        .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// ----------------------------</span></span><br><span class="line"><span class="comment">// 流程实例id：72501</span></span><br><span class="line"><span class="comment">// 任务id：75002</span></span><br><span class="line"><span class="comment">// 任务负责人：null</span></span><br><span class="line"><span class="comment">// 任务名称：经理审批</span></span><br></pre></td></tr></table></figure>
<p><strong>拾取组任务： </strong>候选人员拾取组任务后该任务变为自己的个人任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拾取组任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">claimTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 要拾取的任务id（上面可知，也可以从表act_ru_task中获取）</span></span><br><span class="line">    String taskId = <span class="string">&quot;75002&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务候选人id</span></span><br><span class="line">    String userId = <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">    <span class="comment">// 拾取任务</span></span><br><span class="line">    <span class="comment">//    即使该用户不是候选人也能拾取(建议拾取时校验是否有资格)</span></span><br><span class="line">    <span class="comment">//    校验该用户有没有拾取任务的资格</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .taskId(taskId)</span><br><span class="line">        .taskCandidateUser(userId)  <span class="comment">// 根据候选人查询</span></span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 拾取任务</span></span><br><span class="line">        taskService.claim(taskId, userId);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务拾取成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><p>即使该用户不是候选人也能拾取，建议拾取时校验是否有资格</p></li>
<li><p>组任务拾取后，该任务已有负责人，通过候选人将查询不到该任务</p></li>
</ul>
<p>拾取成功后，act_ru_task表中，ASSIGNEE_ 字段不再是null了，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">75002	2	72502	72501	myProcess_1:1:70003	经理审批	\N	\N	_4	\N	lisi	\N	50	2022-05-08 12:01:58	\N	\N	1		\N	2022-05-08 12:12:01</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>查询个人待办任务：</strong> 查询方式同个人任务查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询个人待办任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPersonalTaskList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String processDefinitionKey = <span class="string">&quot;myProcess_1&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assignee = <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 创建TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(processDefinitionKey)</span><br><span class="line">        .taskAssignee(assignee)</span><br><span class="line">        .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// ----------------------------</span></span><br><span class="line"><span class="comment">// 流程实例id：72501</span></span><br><span class="line"><span class="comment">// 任务id：75002</span></span><br><span class="line"><span class="comment">// 任务负责人：lisi</span></span><br><span class="line"><span class="comment">// 任务名称：经理审批</span></span><br></pre></td></tr></table></figure>
<p><strong>归还组任务：</strong> 如果个人不想办理该组任务，可以归还组任务，归还后该用户不再是该任务的负责人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 归还组任务，由个人任务变为组任务，还可以进行任务交接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAssigneeToGroupTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 查询任务使用TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 当前待办任务</span></span><br><span class="line">    String taskId = <span class="string">&quot;75002&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String userId = <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">    <span class="comment">// 校验userId是否是taskId的负责人，如果是负责人才可以归还组任务</span></span><br><span class="line">    Task task = taskService</span><br><span class="line">        .createTaskQuery()</span><br><span class="line">        .taskId(taskId)</span><br><span class="line">        .taskAssignee(userId)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span> (task != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果设置为null，归还组任务,该 任务没有负责人</span></span><br><span class="line">        taskService.setAssignee(taskId, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><p>建议归还任务前校验该用户是否是该任务的负责人</p></li>
<li><p>也可以通过setAssignee方法将任务委托给其它用户负责，注意被委托的用户可以不是候选人（建议不要这样使用）</p></li>
</ul>
<p>任务归还后，act_ru_task表中，ASSIGNEE_ 字段再次置为null值；且上述查询个人待办任务执行结果为空了；</p>
</blockquote>
<p><strong>任务交接：</strong>任务交接，任务负责人将任务交给其它候选人办理该任务</p>
<blockquote>
<p>交接前候选人lisi先去拾取一下任务。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 任务交接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAssigneeToCandidateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取processEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 查询任务使用TaskService</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 当前待办任务</span></span><br><span class="line">    String taskId = <span class="string">&quot;75002&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String userId = <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">    <span class="comment">// 将此任务交给其它候选人办理该 任务</span></span><br><span class="line">    String candidateuser = <span class="string">&quot;wangwu&quot;</span>;</span><br><span class="line">    <span class="comment">// 校验userId是否是taskId的负责人，如果是负责人才可以归还组任务</span></span><br><span class="line">    Task task = taskService</span><br><span class="line">        .createTaskQuery()</span><br><span class="line">        .taskId(taskId)</span><br><span class="line">        .taskAssignee(userId)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span> (task != <span class="keyword">null</span>) &#123;</span><br><span class="line">        taskService.setAssignee(taskId, candidateuser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>交接完成后，可以看到表 act_ru_task中的ASSIGNEE_字段发生改变。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">75002	5	72502	72501	myProcess_1:1:70003	经理审批	\N	\N	_4	\N	wangwu	\N	50	2022-05-08 12:01:58	\N	\N	1		\N	2022-05-08 12:19:15</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>办理个人任务：</strong>任务拾取完成后，就可以有拾取人去办理任务了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completeTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 任务ID</span></span><br><span class="line">    String taskId = <span class="string">&quot;75002&quot;</span>;</span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    processEngine.getTaskService().complete(taskId);</span><br><span class="line">    System.out.println(<span class="string">&quot;完成任务：&quot;</span>+taskId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>任务完成，流程流转到下一个节点，任务 act_ru_task 表数据如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">82502	1	72502	72501	myProcess_1:1:70003	总经理审批	\N	\N	_5	\N	jack	\N	50	2022-05-08 12:23:02	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="网关">5. 网关</h2>
<p><strong>网关作用：网关用来控制流程的流向</strong></p>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/网关.PNG" alt="网关"></p>
<h3 id="排他网关-exclusivegateway">5.1 排他网关-ExclusiveGateway</h3>
<h4 id="概述-2">5.1.1 概述</h4>
<p>排他网关：用来在流程中实现决策；当流程执行到这个网关，所有分支都会判断条件是否为true，如果为true则执行该分支。</p>
<blockquote>
<p>注意：排他网关只会选择一个为true的分支执行。<strong>如果有两个分支条件都为true，排他网关会选择id值较小的一条分支去执行。</strong></p>
</blockquote>
<p>为什么要用排他网关？</p>
<ul>
<li>不用排他网关也可以实现分支，如：在连线的condition条件上设置分支条件；</li>
<li>在连线设置condition条件的缺点：如果条件都不满足，流程就结束了(是异常结束)；但如果从网关出去的线所有条件都不满足则系统<strong>抛出异常</strong>。</li>
</ul>
<h4 id="流程定义-1">5.1.2 流程定义</h4>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/排他网关图.PNG" alt="排他网关图"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;evection-exclusive&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差审批-排他网关&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;StartEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;填写出差单&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;lisi&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;部门经理审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ExclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;总经理审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhaoliu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;财务审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数大于等于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数小于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_14&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_15&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="流程测试">5.1.3 流程测试</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到RepositoryService实例</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 3、使用RepositoryService进行部署</span></span><br><span class="line">    Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;bpmn/evection-exclusive.bpmn&quot;</span>) <span class="comment">// 添加bpmn资源</span></span><br><span class="line">        .name(<span class="string">&quot;出差审批-排他网关&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    <span class="comment">// 4、输出部署信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分支1：</strong>即 <code>exection.num&gt;=3</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例,设置流程变量的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startProcess</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取RunTimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String key = <span class="string">&quot;evection-exclusive&quot;</span>;</span><br><span class="line">    <span class="comment">// 创建变量集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    <span class="comment">// 设置出差天数</span></span><br><span class="line">    evection.setNum(<span class="number">3d</span>);</span><br><span class="line">    <span class="comment">// 定义流程变量，把出差pojo对象放入map</span></span><br><span class="line">    map.put(<span class="string">&quot;evection&quot;</span>, evection);</span><br><span class="line">    <span class="comment">// 启动流程实例，并设置流程变量的值（把map传入）</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService</span><br><span class="line">        .startProcessInstanceByKey(key, map);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例名称：&quot;</span>+processInstance.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span>+processInstance.getProcessDefinitionId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义的Key</span></span><br><span class="line">    String key = <span class="string">&quot;evection-exclusive&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    <span class="comment">//   节点1:填写出差单</span></span><br><span class="line">    <span class="comment">// String assingee = &quot;zhangsan&quot;;  </span></span><br><span class="line">    <span class="comment">//   节点2：部门经理审批</span></span><br><span class="line">    <span class="comment">// String assingee = &quot;lisi&quot;;</span></span><br><span class="line">    <span class="comment">//   节点3：根据排他网关（exection.num=3)，现在应该执行的是节点3，即总经理审批</span></span><br><span class="line">    <span class="comment">// String assingee = &quot;wangwu&quot;;  </span></span><br><span class="line">    <span class="comment">//   节点4：财务审批</span></span><br><span class="line">    String assingee = <span class="string">&quot;zhaoliu&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取taskservice</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 查询任务</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(key)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 根据任务id来   完成任务</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当执行完<code>部门经理审批</code>节点后，根据排网关，此时走的就是<code>总经理审批</code>节点，查看表act_ru_task：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">总经理审批ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">7503	1	2505	2501	evection-exclusive:1:3	总经理审批	\N	\N	_6	\N	wangwu	\N	50	2022-05-08 13:38:27	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>分支2：</strong>即 <code>exection.num&lt;3</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上述方法startProcess中：</span></span><br><span class="line">evection.setNum(<span class="number">2d</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上述方法completTask中：</span></span><br><span class="line"><span class="comment">// 任务负责人</span></span><br><span class="line"><span class="comment">//   节点1:填写出差单</span></span><br><span class="line"><span class="comment">// String assingee = &quot;zhangsan&quot;;  </span></span><br><span class="line"><span class="comment">//   节点2：部门经理审批</span></span><br><span class="line"><span class="comment">// String assingee = &quot;lisi&quot;; </span></span><br><span class="line"><span class="comment">//   节点4：财务审批，根据排他网关（exection.num=3)，现在应该执行的是节点4，即财务审批</span></span><br><span class="line">String assingee = <span class="string">&quot;zhaoliu&quot;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当执行完<code>部门经理审批</code>节点后，根据排网关，此时走的就是<code>财务审批</code>节点，查看表act_ru_task：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">20003	1	15005	15001	evection-exclusive:1:3	财务审批	\N	\N	_7	\N	zhaoliu	\N	50	2022-05-08 13:48:42	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>分支3：</strong>都满足的情况</p>
<blockquote>
<p>重新定义流程（删库重来）</p>
</blockquote>
<p>将流程定义为如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;evection-exclusive&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差审批-排他网关&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;StartEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;填写出差单&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;lisi&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;部门经理审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ExclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;总经理审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhaoliu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;财务审批&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数大于等于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数大于等于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_14&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_15&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>依据执行上方代码：<code>evection.setNum(3d);</code></p>
</blockquote>
<p>在完成节点2：<code>部门经理审批</code>时，流转到了节点3：<code>总经理审批</code>，因为此时<code>总经理审批</code>节点的id小于<code>财务审批</code>的节点id；体现出：<strong>如果有两个分支条件都为true，排他网关会选择id值较小的一条分支去执行。</strong></p>
<p><strong>分支4：</strong>异常情况，即都不满足的情况</p>
<blockquote>
<p>还是用上面分支3的流程定义，还是执行上方代码：<code>evection.setNum(2d);</code></p>
<p>在完成节点2：<code>部门经理审批</code>时，抛出异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.activiti.engine.ActivitiException: No outgoing sequence flow of the exclusive gateway <span class="string">&#x27;_5&#x27;</span> could be selected <span class="keyword">for</span> continuing the process</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="并行网关-parallelgateway">5.2 并行网关-ParallelGateway</h3>
<h4 id="概述-3">5.2.1 概述</h4>
<p><strong>并行网关：</strong>并行网关允许将流程分成多条分支，也可以把多条分支汇聚到一起，并行网关的功能是基于进入和外出顺序流的。</p>
<p><strong>fork分支：</strong>并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。</p>
<p><strong>join汇聚：</strong> 所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后，流程就会通过汇聚网关。</p>
<blockquote>
<p>注意：</p>
<ul>
<li><p>如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能；这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。</p></li>
<li><p><strong>与其他网关的主要区别是，并行网关不会解析条件。</strong> <strong>即使顺序流中定义了条件，也会被忽略。</strong></p></li>
</ul>
</blockquote>
<h4 id="流程定义-2">5.2.2 流程定义</h4>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/并行网关图.PNG" alt="并行网关图"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;evection-parallel&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;StartEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;创建出差单&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parallelGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ParallelGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;lisi&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;技术经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;项目经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parallelGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ParallelGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ExclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhaoliu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">name</span>=<span class="string">&quot;总经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数大于等于3天(不起作用)&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_14&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数小于3天(不起作用)&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_15&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_16&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_17&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_18&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数大于等于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_9&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[#&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_19&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_20&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差天数小于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_10&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><p>技术经理和项目经理是两个execution分支，在act_ru_execution表有两条记录分别是技术经理和项目经理，act_ru_execution还有一条记录表示该流程实例。</p></li>
<li><p>待技术经理和项目经理任务全部完成，在汇聚点汇聚，通过parallelGateway并行网关。</p></li>
<li><p>并行网关在业务应用中常用于会签任务，<strong>会签任务即多个参与者共同办理的任务</strong>。</p></li>
</ul>
</blockquote>
<h4 id="流程测试-1">5.2.2 流程测试</h4>
<p><strong>定义流程：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到RepositoryService实例</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 3、使用RepositoryService进行部署</span></span><br><span class="line">    Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;bpmn/evection-parallel.bpmn&quot;</span>)</span><br><span class="line">        .name(<span class="string">&quot;出差申请-并行网关&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    <span class="comment">// 4、输出部署信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>启动流程实例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例,设置流程变量的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startProcess</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取RunTimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String key = <span class="string">&quot;evection-parallel&quot;</span>;</span><br><span class="line">    <span class="comment">// 创建变量集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    <span class="comment">// 设置出差天数</span></span><br><span class="line">    evection.setNum(<span class="number">4d</span>);</span><br><span class="line">    <span class="comment">// 定义流程变量，把出差pojo对象放入map</span></span><br><span class="line">    map.put(<span class="string">&quot;evection&quot;</span>,evection);</span><br><span class="line">    <span class="comment">// 启动流程实例，并设置流程变量的值（把map传入）</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService</span><br><span class="line">        .startProcessInstanceByKey(key, map);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例名称：&quot;</span>+processInstance.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span>+processInstance.getProcessDefinitionId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>执行流程：</strong>节点1<code>创建出差单</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 执行流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义的Key</span></span><br><span class="line">    String key = <span class="string">&quot;evection-parallel&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assingee = <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取taskservice</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 查询任务</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(key)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 根据任务id来   完成任务</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行完第一个任务节点后，进入并行网关，查看表数据：</p>
<ul>
<li><p>act_ru_task，在任务执行表中，存在两条任务（根据上面设置的条件，可以看出并行网关的条件设定是不起作用的）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">5004	1	2505	2501	evection-parallel:1:3	技术经理	\N	\N	_5	\N	lisi	\N	50	2022-05-08 14:35:31	\N	\N	1		\N	\N</span><br><span class="line">5007	1	5002	2501	evection-parallel:1:3	项目经理	\N	\N	_6	\N	wangwu	\N	50	2022-05-08 14:35:31	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure></li>
<li><p>act_ru_identitylink，任务执行人表中，可以看到有3条数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	GROUP_ID_	TYPE_	USER_ID_	TASK_ID_	PROC_INST_ID_	PROC_DEF_ID_</span><br><span class="line">2509	1	\N	participant	zhangsan	\N	2501	\N</span><br><span class="line">5005	1	\N	participant	lisi	\N	2501	\N</span><br><span class="line">5008	1	\N	participant	wangwu	\N	2501	\N</span><br></pre></td></tr></table></figure></li>
<li><p>act_ru_execution，查询流程实例执行表，可以看到有两个分支在执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	PROC_INST_ID_	BUSINESS_KEY_	PARENT_ID_	PROC_DEF_ID_	SUPER_EXEC_	ROOT_PROC_INST_ID_	ACT_ID_	IS_ACTIVE_	IS_CONCURRENT_	IS_SCOPE_	IS_EVENT_SCOPE_	IS_MI_ROOT_	SUSPENSION_STATE_	CACHED_ENT_STATE_	TENANT_ID_	NAME_	START_TIME_	START_USER_ID_	LOCK_TIME_	IS_COUNT_ENABLED_	EVT_SUBSCR_COUNT_	TASK_COUNT_	JOB_COUNT_	TIMER_JOB_COUNT_	SUSP_JOB_COUNT_	DEADLETTER_JOB_COUNT_	VAR_COUNT_	ID_LINK_COUNT_</span><br><span class="line">2501	2	2501	\N	\N	evection-parallel:1:3	\N	2501	\N	1	0	1	0	0	1	\N		\N	2022-05-08 14:33:17	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">2505	2	2501	\N	2501	evection-parallel:1:3	\N	2501	_5	1	0	0	0	0	1	\N		\N	2022-05-08 14:33:17	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">5002	1	2501	\N	2501	evection-parallel:1:3	\N	2501	_6	1	0	0	0	0	1	\N		\N	2022-05-08 14:35:31	\N	\N	0	0	0	0	0	0	0	0	0</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<p><strong>执行流程：</strong>继续执行，随意执行一个分支节点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上述方法：completTask</span></span><br><span class="line"><span class="comment">// 任务负责人：技术经理lisi</span></span><br><span class="line">String assingee = <span class="string">&quot;lisi&quot;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对并行任务的执行：并行任务执行不分前后，由任务的负责人去执行即可。</p>
<p>当执行完成后，act_ru_task表中就少了一条数据。</p>
<p>在流程实例执行表act_ru_execution中有中多个分支存在且有并行网关的汇聚结点：（第二条数据）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	PROC_INST_ID_	BUSINESS_KEY_	PARENT_ID_	PROC_DEF_ID_	SUPER_EXEC_	ROOT_PROC_INST_ID_	ACT_ID_	IS_ACTIVE_	IS_CONCURRENT_	IS_SCOPE_	IS_EVENT_SCOPE_	IS_MI_ROOT_	SUSPENSION_STATE_	CACHED_ENT_STATE_	TENANT_ID_	NAME_	START_TIME_	START_USER_ID_	LOCK_TIME_	IS_COUNT_ENABLED_	EVT_SUBSCR_COUNT_	TASK_COUNT_	JOB_COUNT_	TIMER_JOB_COUNT_	SUSP_JOB_COUNT_	DEADLETTER_JOB_COUNT_	VAR_COUNT_	ID_LINK_COUNT_</span><br><span class="line">2501	3	2501	\N	\N	evection-parallel:1:3	\N	2501	\N	1	0	1	0	0	1	\N		\N	2022-05-08 14:33:17	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">2505	3	2501	\N	2501	evection-parallel:1:3	\N	2501	_7	0	0	0	0	0	1	\N		\N	2022-05-08 14:33:17	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">5002	1	2501	\N	2501	evection-parallel:1:3	\N	2501	_6	1	0	0	0	0	1	\N		\N	2022-05-08 14:35:31	\N	\N	0	0	0	0	0	0	0	0	0</span><br></pre></td></tr></table></figure>
<p>有并行网关的汇聚结点：说明有一个分支已经到汇聚，等待其它的分支到达。</p>
</blockquote>
<p><strong>执行流程：</strong>继续执行剩下的一个节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String assingee = <span class="string">&quot;wangwu&quot;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当所有分支任务都完成，都到达汇聚结点后：流程实例执行表act_ru_execution，执行流程实例已经变为总经理审批（由于之前条件设置为了<code>evection.num=4</code>)，说明流程执行已经通过并行网关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	PROC_INST_ID_	BUSINESS_KEY_	PARENT_ID_	PROC_DEF_ID_	SUPER_EXEC_	ROOT_PROC_INST_ID_	ACT_ID_	IS_ACTIVE_	IS_CONCURRENT_	IS_SCOPE_	IS_EVENT_SCOPE_	IS_MI_ROOT_	SUSPENSION_STATE_	CACHED_ENT_STATE_	TENANT_ID_	NAME_	START_TIME_	START_USER_ID_	LOCK_TIME_	IS_COUNT_ENABLED_	EVT_SUBSCR_COUNT_	TASK_COUNT_	JOB_COUNT_	TIMER_JOB_COUNT_	SUSP_JOB_COUNT_	DEADLETTER_JOB_COUNT_	VAR_COUNT_	ID_LINK_COUNT_</span><br><span class="line">2501	4	2501	\N	\N	evection-parallel:1:3	\N	2501	\N	1	0	1	0	0	1	\N		\N	2022-05-08 14:33:17	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">5002	2	2501	\N	2501	evection-parallel:1:3	\N	2501	_9	1	0	0	0	0	1	\N		\N	2022-05-08 14:35:31	\N	\N	0	0	0	0	0	0	0	0	0</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>总结：所有分支到达汇聚结点，并行网关执行完成。</strong></p>
<h3 id="包含网关-inclusivegateway">5.3 包含网关-InclusiveGateway</h3>
<h4 id="概述-4">5.3.1 概述</h4>
<p><strong>包含网关：</strong>可以看做是排他网关和并行网关的结合体。</p>
<ul>
<li>和排他网关一样，可以在外出顺序流上定义条件，包含网关会解析它们；</li>
<li>但是主要的区别是包含网关可以选择多于一条顺序流，这和并行网关一样。</li>
</ul>
<p>包含网关的功能是基于进入和外出顺序流的：</p>
<ul>
<li><p>分支：所有外出顺序流的条件都会被解析，结果为true的顺序流会以并行方式继续执行，会为每个顺序流创建一个分支。</p></li>
<li><p>汇聚：所有并行分支到达包含网关，会进入等待状态，直到每个包含流程token的进入顺序流的分支都到达；这是与并行网关的最大不同。换句话说，<strong>包含网关只会等待被选中执行了的进入顺序流</strong>。 在汇聚之后，流程会穿过包含网关继续执行。</p></li>
</ul>
<h4 id="流程定义-3">5.3.2 流程定义</h4>
<blockquote>
<p>出差申请大于等于3天需要由项目经理审批，小于3天由技术经理审批，出差申请必须经过人事经理审批。</p>
</blockquote>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/包含网关图.PNG" alt="包含网关图"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;evection-inclusive&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差申请-包含网关&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;StartEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;创建出差申请&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;InclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;lisi&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;项目经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;人事经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhaoliu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;技术经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">name</span>=<span class="string">&quot;InclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ExclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;qianqi&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">name</span>=<span class="string">&quot;总经理&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_14&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差大于等于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_15&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_16&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差小于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_17&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_18&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_19&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_20&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_9&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_21&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差大于等于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_10&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&gt;=3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_22&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差小于3天&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_11&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;evection.num&lt;3&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_23&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_11&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="流程测试-2">5.3.3 流程测试</h4>
<p><strong>定义流程：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeployment</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、创建ProcessEngine</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 2、得到RepositoryService实例</span></span><br><span class="line">    RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">// 3、使用RepositoryService进行部署</span></span><br><span class="line">    Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;bpmn/evection-inclusive.bpmn&quot;</span>)</span><br><span class="line">        .name(<span class="string">&quot;出差流程-包含网关&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    <span class="comment">// 4、输出部署信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>启动流程实例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例,设置流程变量的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startProcess</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取RunTimeService</span></span><br><span class="line">    RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 流程定义key</span></span><br><span class="line">    String key = <span class="string">&quot;evection-inclusive&quot;</span>;</span><br><span class="line">    <span class="comment">// 创建变量集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 创建出差pojo对象</span></span><br><span class="line">    Evection evection = <span class="keyword">new</span> Evection();</span><br><span class="line">    <span class="comment">// 设置出差天数</span></span><br><span class="line">    evection.setNum(<span class="number">4d</span>);</span><br><span class="line">    <span class="comment">// 定义流程变量，把出差pojo对象放入map</span></span><br><span class="line">    map.put(<span class="string">&quot;evection&quot;</span>,evection);</span><br><span class="line">    <span class="comment">// 启动流程实例，并设置流程变量的值（把map传入）</span></span><br><span class="line">    ProcessInstance processInstance = runtimeService</span><br><span class="line">        .startProcessInstanceByKey(key, map);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例名称：&quot;</span>+processInstance.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span>+processInstance.getProcessDefinitionId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>执行流程：</strong>节点1<code>创建出差单</code>，执行完成后就进入了包含网关</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 执行流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 流程定义的Key</span></span><br><span class="line">    String key = <span class="string">&quot;evection-inclusive&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    String assingee = <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取流程引擎</span></span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 获取taskservice</span></span><br><span class="line">    TaskService taskService = processEngine.getTaskService();</span><br><span class="line">    <span class="comment">// 查询任务</span></span><br><span class="line">    Task task = taskService.createTaskQuery()</span><br><span class="line">        .processDefinitionKey(key)</span><br><span class="line">        .taskAssignee(assingee)</span><br><span class="line">        .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 根据任务id来   完成任务</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当流程执行到第一个包含网关后，会根据条件判断，当前要走哪几个分支：</p>
<ul>
<li><p>act_ru_task，在任务执行表中，存在两条任务，即满足条件的一条<code>项目经理</code>，另一条即为都会执行的<code>人事经理</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	EXECUTION_ID_	PROC_INST_ID_	PROC_DEF_ID_	NAME_	PARENT_TASK_ID_	DESCRIPTION_	TASK_DEF_KEY_	OWNER_	ASSIGNEE_	DELEGATION_	PRIORITY_	CREATE_TIME_	DUE_DATE_	CATEGORY_	SUSPENSION_STATE_	TENANT_ID_	FORM_KEY_	CLAIM_TIME_</span><br><span class="line">5004	1	2505	2501	evection-inclusive:1:3	项目经理	\N	\N	_5	\N	lisi	\N	50	2022-05-08 15:06:45	\N	\N	1		\N	\N</span><br><span class="line">5007	1	5002	2501	evection-inclusive:1:3	人事经理	\N	\N	_6	\N	wangwu	\N	50	2022-05-08 15:06:45	\N	\N	1		\N	\N</span><br></pre></td></tr></table></figure></li>
<li><p>act_ru_execution，查询流程实例执行表，可以看到有两个分支在执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ID_	REV_	PROC_INST_ID_	BUSINESS_KEY_	PARENT_ID_	PROC_DEF_ID_	SUPER_EXEC_	ROOT_PROC_INST_ID_	ACT_ID_	IS_ACTIVE_	IS_CONCURRENT_	IS_SCOPE_	IS_EVENT_SCOPE_	IS_MI_ROOT_	SUSPENSION_STATE_	CACHED_ENT_STATE_	TENANT_ID_	NAME_	START_TIME_	START_USER_ID_	LOCK_TIME_	IS_COUNT_ENABLED_	EVT_SUBSCR_COUNT_	TASK_COUNT_	JOB_COUNT_	TIMER_JOB_COUNT_	SUSP_JOB_COUNT_	DEADLETTER_JOB_COUNT_	VAR_COUNT_	ID_LINK_COUNT_</span><br><span class="line">2501	2	2501	\N	\N	evection-inclusive:1:3	\N	2501	\N	1	0	1	0	0	1	\N		\N	2022-05-08 15:05:48	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">2505	2	2501	\N	2501	evection-inclusive:1:3	\N	2501	_5	1	0	0	0	0	1	\N		\N	2022-05-08 15:05:48	\N	\N	0	0	0	0	0	0	0	0	0</span><br><span class="line">5002	1	2501	\N	2501	evection-inclusive:1:3	\N	2501	_6	1	0	0	0	0	1	\N		\N	2022-05-08 15:06:45	\N	\N	0	0	0	0	0	0	0	0	0</span><br></pre></td></tr></table></figure>
<p>其中：第一条记录：包含网关分支；</p>
<p>后两条记录代表两个要执行的分支：</p>
<ul>
<li><p><code>ACT_ID = &quot;_5&quot;</code> 代表 <code>项目经理</code> 审批节点</p></li>
<li><p><code>ACT_ID = &quot;_6&quot;</code> 代表 <code>人事经理</code> 审批节点</p></li>
</ul></li>
</ul>
</blockquote>
<p><strong>执行流程：</strong>后续执行流程基本就和并网关相同了；</p>
<p><strong>小结：</strong>在分支时，需要判断条件，<strong>符合条件的分支，将会执行</strong>，符合条件的分支最终才进行汇聚。</p>
<h3 id="事件网关-eventgateway">5.4 事件网关-EventGateway</h3>
<blockquote>
<p>不甚理解，没有测试。</p>
</blockquote>
<h4 id="概述-5">5.4.1 概述</h4>
<p>事件网关允许根据事件判断流向，网关的每个外出顺序流都要连接到一个<strong>中间捕获事件</strong>。</p>
<p>当流程到达一个基于事件网关，网关会进入等待状态：会暂停执行；与此同时，会为每个外出顺序流创建相对的事件订阅。</p>
<p>事件网关的外出顺序流和普通顺序流不同，这些顺序流不会真的&quot;执行&quot;，相反它们让流程引擎去决定执行到事件网关的流程需要订阅哪些事件。</p>
<p>事件网关要考虑以下条件：</p>
<ol type="1">
<li>事件网关必须有两条或以上外出顺序流；</li>
<li>事件网关后，只能使用intermediateCatchEvent类型（activiti不支持基于事件网关后连接ReceiveTask）</li>
<li>连接到事件网关的中间捕获事件必须只有一个入口顺序流。</li>
</ol>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/事件类型-2.PNG" alt="事件类型-2"></p>
<h4 id="流程定义-4">5.4.2 流程定义</h4>
<p><img src="/2022/05/08/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E6%8F%90%E5%8D%87/事件网关.PNG" alt="事件网关"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;evection-event&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;出差申请-事件网关&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;StartEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;提交申请&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">eventBasedGateway</span> <span class="attr">eventGatewayType</span>=<span class="string">&quot;Exclusive&quot;</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">instantiate</span>=<span class="string">&quot;false&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EventGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intermediateCatchEvent</span> <span class="attr">id</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">name</span>=<span class="string">&quot;IntermediateCatchingEvent&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">messageEventDefinition</span> <span class="attr">id</span>=<span class="string">&quot;_5_ED_1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intermediateCatchEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intermediateCatchEvent</span> <span class="attr">id</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;IntermediateCatchingEvent&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">signalEventDefinition</span> <span class="attr">id</span>=<span class="string">&quot;_6_ED_1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intermediateCatchEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intermediateCatchEvent</span> <span class="attr">id</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">name</span>=<span class="string">&quot;IntermediateCatchingEvent&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">timerEventDefinition</span> <span class="attr">id</span>=<span class="string">&quot;_7_ED_1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intermediateCatchEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;lisi&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">name</span>=<span class="string">&quot;消息任务&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">name</span>=<span class="string">&quot;信号任务&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhaoliu&quot;</span> <span class="attr">activiti:exclusive</span>=<span class="string">&quot;true&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">name</span>=<span class="string">&quot;定时任务&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">gatewayDirection</span>=<span class="string">&quot;Unspecified&quot;</span> <span class="attr">id</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ExclusiveGateway&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;_12&quot;</span> <span class="attr">name</span>=<span class="string">&quot;EndEvent&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_13&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_14&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_15&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_16&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_6&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_17&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_4&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_7&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_18&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_5&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_19&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_6&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_9&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_20&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_7&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_21&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_8&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_11&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_22&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_9&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_11&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_23&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_10&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_11&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_24&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;_11&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;_12&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    
	
	<div>
		
			<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

<div>
    
       <div style="text-align:center;color:#bfbfbf;font-size:16px;">
             <span>--- 本文结束 </span>
             <i class="fa fa-thumbs-o-up"></i>
             <span> 感谢阅读 ---</span>
       </div>
    
</div>
		
	</div>

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> 学习笔记</a>
              <a href="/tags/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> 开发框架</a>
              <a href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> 工作流</a>
              <a href="/tags/Activiti/" rel="tag"><i class="fa fa-hand-peace-o" aria-hidden="true"></i> Activiti</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/01/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/Activiti/%E5%B7%A5%E4%BD%9C%E6%B5%81%EF%BC%9AActiviti%E5%9F%BA%E7%A1%80/" rel="prev" title="工作流：Activiti基础">
      <i class="fa fa-chevron-left"></i> 工作流：Activiti基础
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81activiti%E6%8F%90%E5%8D%87"><span class="nav-text">工作流：Activiti提升</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-text">1. 流程实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-text">1.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#businesskey"><span class="nav-text">1.2 Businesskey</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="nav-text">1.2.1 概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="nav-text">1.2.2 数据库操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-text">1.2.3 查询流程实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E8%81%94-businesskey"><span class="nav-text">1.2.4 关联 BusinessKey</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%82%E8%B5%B7%E6%BF%80%E6%B4%BB%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-text">1.3 挂起&amp;激活流程实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E9%83%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B%E6%8C%82%E8%B5%B7"><span class="nav-text">1.3.1 全部流程实例挂起</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E4%B8%AA%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B%E6%8C%82%E8%B5%B7"><span class="nav-text">1.3.2 单个流程实例挂起</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E4%BB%BB%E5%8A%A1"><span class="nav-text">2. 个人任务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%85%8D%E4%BB%BB%E5%8A%A1%E8%B4%9F%E8%B4%A3%E4%BA%BA"><span class="nav-text">2.1 分配任务负责人</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E5%88%86%E9%85%8D"><span class="nav-text">2.1.1 固定分配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%88%86%E9%85%8D"><span class="nav-text">2.1.2 表达式分配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E5%88%86%E9%85%8D"><span class="nav-text">2.1.3 监听器分配</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BB%BB%E5%8A%A1"><span class="nav-text">2.2 查询任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9E%E7%90%86%E4%BB%BB%E5%8A%A1"><span class="nav-text">2.3 办理任务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="nav-text">3. 流程变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F-1"><span class="nav-text">3.1 流程变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-text">3.2 流程变量作用域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-text">3.3 流程变量的使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8global%E5%8F%98%E9%87%8F%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B"><span class="nav-text">3.4 使用Global变量控制流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9C%80%E6%B1%82"><span class="nav-text">3.4.1 需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="nav-text">3.4.2 流程定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%B8%83%E7%BD%B2"><span class="nav-text">3.4.3 流程布署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEglobal%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="nav-text">3.4.4 设置global流程变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%97%B6%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="nav-text">3.4.4.1 启动流程时设置变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E5%8A%9E%E7%90%86%E6%97%B6%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="nav-text">3.4.4.2 任务办理时设置变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%BD%93%E5%89%8D%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B%E8%AE%BE%E7%BD%AE"><span class="nav-text">3.4.4.3 通过当前流程实例设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%BD%93%E5%89%8D%E4%BB%BB%E5%8A%A1%E8%AE%BE%E7%BD%AE"><span class="nav-text">3.4.4.4 通过当前任务设置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%94%AF%E6%B5%8B%E8%AF%95"><span class="nav-text">3.4.5 分支测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">3.4.6 注意事项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AElocal%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="nav-text">3.5 设置local流程变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E5%8A%9E%E7%90%86%E6%97%B6%E8%AE%BE%E7%BD%AE"><span class="nav-text">3.5.1 任务办理时设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%BD%93%E5%89%8D%E4%BB%BB%E5%8A%A1%E8%AE%BE%E7%BD%AE-1"><span class="nav-text">3.5.2 通过当前任务设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#local%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%95"><span class="nav-text">3.5.3 Local变量测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E4%BB%BB%E5%8A%A1"><span class="nav-text">4. 组任务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%BB%E5%8A%A1%E8%AE%BE%E7%BD%AE"><span class="nav-text">4.1 组任务设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%BB%E5%8A%A1-1"><span class="nav-text">4.2 组任务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E4%BB%BB%E5%8A%A1%E5%8A%9E%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-text">4.2.1 组任务办理流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E4%BB%BB%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="nav-text">4.2.2 组任务操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E5%85%B3"><span class="nav-text">5. 网关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E4%BB%96%E7%BD%91%E5%85%B3-exclusivegateway"><span class="nav-text">5.1 排他网关-ExclusiveGateway</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="nav-text">5.1.1 概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-1"><span class="nav-text">5.1.2 流程定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%B5%8B%E8%AF%95"><span class="nav-text">5.1.3 流程测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E7%BD%91%E5%85%B3-parallelgateway"><span class="nav-text">5.2 并行网关-ParallelGateway</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="nav-text">5.2.1 概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-2"><span class="nav-text">5.2.2 流程定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%B5%8B%E8%AF%95-1"><span class="nav-text">5.2.2 流程测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E5%90%AB%E7%BD%91%E5%85%B3-inclusivegateway"><span class="nav-text">5.3 包含网关-InclusiveGateway</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-4"><span class="nav-text">5.3.1 概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-3"><span class="nav-text">5.3.2 流程定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%B5%8B%E8%AF%95-2"><span class="nav-text">5.3.3 流程测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%BD%91%E5%85%B3-eventgateway"><span class="nav-text">5.4 事件网关-EventGateway</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-5"><span class="nav-text">5.4.1 概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-4"><span class="nav-text">5.4.2 流程定义</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhuCC"
      src="/images/%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">ZhuCC</p>
  <div class="site-description" itemprop="description">不急不躁。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">210</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
	  
	  
        <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
        <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
        <div class="widget-wrap">
            <div id="myCanvasContainer" class="widget tagcloud">
                <canvas width="250" height="250" id="resCanvas" style="width=100%">
                    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activiti/" rel="tag">Activiti</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anaconda/" rel="tag">Anaconda</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arthas/" rel="tag">Arthas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAT/" rel="tag">CAT</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CompletableFuture/" rel="tag">CompletableFuture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/" rel="tag">ELK</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearck/" rel="tag">Elasticsearck</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/" rel="tag">GPU</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/" rel="tag">GitHub</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitee/" rel="tag">Gitee</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Groovy/" rel="tag">Groovy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/" rel="tag">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">76</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%9F%BA%E7%A1%80/" rel="tag">Java基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E8%AF%AD%E6%B3%95/" rel="tag">Java语法</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K%E8%BF%91%E9%82%BB/" rel="tag">K近邻</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mock/" rel="tag">Mock</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/" rel="tag">Mockito</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSS/" rel="tag">OSS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/" rel="tag">OpenCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optional/" rel="tag">Optional</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSM/" rel="tag">SSM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/" rel="tag">SpringMVC</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/" rel="tag">TensorFlow</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadLocal/" rel="tag">ThreadLocal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TortoiseGit/" rel="tag">TortoiseGit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TransmittableThreadLocal/" rel="tag">TransmittableThreadLocal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typora/" rel="tag">Typora</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvidia/" rel="tag">nvidia</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA%E7%BB%8F%E5%8E%86/" rel="tag">个人经历</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/" rel="tag">全文检索</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%B3%E7%AD%96%E6%A0%91/" rel="tag">决策树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98/" rel="tag">分类问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98/" rel="tag">刷题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">刷题笔记</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/" rel="tag">加密文章</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" rel="tag">博客搭建</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%82%E8%80%83%E6%96%87%E4%BB%B6/" rel="tag">参考文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">基础知识</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a><span class="tag-list-count">106</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/" rel="tag">工作流</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="tag">并发编程</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" rel="tag">开发框架</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%88%90%E9%95%BF%E5%8F%B2/" rel="tag">成长史</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/" rel="tag">持久层框架</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" rel="tag">排序算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/" rel="tag">支持向量机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6%E6%8E%A8%E5%AF%BC/" rel="tag">数学推导</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" rel="tag">数据清洗</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%B8%B8/" rel="tag">日常</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" rel="tag">日志框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E7%BB%93%E6%9E%84/" rel="tag">树结构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" rel="tag">测试工具</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/" rel="tag">特征选择</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" rel="tag">环境配置</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B/" rel="tag">目标检测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" rel="tag">线性回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%81%9A%E7%B1%BB/" rel="tag">聚类</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A1%A8%E7%A4%BA%E5%B1%82/" rel="tag">表示层</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E8%B7%AF/" rel="tag">计算机网路</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E7%94%A8%E9%93%BE%E7%9B%91%E6%8E%A7/" rel="tag">调用链监控</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9D%E5%8F%B6%E6%96%AF/" rel="tag">贝叶斯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/" rel="tag">软件使用</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" rel="tag">逻辑回归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88%E7%B1%BB/" rel="tag">集合类</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/" rel="tag">集成学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E7%BB%8F/" rel="tag">面经</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0/" rel="tag">面试笔记</a><span class="tag-list-count">61</span></li></ul>
                </canvas>
            </div>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhuCC</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">3.8m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">57:29</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '3it0tVBbppFeFBVa8QgB3vxM-gzGzoHsz',
      appKey     : '9VtnMWSrhAtC1pSRaA4Rivx9',
      placeholder: "请多多指教~",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
